var bpaUiEntryPoint=function(e){function t(t){for(var r,o,c=t[0],s=t[1],u=t[2],d=0,f=[];d<c.length;d++)o=c[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(l&&l(t);f.length;)f.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,c=1;c<n.length;c++){var s=n[c];0!==a[s]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={4:0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/ab/assets/Bpa/a5a0ef0/";var c=window.bpaWebpackJsonpFunction=window.bpaWebpackJsonpFunction||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;return i.push([604,0]),n()}([,function(e,t,n){"use strict";angular.module("bpa-ui.directives",["bpa-ui.factories","bpa-common.directives"])},function(e,t,n){"use strict";n.d(t,"q",(function(){return r})),n.d(t,"o",(function(){return a})),n.d(t,"k",(function(){return i})),n.d(t,"p",(function(){return o})),n.d(t,"m",(function(){return c})),n.d(t,"n",(function(){return s})),n.d(t,"s",(function(){return u})),n.d(t,"t",(function(){return l})),n.d(t,"r",(function(){return d})),n.d(t,"l",(function(){return f})),n.d(t,"h",(function(){return p})),n.d(t,"b",(function(){return m})),n.d(t,"c",(function(){return g})),n.d(t,"d",(function(){return b})),n.d(t,"i",(function(){return h})),n.d(t,"j",(function(){return v})),n.d(t,"f",(function(){return y})),n.d(t,"a",(function(){return A})),n.d(t,"g",(function(){return S})),n.d(t,"e",(function(){return C}));var r="add_upm",a="add_upm_add_card",i="add_upm_add_address",o="add_upm_add_paypal",c="add_upm_add_bank_instant",s="add_upm_add_bank_manual",u="add_upm_use_balance",l="add_upm_verify_upm",d="add_upm_subscription_step",f="add_upm_add_bank_instant_depositories",p="save",m="back",g="changeupm",b="continue",h="start_screen",v="success_event_upm_added",y="error_event_third_party_script",A="add_upm_add_address_impression",S="error_event_validation_errors",C="error_event_processing_errors"},,function(e,t,n){"use strict";angular.module("bpa-ui.factories",["bpa-ui.constants","components.core.log","bpa-common.factories","bpa-common.interceptors"])},function(e,t,n){"use strict";n.r(t);n(4),n(13),n(12);angular.module("bpa-ui.factories").factory("bpaUrl",["$location","$document","$templateCache","bpaVars","ACCOUNTING_ENTITY_KEY","DISBURSEMENT_METHODS_URL_PART","DEPOSIT_METHODS_URL_PART","FINANCIAL_ACCOUNTS_URL_PART","bpaRouting","$injector",function(e,t,n,r,a,i,o,c,s,u){return{urlSetAe:function(e){var t=f();return e.replace("/00000/",t?"/"+t+"/":"/")},formUrl:function(e){return p(e=l(e))?e:d(!0)+e},baseUrl:d,resourceUrl:function(e,t,n){if(angular.isArray(e)&&e.length>1){if(p(e[1]))return e[1];e=e[0]}return e=e.replace(/^\/+/,""),d(n)+e+g(t,!0)},absoluteUrl:function(t){if(t.length&&"/"!==t[0])return t;var n=e.protocol()+"://"+location.host;return t=t.replace(/^\/+/,"/"),n+t},isTemplateExists:p,getTemplateCacheName:l,getMainBillingMethodsPageUri:function(){return m("bpa_ui_billing_methods_uri")},getDisbursementMethodsPageUri:function(){return m("bpa_ui_disbursement_methods_uri")},disbursementMethodsActionUrl:function(e,t,n){return(n?"/":d(!1))+(e?e+"/":"")+i+(t?"/"+t:"")},depositMethodsBaseUrl:function(e,t){return(t?"/":d(!1))+(e||"")+"/"+o},financialAccountsBaseUrl:function(e){return d(!1)+c+(e?"/"+e:"")},buildUrl:b,buildDefaultUrl:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({context:Applet.getOrganization().getUid(),accountingEntity:f()},t);return b(e,r,n)}};function l(e){return e+".html"}function d(e){var t=f(),n=m("bpa_ui_base_url")+"/";return e&&t&&(n+=t+"/"),n}function f(){return u.get("bpa").getAccountingEntityRid()}function p(e){var r=t[0].getElementById(e);return r&&"text/ng-template"===r.getAttribute("type")&&"script"===r.nodeName.toLowerCase()||!!n.get(e)}function m(e){var t=Applet.getVar(e);if(!t)throw new Error("Please check app config, "+e+" not defined in js_vars");return t}function g(e,t){var n=t?"?":"",r=[];for(var a in e=e||{})e.hasOwnProperty(a)&&r.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return r.length>0?n+r.join("&"):""}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=s.get(e);for(var a in t)if(t.hasOwnProperty(a)){var i=t[a],o="{"+a+"}";void 0===i&&(i="$1",o=new RegExp("/?{"+a+"}(/?)")),r=r.replace(o,i)}return Object.keys(n).length>0&&(r=r.concat("?",g(n))),r}}])},,,function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r="United States",a="USA",i="Canada",o="CAN"},,function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaAlert",["$timeout",function(e){var t=[],n=null;return{addAlertMessages:function(n,r){e((function(){n&&n.length>0&&(t=t.concat(n.map((function(e){return angular.isString(e)?e={aeRid:null,type:"danger",message:e,namespace:r}:e.namespace=r,e}))))}))},addFatalErrorMessage:function(r,a){e((function(){t.push({aeRid:r,type:"danger",message:n,namespace:a})}))},getAlertMessages:function(e,n){return e||n?t.filter((function(t){return r(t,e,n)})):t},setFatalErrorMessage:function(e){n=e},closeAlertMessage:function(e){t.splice(e,1)},clearMessages:function(e,n){t=e||n?t.filter((function(t){return!r(t,e,n)})):[]},addAlertsOrFatal:function(e,t){e&&e.messages&&e.messages.length>0?this.addAlertMessages(e.messages):this.addFatalErrorMessage(t)}};function r(e,t,n){return(!t||!e.aeRid||e.aeRid===t)&&(!n&&!e.namespace||e.namespace===n)}}])},,function(e,t,n){"use strict";e=angular.module("bpa-ui.constants",["components.core.psmetrics"]);var r=Applet.getVar("bpa_ui_psmetrics_traffic_rate");void 0!==r&&e.constant("PSMETRICS_TRAFFIC_RATE",parseFloat(r)),e.constant("DISBURSEMENT_METHODS_URL_PART","disbursement-methods").constant("TAX_INFO_URL_PART","tax-info").constant("DEPOSIT_METHODS_URL_PART","deposit-methods").constant("FINANCIAL_ACCOUNTS_URL_PART","financial-accounts").constant("ACCOUNTING_ENTITY_KEY","bpa_ui_accounting_entity_id")},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaVars",[function(){var e={};return{get:function(t){return e[t]||Applet.getVar(t)},set:function(t,n){e[t]=n}}}])},function(e,t,n){"use strict";n.r(t);n(4),n(5),n(13);angular.module("bpa-ui.factories").factory("bpa",["$q","bpaOauth2Http","bpaUrl","bpaVars","ACCOUNTING_ENTITY_KEY",function(e,t,n,r,a){var i={};return{setAccountingEntityRid:function(e){r.set(a,e)},getAccountingEntityRid:function(){return r.get(a)},checkMethodOfPayment:function(t,n){var r=e.defer();return o(n,(function(e){var n=function(e,t){var n,r,a="";for(r in e)if(n=e[r],Array.isArray(n)&&n.length&&s(n,t)){a=r;break}return a}(t,e);n?r.resolve(n):r.reject("no_match")}),(function(e){r.reject(e)})),r.promise},getMethodOfPaymentInfo:o,setMethodOfPaymentInfo:function(e){i[e.id]=e},updateMethodOfPaymentInfo:function(e,t){i[e]=angular.extend(i[e],t)},NOT_EXISTS:function(e){return void 0===e.type},IS_CC:function(e){return"CC"===e.type},IS_ACH:function(e){return"ACH_DEPOSIT"===e.type},VERIFIED:function(e){return"verified"===e.verification_status&&e.is_active},WAIT_VERIFICATION:function(e){return"in_progress"===e.verification_status}};function o(e,r,a){if(i[e])c(i[e],r);else{var o=n.baseUrl(!0)+"mop-info";e&&(o+="/"+e),t.get(o).then((function(e){c(e.data,r)}),(function(e){a&&a(401===e.status||403===e.status?"access_denied":"network_error")}))}}function c(e,t){e&&(e.verification_status=e.verification,e.billing_address=e.billing_address||{}),t(e)}function s(e,t){for(var n=0,r=e.length;n<r;n++){if("function"!=typeof e[n])return!1;if(!e[n](t))return!1}return!0}}])},,,,function(e,t,n){"use strict";angular.module("bpa-ui.components",[])},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaScreenSize",["screenSize","$window","$timeout",function(e,t,n){return angular.element(t).on("resize",(function(){return n((function(){return e.init()}))})),{is:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return-1!==n.indexOf(e.get())},isSmallScreen:function(){return this.is("xs","sm")}}}])},,,function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaTaxInfo",["$q","bpaOauth2Http","bpaRouting",function(e,t,n){var r=!1;return{get:function(r){return e((function(e,a){t.get(n.get("tax-info-status").replace("{context}",r)).then((function(t){t.data&&t.data.taxInfo?e(t.data):a(t.data)}),(function(e){return a({code:e.status,message:e.statusText})}))}))},save:function(r,a){return e((function(e,i){t.post(n.get("submit-tax-info").replace("{context}",a),{tax_info:r}).then((function(t){t.data&&t.data.status?e(t.data):i(t.data)}),(function(){return i()}))}))},enableFlashMessages:function(){r=!0},saveVat:function(e,t,n){var r={vatId:e};return t&&(r.registrationDate=t.getFullYear()+"-"+(t.getMonth()+1).toString().padStart(2,"0")+"-"+t.getDate().toString().padStart(2,"0")),a(r,n)},skipVat:function(e){return a({vatSkipped:!0},e)},removeVat:function(r){return e((function(e,a){t.post(n.get("remove-vat").replace("{context}",r),{}).then((function(t){t.data&&t.data.status?e(t.data):a(t.data)}),(function(){return a()}))}))},getJurisdictions:function(e){return t.get(n.get("get-tax-jurisdictions").replace("{country}",e),{cache:!0}).then((function(e){return e.data}))},getCountryVatStatus:function(e){return t.get(n.get("get-country-vat-status").replace("{country}",e),{cache:!0}).then((function(e){return e.data}))}};function a(a,i){r&&(a.flashMessagesEnabled=!0);var o=i?"submit-vat":"submit-vat-implicit-context";return e((function(e,r){t.post(n.get(o).replace("{context}",i),{vat_info:a}).then((function(t){t.data&&t.data.status?e(t.data):r(t.data)}),(function(){return r()}))}))}}])},function(e,t,n){"use strict";angular.module("bpa-ui.financial-accounts.directives",[])},,,,function(e,t,n){"use strict";n.r(t);n(4),n(36),n(5);angular.module("bpa-ui.factories").factory("bpaIovation",["$timeout","bpaOauth2Http","ExternalScripts","bpaUrl",function(e,t,n,r){return function(){if("undefined"!=typeof ioGetBlackbox)return;t.get(r.resourceUrl("iovation/config"),{cache:!0}).success((function(e){n.download(e.jsUrl)}))}(),{getBlackBox:i,updateScope:function(e,t){a(e.bpaFormData,t)},setBlackBox:a};function a(e,t){i((function(n){e.iovationBlackBox=n,t()}))}function i(t){var n=5;"undefined"==typeof ioGetBlackbox?t(""):function r(){var a=ioGetBlackbox();if(a&&a.finished&&a.blackbox)return void t(a.blackbox);--n?e(r,2e3):t("")}()}}])},function(e,t,n){"use strict";angular.module("bpa-ui.controllers",["bpa-ui.factories"])},function(e,t,n){"use strict";n.r(t);n(46),n(67),n(68),n(53),n(5);angular.module("bpa-ui.financial-accounts.factories").factory("aeManage",["bpaOauth2Http","lockSubmit","scroller","aeMessages","bpaUrl",function(e,t,n,r,a){var i=0,o=[],c={},s={},u={},l={},d={},f={},p=Applet.getVar("ae_count"),m=Applet.getVar("ae_limit");return{updateAe:function(n){var a=Applet.getVar("update_ae_url"),i=n.aeId,o=function(e){var t=E(e.aeId),n={};if(!t)return null;return n.name=t.name==e.name?null:e.name,n.hidden=t.hidden==e.hidden?null:e.hidden,n}(n);t.lock(),r.reset(),e.post(_(a,i),o).success((function(e){t.unlock(),function(e){if(!e)return!1;if(void 0===e.name||void 0===e.hidden)return!1;return!0}(e)?(r.setGeneralErrors(e.error),r.setUpdateAeStatus(e,o),function(e,t){var n=E(e);if(!n)return;null!=t.name&&(n.name=t.name);null!=t.hidden&&(n.hidden=t.hidden)}(i,e)):r.setNetworkError()})).error((function(e){t.unlock(),e.errorMessage?r.setGeneralErrors(e.errorMessage):r.setNetworkError()}))},registerExistingAe:function(e){var t=E(e.aeId);t?(t.aeId=e.aeId,t.name=e.name,t.hidden=e.hidden,t.suspended=e.suspended):c[e.aeId]=e},registerExistingTeam:function(e){s[e.teamId]=e},addNewAe:function(e){return p++,i++,o.push({id:i,name:e,hidden:!1}),i},getNewAeList:b,getAeById:E,setAeName:function(e,t){var n=E(e);n?n.name=t:c[e]={name:t}},getAeName:function(e){var t=E(e);return t?t.name:""},getAeHidden:function(e){if(!e)return!1;var t=E(e);return!!t&&t.hidden},removeUnusedNewAe:v,extractNewAeId:C,getNewAeCountForTeam:function(e){return l[e]},aeLimitRiched:function(){return m<p+1},getAddAeLimit:A,getAeCount:S,getTeamName:function(e){var t=s[e];return t?t.name:""},getRootAe:k,getAddAeHint:function(){var e=k();if(M())return(Applet.getVar("ae_suspended_hint")||"").replace("%name%",e.name).replace("%aeRid%",e.aeId);return(Applet.getVar("ae_limit_hint")||"").replace("%count%",S()).replace("%max%",A())},isRootAeSuspended:M,getFinData:g,assignCreate:function(){var n,a,i,o=Applet.getVar("assign_and_create_url"),u=b(),p=I(),m={},g={},h={assign:g,newAe:m};if(!p)return;for(var A in d)f[A]!=d[A]&&(g[A]=d[A]);for(var S=0,C=u.length;S<C;S++)(n=u[S]).aeId||(m[n.id]=n.name);return t.lock(),r.reset(),e.post(_(o,p),h).success((function(e){t.unlock(),function(e){if(!e)return!1;if(!e.assigned||!e.added)return!1;return!0}(e)?(a=function(e){var t,n,r={},a=[],i=[];for(var o in y((function(t){(n=e.added[t.id])?(!function(e,t){e.aeId=t,c[t]=e}(t,n),delete l[t.id],r[n]=t,a.push(t)):i.push(t)})),e.assigned)n=e.assigned[o],(t=r[n])&&(t.teamId=o,d[o]=""+n);return{success:a,error:i}}(e),i=function(e){var t,n=[],r=[];for(var a in d)f[a]!=d[a]&&(t=s[a],e.assigned[a]?r.push(t):e.unexpectedTeamAssignError&&-1!==e.unexpectedTeamAssignError.indexOf(a)&&n.push(t));for(a in e.assigned)f[a]=e.assigned[a];return v(),{success:r,error:n}}(e),r.setAddAeData(a),r.setAssignAeData(i),r.setGeneralErrors(e.error)):r.setNetworkError()})).error((function(e){t.unlock(),e.errorMessage?r.setGeneralErrors(e.errorMessage):r.setNetworkError()}))},countNewUsedAe:function(e){var t=d[e],n=C(u[e]),r=C(t);n&&l[n]&&(l[n]--,0==l[n]&&delete l[n]);r&&(l[r]=(l[r]||0)+1);u[e]=d[e]},isTeamHidden:h,isFinDataEmpty:function(){for(var e in d)if(d[e]!=f[e])return!1;return!0},setFinInitData:function(e,t){f[e]=t},canHideAe:function(e){var t;for(t in f)if(d[t]){if(d[t]==e&&!h(t))return!1}else if(f[t]==e&&!h(t))return!1;for(t in d)if(d[t]==e&&!h(t))return!1;return!0},aboutToCreateAe:function(){var e=!1;return y((function(){return e=!0,!1})),e},aboutToAssignForExistingAe:function(){for(var e in d)if(d[e]!=f[e]&&f[e])return!0;return!1},getAffectedTeamObjects:function(){var e=[];for(var t in d)d[t]!=f[t]&&e.push(s[t]);return e},getExistingAes:function(){return c},getTeamsInitiallyAssignedToAe:function(e){var t=[];for(var n in f)f[n]==e&&t.push(s[n]);return t},getAeInitiallyAssignedToTeam:function(e){var t=f[e];return c[t]},resetFinData:function(){for(var e in f)d[e]=f[e]},getNewAeById:function(e){for(var t in o)if(o[t].id==e)return o[t]},isRootAe:function(e){for(var t in f)if(f[t]==e&&s[t].isRoot)return!0;return!1},createTemporaryNewAeId:function(e){return"+"+e},canTeamSwitchAe:function(n,i,o){var c,s="";t.lock(),r.reset(),angular.isUndefined(i)&&(i=I(),s="-new");return c=a.financialAccountsBaseUrl(i)+"/can-switch-ae"+s+"/"+n,e.get(c).success((function(e){if(t.unlock(),angular.isUndefined(e))return r.setNetworkError(),void o(!0);angular.isUndefined(e.error)?o(!1):(r.setGeneralErrors(e.error),o(!0))})).error((function(e){t.unlock(),e.errorMessage?r.setGeneralErrors(e.errorMessage):r.setNetworkError(),o(!0)}))}};function g(){return d}function b(){return o}function h(e){var t=s[e];return!!t&&t.hidden}function v(){var e,t,n={},r=o.length,a=g();for(var i in a)(e=C(a[i]))&&(n[e]=!0);for(;--r>=0;)(t=o[r]).aeId||(e=t.id,l[e]||n[e]||(p--,o.splice(r,1)))}function y(e){for(var t,n=0,r=o.length;n<r&&((t=o[n]).aeId||!1!==e(t));n++);}function A(){return m}function S(){return p}function C(e){return e&&e.length&&"+"==e[0]?e.substr(1):0}function E(e){return c[e]}function k(){for(var e in f)if(s[e].isRoot&&f[e])return E(f[e]);return null}function M(){var e=k();return e&&e.suspended}function _(e,t){return e.replace("00000",t)}function I(){for(var e in f)return f[e];return null}}])},function(e,t,n){"use strict";angular.module("bpa-ui.financial-accounts.controllers",[])},,,,,function(e,t,n){"use strict";n.r(t);n(4),n(5),n(37),n(27),n(12);angular.module("bpa-ui.factories").factory("bpaAddBillingMethod",["bpaUrl","bpaOauth2Http","CreditCards","$templateCache","$document","bpaIovation","bpaAssets","DEPOSIT_METHODS_URL_PART","gcModal","$q",function(e,t,n,r,a,i,o,c,s,u){var l,d,f=!1;return{show:function(e){return function(e){if(f)return null;return f=!0,e=angular.extend({returnPaymentData:!1,hideCloseButton:!1,skipVerification:!1,forcePrimary:1,updateBillingAddress:!1,enableSubscription:!1,popupSubmitLabel:""},e),u((function(t,n){s.open("bpa-add-billing-method-modal",{config:e,onSuccess:function(e){return t(e)},onClose:function(e){return n(e)},onRemoved:function(){f=!1}})}))}(e)},preFetchData:function(e){p(),n.preFetchAddForm(e),t.get(m(),{cache:r}).then((function(e){var t=a[0].createElement("div");t.innerHTML=e.data;for(var n,r=t.querySelectorAll("img"),i=0,c=r.length;i<c;i++)n=r[i],(new Image).src=n.hasAttribute("relative-src")?o.getAssetUrl(n.getAttribute("relative-src")):n.getAttribute("src")}))},getTemplateUrl:m,getAvailableDataPromise:p,setProductChargeAmount:function(e){d=e},removeAddCardFormFromCache:function(e){n.removeAddFormFromCache(e)}};function p(){if(!l){var n=d?"?productChargeAmount="+d:"";l=t.get(e.baseUrl(!0)+c+"/available"+n,{cache:!0})}return l}function m(){return e.resourceUrl(c+"/partials/add-billing-method.html")}}])},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("ExternalScripts",["$document",function(e){var t=1,n=2,r=3,a={},i={},o={},c={},s={};return{download:function(o,c,s){c=c||{},i[o]?i[o].push(c):i[o]=[c];var l=a[o];if(void 0!==l)return void(r!==l&&u(o,a[o]));a[o]=r;var d=e[0].createElement("script");for(var f in d.onload=function(){u(o,t)},d.onerror=function(){u(o,n)},d.setAttribute("src",o),s)d.setAttribute(f,s[f]);e[0].head.appendChild(d)},setReady:function(e){l(e,t,s)},setError:function(e){l(e,n,c)},addReadyCallback:function(e,n){d(e,t,s,n)},addErrorCallback:function(e,t){d(e,n,c,t)},isGroupReady:function(e){return void 0!==o[e]}};function u(e,n){var r=t===n?"onload":"onerror",o=i[e];a[e]=n;for(var c=0,s=o.length;c<s;c++)o[c][r]&&o[c][r]();i[e]=[]}function l(e,t,n){o[e]=t;for(var r=n[e]||[],a=0,i=r.length;a<i;a++)r[a]()}function d(e,t,n,r){if(o[e]===t)r();else{var a=n[e]||[];a.push(r),n[e]=a}}}])},function(e,t,n){"use strict";n.r(t);n(4),n(36),n(13),n(5);function r(e){var t=this;this.securedFieldsObject=e,this.callbacks={};["onLoad","onConfigSuccess","onAllValid","onFieldValid","onBrand","onError","onFocus","onBinValue"].forEach((function(e){t[e]=function(n,r){!function(e,n,r){if(t.callbacks[e]=t.callbacks[e]||[],r){var a=t.callbacks[e].find((function(e){return e.origin===r}));if(a)return void(a.callback=n)}t.callbacks[e].push({origin:r,callback:n})}(e,n,r)},t.securedFieldsObject[e]((function(n){t.callbacks[e]&&t.callbacks[e].forEach((function(e){e.callback(n)}))}))}))}n(89),n(14);function a(e,t,n,a,i,o,c,s,u,l){var d,f=null,p=[{type:"visa",currenciesAllowed:!0},{type:"mc",currenciesAllowed:!0},{type:"amex",currenciesAllowed:!0},{type:"discover",currenciesAllowed:!1}],m="add-credit-card";return{getAddFormUrl:b,preFetchAddForm:function(){n.isTemplateExists(m)||o.get(b()).then((function(t){i.put(m,t.data),function(t){var n=c[0].createElement("div");n.innerHTML=t;for(var r=n.querySelector("bpa-external-scripts-group"),a=r.querySelectorAll("bpa-external-script"),i=r.getAttribute("name"),o=a.length,s=0,u=o;s<u;s++)e.download(a[s].getAttribute("src"),{onload:function(){0===--o&&e.setReady(i)},onerror:function(){e.setError(i)}})}(t.data)}))},removeAddFormFromCache:function(){i.remove(n.getTemplateCacheName(m))},getAvailableCreditCards:g,getCurrentCard:function(){return f},initSecuredFields:function(e,t){if(h(),!window.csf)return d.reject("Secured fields library is not loaded"),d.promise;var n={configObject:{cardGroupTypes:g()},rootNode:e,paymentMethods:{card:{sfStyles:{base:{color:"#222",fontSize:"13px",padding:"10px 19px",lineHeight:"18px",fontFamily:'"Gotham SSm",Helvetica,Arial,sans-serif',fontWeight:"400"}},placeholders:{encryptedCardNumber:"",encryptedSecurityCode:""}}},allowedDOMAccess:!1};return o.get(a.get("secured-fields-config"),{cache:!0}).then((function(e){var a=new r(csf(angular.merge(n,{configObject:e.data},{configObject:t||{}})));a.onConfigSuccess((function(){d.resolve(a)}))})).catch((function(){d.reject("Config loading failure")})),d.promise},getSecuredFieldsPromise:function(){return h().promise},updateBrand:function(e){return f=p.find((function(t){return t.type===e}))},destroySecuredFieldsPromise:function(){d=null},cardTypeToBrand:function(e){switch(e){case"Visa":return"visa";case"MasterCard":return"mc";case"American Express":return"amex";case"Discover":return"discover"}return""},getDetails:function(e,t){return u.post(n.buildUrl("get-adyen-card-details",{accountingEntity:l.getAccountingEntityRid(),context:Applet.getOrganization().getUid()}),{mopType:e,encryptedCardNumber:t}).then((function(e){return e.data}))}};function g(){return p.map((function(e){return e.type}))}function b(){return n.formUrl(m)}function h(){return d||(d=s.defer()),d}}angular.module("bpa-ui.factories").factory("CreditCards",a),a.$inject=["ExternalScripts","bpaVars","bpaUrl","bpaRouting","$templateCache","bpaOauth2Http","$document","$q","bpaCachedPostRequest","bpa"]},,,,,function(e,t,n){"use strict";n.r(t);n(4),n(252);angular.module("bpa-ui.factories").factory("bpaConfirmation",["gcModal","$q",function(e,t){var n={};return{open:function(r,a,i){if(n[r])return null;var o=t((function(t,n){e.open("bpa-confirmation-modal",{templateId:r,properties:a,onAccept:function(){return t()},onCancel:function(){return n("cancel")},onClose:function(){return n("close")},size:i||"sm"})}));return o.finally((function(){return delete n[r]})),n[r]=o,o}}}])},function(e,t,n){"use strict";n.r(t);n(4),n(14),n(10),n(5),n(51),n(12);angular.module("bpa-ui.factories").factory("bpaDepositMethods",["bpa","bpaAlert","bpaUrl","bpaVerifyMop","eoModal","eoChannel","bpaOauth2Http","DEPOSIT_METHODS_URL_PART",function(e,t,n,r,a,i,o,c){var s,u;return{get CHANNEL_MOP_ADDED(){return"bpa.depositMethods.mopAdded"},get CHANNEL_MOP_REMOVED(){return"bpa.depositMethods.mopRemoved"},setScreenLoading:function(e){s=e},isScreenLoading:function(){return s},getDepositTemplateUrl:function(t,n){return t=t||e.getAccountingEntityRid(),u&&!n||(u=t+"/"+c+"/list.html"),u},depositMethodsReload:function(e){u=this.getDepositTemplateUrl(e,!0)+"?"+ +new Date},processResponse:function(e,n){n?(n.messages&&n.messages.length>0&&(t.clearMessages(e),t.addAlertMessages(n.messages)),void 0===n.status?this.processFatalErrorInResponse(e):n.status?this.depositMethodsReload():this.setScreenLoading(!1)):this.processFatalErrorInResponse(e)},processFatalErrorInResponse:function(n){n=n||e.getAccountingEntityRid(),t.clearMessages(n),t.addFatalErrorMessage(n),this.setScreenLoading(!1)},setUpModal:function(e,t){var n=this,r=a.custom(e);return r.opened.then((function(){return n.setScreenLoading(!1)})),r.result.then(t,(function(){})),r},setPrimaryMop:function(e,t){return o.post(n.depositMethodsBaseUrl(e)+"/"+t+"/set-primary")},getInfo:function(e){return o.get(n.depositMethodsBaseUrl(e)+"/info").then((function(e){return e.data}))},verifyMop:function(t){var n=this,a=r.show(t,{allowPrimary:!0,enableSubscription:!0});a&&a.then((function(){i.publish(n.CHANNEL_MOP_ADDED),n.setScreenLoading(!0),n.depositMethodsReload(e.getAccountingEntityRid())}))}}}])},function(e,t,n){"use strict";n.r(t);n(4),n(14),n(10),n(5),n(51),n(60),n(256),n(12);function r(e,t,n,r,a,i,o,c,s){var u,l={get CURRENT_SCHEDULE(){return"disbursement-current-schedule"},get MOP_LIST(){return"disbursement-list"},get LAST_WITHDRAWAL(){return"disbursement-last-withdrawal"},get MOP_TYPES(){return"disbursement-mop-types"},get ACCOUNT_INFO(){return"disbursement-account-info"},get DISBURSE_CONFIGURATION(){return"disburse-configuration"}},d=[],f={openModal:function(e,t){if(u)return null;return r.clearMessages(e,"disburse-modal"),o((function(n,r){c.open("bpa-withdrawal-modal",{currentAccountRid:e,forceMethodType:t,onSuccess:function(e){return n(e)},onClose:function(){return r("close")}}),u=!0})).finally((function(){return u=!1}))},calculateFee:function(e,r,a){var i=n.get("disbursement-fee").replace("{context}",Applet.getOrganization().getUid()).replace("{accountingEntity}",e).replace("{mop}",r);return t.post(i,{amount:a}).then((function(e){return{fee:e.data.fee,amountSentToUser:e.data.amountSentToUser}}))},disburse:function(t,r,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e.post(n.get("disburse").replace("{accountingEntity}",t),{disburseForm:{amount:a,mopRid:r,remittanceInfo:i,overrideRemittanceInfo:o}}).then((function(e){return e.data}))},openAddPaymentMethodModal:function(e,t){switch(t){case"IPO":return a.openModal(e);case"PAYPAL":return i.openModal(e);default:return o.reject()}},getDataForAeRid:m,setDataForAeRid:function(e,n,r){t.setCache(b(e,n),null,{data:r}),g(e,(a={},i=n,o=r,i in a?Object.defineProperty(a,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[i]=o,a));var a,i,o},hasSchedule:function(e){return p(e).then((function(t){return null!==t&&m(e,[l.CURRENT_SCHEDULE],!1,!0).then((function(e){var t=e[l.CURRENT_SCHEDULE];return t&&t.schedule&&t.schedule!==t.manualSchedule}))}))},getPreferredMop:p,addDataUpdateCallback:function(e){d.push(e)}};return Object.assign(f,l),f;function p(e){return m(e,[l.CURRENT_SCHEDULE,l.MOP_LIST],!1,!0).then((function(e){var t=e[l.CURRENT_SCHEDULE],n=e[l.MOP_LIST];return t&&t.preferredMop&&n&&n[t.preferredMop]?n[t.preferredMop]:null}))}function m(e,n,r,a){var i=[],c=[],s=0;return n.forEach((function(n){var a=b(e,n);r&&t.invalidate(a),c.push(t.post(a).then((function(e){i[n]=e.data,s++})))})),o.all(c).then((function(){return a||g(e,i),n.length===s?i:o.reject()}))}function g(e,t){s((function(){d.forEach((function(n){n(e,t)}))}))}function b(e,t){return n.get(t).replace("{accountingEntity}",e)}}angular.module("bpa-ui.factories").factory("bpaDisburse",r),r.$inject=["bpaOauth2Http","bpaCachedPostRequest","bpaRouting","bpaAlert","bpaInstantPay","bpaPayPal","$q","gcModal","$timeout"]},function(e,t,n){"use strict";n.r(t);n(4);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}angular.module("bpa-ui.factories").factory("bpaFormValidation",[function(){return{revalidateAllFields:function(e){angular.forEach(e,(function(e){"object"===r(e)&&("function"==typeof e.$setDirty&&e.$setDirty(),"function"==typeof e.$validate&&e.$validate())}))}}}])},function(e,t,n){"use strict";angular.module("bpa-ui.financial-accounts.factories",[])},,,,,function(e,t,n){"use strict";n.r(t);n(4),n(255);function r(e,t){var n=!1;return{show:function(r,a){return n?null:function(r,a){if(angular.isUndefined(r))throw new Error("bpaVerifyModal.show(): mopRid is empty");return a=angular.extend({enableSubscription:!1,allowPrimary:!1},a||{}),t((function(t,i){e.open("bpa-verify-mop-modal",{mopRid:r,config:a,onSuccess:function(e){return t(e)},onCancel:function(){return i("cancel")},onClose:function(){return i("close")}}),n=!0})).finally((function(){return n=!1}))}(r,a)}}}angular.module("bpa-ui.factories").factory("bpaVerifyMop",r),r.$inject=["gcModal","$q"]},function(e,t,n){"use strict";n.r(t);n(4),n(5),n(35),n(62),n(19),n(36),n(12);angular.module("bpa-ui.factories").factory("plaid",["bpaUrl","bpaAddBillingMethod","eoAuthHelper","bpaOauth2Http","$filter","$timeout","$document","bpaPlaidEventLogger","ExternalScripts","bpaScreenSize","DEPOSIT_METHODS_URL_PART","gcModal","$q",function(e,t,n,r,a,i,o,c,s,u,l,d,f){var p,m,g,b,h,v,y,A,S,C=!1,E=!1,k={},M=!1;return{hasNetworkError:function(){return b},getAccessTokenEncrypted:function(){return m},getAccounts:function(){return p},getBankAccounts:function(){return g},openModal:function(e){return _(),P(e)},closeModal:F,setFormBlocked:w,isFormBlocked:function(){return v},isPlaidAccountsEmpty:function(){return y},isPlaidLoaded:function(){return C},getPlaidHandler:function(){return A},initPlaid:function(t){E||r.get(e.resourceUrl("plaid/config"),{cache:!0}).then((function(i){if(i.data&&i.data.key){var o=i.data;s.download(o.script_url,{onload:function(){angular.isDefined(Plaid)&&"function"==typeof Plaid.create?(E=!0,function(t){M=!1;var i=(A=Plaid.create(angular.merge(t,{onLoad:function(){C=!0},onSuccess:function(t){M=!1,function(t){var i=n.addAuthHelpHeader({});r.post(e.baseUrl(!0)+"plaid-depositories",{publicToken:t},{headers:i}).then((function(e){var t,n,r,i;e.data&&e.data.accounts&&0!==e.data.accounts.length?(i=e.data.accounts,function(e){g=e.map((function(e){return e.name})).join(", ")}(p=a("orderBy")(i,"1 * balances.available",!0)),m=e.data.accessTokenEncrypted,t=p.filter((function(e){return e.balances.available>0})).length,n=p.filter((function(e){return 0===e.balances.available})).length,r=p.length-t-n,c.receivePlaidDepositoriesSuccess(t,n,r)):(F(),y=!0,I())}),(function(){F(),b=!0,I()})).finally((function(){w(!1)}))}(t),w(!0),h=!0},onExit:function(e){c.submitProcessingFailure(),M&&F(),e&&e.code&&(b=!0)}}))).open;A.open=function(){M=!0,i.apply(A)}}({clientName:o.client_name,env:o.env,key:o.key,product:["auth"],selectAccount:!1})):D("Plaid API failed to load",t)},onerror:function(){D("External scripts loading error",t)}})}else D("Plaid configuration response is invalid",t)}),(function(){return D("Plaid configuration loading error",t)}))},isAddPlaidFormActive:function(){return h}};function _(){p=[],m=null,g="",b=!1,h=!1,v=!1,y=!1,S=null}function I(){i((function(){for(var e=[],t=o[0].querySelectorAll(".add-plaid-bank-account-errors:not(.ng-hide)"),n=0;n<t.length;n++)e.push(t[n].innerText);c.receivePlaidDepositoriesFailure(e)}),100)}function F(){return S=f.defer(),k&&k.closeModal?k.closeModal():S.resolve(),S.promise}function P(e){return d.open("bpa-plaid-modal",Object.assign(e,{onClose:function(e){null===e&&M&&A.exit(),S&&S.resolve()},interfaceObject:k}))}function w(e){v=e}function D(e,t){t&&t(e),c.loadingFailure(e)}}])},function(e,t,n){"use strict";n.r(t);n(46),n(68);angular.module("bpa-ui.financial-accounts.factories").factory("aeMessages",["scroller",function(e){var t=[],n=[],r=[],a=[],i=[],o={},c=!1;return{setGeneralErrors:function(e){t=e instanceof Array?e:e?[e]:[];t.length&&u()},getGeneralErrors:function(){return t},setAddAeData:function(e){n=e.success||[],r=e.error||[],(n.length||r.length)&&u()},setAssignAeData:function(e){a=e.success||[],i=e.error||[],(a.length||i.length)&&u()},isAeErrorMessage:function(){return!!r.length},isAeSuccessMessage:function(){return!!n.length},getAeErrorMessageData:function(){return s(r)},getAeSuccessMessageData:function(){return n},isAssignErrorMessage:function(){return!!i.length},isAssignSuccessMessage:function(){return!!a.length},getAssignErrorMessageData:function(){return s(i)},getAssignSuccessMessageData:function(){return s(a)},setNetworkError:function(){u(),c=!0},isNetworkError:function(){return c},setUpdateAeStatus:function(e,t){for(var n in o={},e)e.hasOwnProperty(n)&&(o[n]=e[n]!==t[n])},isHideAeError:function(){return o.hidden},isRenameAeError:function(){return o.name},formatObjectNameList:s,reset:function(){t=[],o={},n=[],r=[],a=[],i=[],c=!1}};function s(e){for(var t="",n=e.length;0<=--n;)t+='"'+e[n].name+(n?'", ':'"');return t}function u(){e.setPosition(0,0)}}])},,,,,,,function(e,t,n){"use strict";n.r(t);n(4),n(14),n(10),n(5),n(51),n(12);function r(e,t,n,r,a,i,o){var c=!1;return{openModal:function(e){if(c)return null;return t.clearMessages(e,"add-ipo-modal"),o((function(t,r){n.open("bpa-instant-pay-modal",{currentAccountRid:e,onSuccess:function(e){return t(e)},onCancel:function(){return r("cancel")},onClose:function(){return r("close")},onRemoved:function(){return c=!1}}),c=!0}))},preFetchAddForm:function(){a.preFetchAddForm()}}}angular.module("bpa-ui.factories").factory("bpaInstantPay",r),r.$inject=["bpaRouting","bpaAlert","gcModal","bpaOauth2Http","CreditCards","$templateCache","$q"]},function(e,t,n){"use strict";n.r(t);n(4);function r(e){return{get ACTION_ADD_PAYMENT_METHOD(){return"add-payment-method"},get ACTION_VERIFY_PAYMENT_METHOD(){return"verify-payment-method"},getAction:function(t){if((t=angular.isUndefined(t)?e.hash():t)===this.ACTION_ADD_PAYMENT_METHOD)return{action:this.ACTION_ADD_PAYMENT_METHOD};var n=new RegExp("^"+this.ACTION_VERIFY_PAYMENT_METHOD+"/(\\d+)$").exec(t);return null!==n?{action:this.ACTION_VERIFY_PAYMENT_METHOD,mopRid:parseInt(n[1])}:{}}}}angular.module("bpa-ui.factories").factory("bpaHashAction",r),r.$inject=["$location"]},function(e,t,n){"use strict";n.r(t);n(4);var r=n(2);angular.module("bpa-ui.factories").factory("bpaPlaidEventLogger",["bpaEventTrackerFactory",function(e){var t,n=e.create(r.l);return{setMakePrimary:function(e){t=angular.isUndefined(e)?"not_present":e?"on":"off"},loadingFailure:function(t){e.create(r.m).messages(r.f,[t])},submitClick:function(){n.click(r.h,{state_make_primary:t})},submitSuccess:function(){n.click(r.j)},submitProcessingFailure:function(e){n.messages(r.e,e)},submitValidationFailure:function(e){n.messages(r.g,e)},receivePlaidDepositoriesSuccess:function(e,t,r){n.impression("success_event_plaid_accounts",{status:"success with (".concat(e,", ").concat(t,", ").concat(r,") of accounts")})},receivePlaidDepositoriesFailure:function(e){n.messages("error_event_plaid_accounts",e)},logStartScreenManual:function(){e.create(r.n).impression(r.i)}}}])},function(e,t,n){"use strict";n.r(t);n(4);function r(e){var t=e.defer();return{isRelevant:function(e){return this.CODE_EMAIL_NOT_VERIFIED===e},handle:function(n,r){return t.resolve(n),e.reject(r)},get promise(){return t.promise},get CODE_EMAIL_NOT_VERIFIED(){return"EMAIL_NOT_VERIFIED"}}}angular.module("bpa-ui.factories").config(["bpaRequirementsNotMetProvider",function(e){e.handlers.push("bpaRequirementsNotMetHandler")}]).factory("bpaRequirementsNotMetHandler",r),r.$inject=["$q","$injector"]},function(e,t,n){"use strict";n.r(t);n(4),n(5),n(92);function r(e,t,n){return{getBrowserInfo:function(){var e=t.screen,n=t.navigator;return{screenWidth:e.width,screenHeight:e.height,colorDepth:e.colorDepth,userAgent:n.userAgent,timeZoneOffset:(new Date).getTimezoneOffset(),language:n.language,javaEnabled:n.javaEnabled(),javaScriptEnabled:!0}},redirectToIssuer:function(a,i){var o={};n.isNativeApp()&&(i=function(e){var t=r();if(-1===e.indexOf(t)){var n=t+"=false";n=-1===e.indexOf("?")?"?"+n:"&"+n,-1===e.indexOf("#")?e+=n:e=e.replace("#",n+"#")}return e}(i),o[r()]="true"),o.returnUrl=i,t.location=e.buildUrl("three-ds-redirect-to-issuer",{ccRequest:a},o)}};function r(){return Applet.getVar("bpa_parameter_na_allow_redirects")||"nav_allow_redirects"}}angular.module("bpa-ui.factories").factory("bpaThreeDs",r),r.$inject=["bpaUrl","$window","bpaEnvironment"]},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("cookieManager",["$cookies",function(e){return{put:function(t,n,r){r=r||{};var a={};a.path=r.path?r.path:"/",a.domain=r.domain?r.domain:Applet.getVar("cookie_domain"),a.secure=r.secure?r.secure:Applet.getVar("cookie_secure"),r.expires&&(a.expires=r.expires);e.put((Applet.getVar("cookie_prefix")||"")+t,n,a)}}}])},function(e,t,n){"use strict";n.r(t);n(28);angular.module("bpa-ui.controllers").controller("yesNoModalController",["$scope","$modalInstance","_injectedProperties",function(e,t,n){e.injectedProperties=n,e.ok=function(){t.close({success:!0})},e.cancel=function(e){t.dismiss(e)}}])},function(e,t,n){"use strict";n.r(t);n(46);angular.module("bpa-ui.financial-accounts.factories").factory("lockSubmit",[function(){var e=!1;return{isLocked:function(){return e},lock:function(){e=!0},unlock:function(){e=!1}}}])},function(e,t,n){"use strict";n.r(t);n(46);angular.module("bpa-ui.financial-accounts.factories").factory("scroller",[function(){var e=function(e){for(var t,n=[],r=0,a=e.length;r<a;r++)(t=e[r])&&n.push(t);return n}([document.body,document.documentElement,document.body.parentNode]);return{setPosition:function(n,r){for(var a=0,i=e.length;a<i;a++)t(e[a],n,r)},getPosition:function(){for(var t,r,a=0,i=e.length;a<i;a++)if((t=e[a]).scrollLeft||t.scrollTop){r=n(t.scrollLeft,t.scrollTop);break}return r||n(0,0)}};function t(e,t,n){null!=t&&(e.scrollLeft=t),null!=n&&(e.scrollTop=n)}function n(e,t){return{left:e,top:t}}}])},function(e,t,n){"use strict";angular.module("bpa-ui.vat-info.directives",[])},function(e,t,n){"use strict";angular.module("bpa-ui.vat-info.controllers",[])},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaCachedPostRequest",["bpaOauth2Http","$q",function(e,t){var n={};return{post:function(a,i){var o=r(a,i),c=n[o]||t.reject();return n[o]=c.then((function(){return c})).catch((function(){return e.post(a,i)})),n[o]},invalidate:function(e,t){var a=r(e,t);delete n[a]},setCache:function(e,a,i){var o=r(e,a);n[o]=t.resolve(i)}};function r(e,t){var n=e;return t&&(n+=JSON.stringify(t)),n}}])},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaBlockMode",[function(){return{lockSubmit:1,lockScreen:2,preventLeave:4,lockAll:7}}])},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaStateMachine",[function(){return function(e){return new function(e){var t=angular.extend({transitions:[],initial:"",current:"",context:{}},e);function n(e){return t.transitions.filter((function(n){return r=n.from,a=t.current,(angular.isArray(r)&&-1!==r.indexOf(a)||r===a)&&("function"==typeof n.can?n.can(t.context,e):n.can);var r,a}))}t.current=t.initial,this.getState=function(){return t.current},this.getContext=function(){return t.context},this.isState=function(e){return this.getState()===e},this.traverse=function(e){var r=n(e);if(r.length){var a=t.current;t.current=r[0].to,"function"==typeof r[0].on&&r[0].on(a,t.context,e)}}}(e)}}])},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaEnvironment",(function(){return{isNativeApp:function(){return!!Applet.getVar("mobile_native_app")}}}))},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaNetworkErrors",[function(){var e={};return{setErrorForUrl:function(t,n,r){e[t]={code:n,data:r}},getErrorForUrl:function(t){return e[t]}}}])},function(e,t,n){"use strict";n.r(t);n(4);var r=n(2);angular.module("bpa-ui.factories").factory("bpaSubscriptionEventLogger",["bpaEventTrackerFactory",function(e){var t,n=e.create(r.r);return{setMopType:function(e){t=e},submitSuccess:function(){n.click("success_event_subscribed",{mop_type:t})},submitProcessingFailure:function(e){angular.forEach(e,(function(e){return n.impression("error_event_processing_error",{status_message:e,mop_type:t})}))}}}])},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaValidationErrors",[function(){return{extract:function(e,t){var n=[];t||(t="[ng-messages]:not(.ng-hide) .form-message.form-error,[data-ng-messages]:not(.ng-hide) .form-message.form-error");for(var r=e.querySelectorAll(t),a=0;a<r.length;a++)n.push(r[a].innerText.trim());return n}}}])},function(e,t,n){"use strict";angular.module("bpa-ui.interceptors",[])},function(e,t,n){"use strict";angular.module("bpa-ui.vat-info.factories",[])},function(e,t,n){"use strict";n.r(t);n(97);angular.module("bpa-ui.vat-info.factories").factory("vatCtrlUtils",[function(){var e={setDefaults:function(t,n,r,a){t.locked=!1,t.hasError=!1,t.scrollToTop=function(){return n.scroll(0,0)},t.deferEntry=function(t,n){var r=new Date;r.setDate(r.getDate()+1),n.put("skipGst",1,{expires:r}),e.redirectToReturnUrl(t)},a.enableFlashMessages()},redirectToReturnUrl:function(e){e.location=Applet.getVar("return_url")}};return e}])},function(e,t,n){"use strict";angular.module("bpa-ui.vat-info.factories").factory("vatForm",[function(){var e,t,n={},r={};return{setSubmitUrl:function(t){e=t},getSubmitUrl:function(){return e},setFormName:function(e){t=e},validate:function(){var e,t;for(e in r)(t=r[e]).$setDirty(),t.$validate()},addInput:function(e,t,a){n[e]=t,r[t]=a},getSubmitData:function(e){var r={},a={};for(var i in n)a[i]=e[n[i]]||null;return r[t]=a,r}}}])},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);n(4),n(5),n(14);function r(e,t,n){return{getBalance:function(){return e.get(r("pay-due-get-balance")).then((function(e){return e.data}))},payBalanceDue:function(t,n,a){return e.post(r("pay-due-charge"),{mopRid:t,amount:n,browserInfo:a}).then((function(e){return e.data}))},buildPayBalanceDue3dsUrl:function(e,t,n){return r("pay-due-charge-3ds",{context:Applet.getOrganization().getUid(),ccRequest:n,mopRid:e,amount:t})}};function r(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.accountingEntity=n.getAccountingEntityRid(),t.buildUrl(e,r)}}angular.module("bpa-ui.factories").factory("bpaBalance",r),r.$inject=["bpaOauth2Http","bpaUrl","bpa"]},function(e,t,n){"use strict";n.r(t);n(4);var r=n(2);angular.module("bpa-ui.factories").factory("bpaBankAccountEventLogger",["bpaEventTrackerFactory",function(e){var t=e.create(r.n);return{submitSuccess:function(){t.click(r.j)},submitProcessingFailure:function(e){t.messages(r.e,e)},submitValidationFailure:function(e){t.messages(r.g,e)},backToPlaid:function(){t.click(r.b),e.create(r.m,r.i)},logAbaValidationError:function(e){t.impression("error_event_invalid_routing",{routing_number:parseInt(e)})}}}])},function(e,t,n){"use strict";n.r(t);n(4);var r=n(2);angular.module("bpa-ui.factories").factory("bpaCcEventLogger",["bpaEventTrackerFactory",function(e){var t,n=e.create(r.o),a=e.create(r.k);return{setBin:function(e){t=e},loadingFailure:function(e){n.messages(r.f,[e],o())},submitClick:function(){a.click(r.h,i())},submitSuccess:function(){a.click(r.j,i())},submitProcessingFailure:function(e){a.messages(r.e,e,i())},submitValidationFailure:function(e){a.messages(r.g,e,i())},nextPageClick:function(){n.click(r.d,o())},nextPageSuccess:function(){a.impression(r.a,i())},nextPageFailure:function(e){angular.forEach(e,(function(e){return n.impression(r.g,angular.extend({status_message:e},o()))}))},previousPage:function(){a.click(r.b,i())}};function i(){return angular.extend(o(),{mop_type:"CC"})}function o(){return t?{cc_bin:parseInt(t)}:{}}}])},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaClientSubscription",["bpaOauth2Http",function(e){var t;return{subscribe:function(n){var r=(new Date).toISOString();return e.post(t,{planId:n,isInterstitialFlow:0,interstitialType:0,currentUri:null,referrerUri:null,pageDate:r,ajaxDate:r})},setUrl:function(e){t=e}}}])},function(e,t,n){"use strict";n.r(t);n(18);angular.module("bpa-ui.components").component("bpaConfirmationModal",{bindings:{properties:"<",templateId:"<",onAccept:"<",onCancel:"<",onClose:"<",size:"<"},template:'\n            <up-c-modal custom-element\n                        id="{{vm.identifier}}"\n                        ng-on-closed="vm.handleClose($event)"\n                        ng-method-close="vm.close"\n                        size="{{vm.size}}"\n                        modal-footer-inverse>\n                <div ng-include="vm.getTemplateUrl()" class="ng-animate-disabled" bpa-include-replace onload="vm.templateDidLoad()"></div>\n            </up-c-modal>',controller:a,controllerAs:"vm"}),a.$inject=["bpaRouting","bpaScreenSize","$timeout","$element","$document"];var r=0;function a(e,t,n,a,i){var o=this;this.identifier="".concat(this.templateId,"-").concat(r++),this.isSmallScreen=function(){return t.isSmallScreen()},this.getTemplateUrl=function(){return e.get(o.templateId)},this.templateDidLoad=function(){var e=function(){return i[0].getElementById(o.identifier)};e().componentOnReady().then((function(){o.modalElement=e();var t=o.modalElement.querySelector("[slot='header-title']");o.modalElement.setAttribute("page-title",t&&t.innerText),o.modalElement.open()}))},this.result=null,this.ok=function(){o.result=!0,o.close()},this.cancel=function(){o.result=!1,o.close()},this.handleClose=function(e){"UP-C-MODAL"===e.target.tagName&&(o.result&&angular.isFunction(o.onAccept)?o.onAccept():!1===o.result&&angular.isFunction(o.onCancel)?o.onCancel():angular.isFunction(o.onClose)&&o.onClose())}}},function(e,t,n){"use strict";n.r(t);n(4);var r=n(8);angular.module("bpa-ui.factories").factory("bpaCountryState",(function(){return{getByCountry:function(e){var t=new Map([[r.c,[{name:"Armed Forces Americas",code:"AA"},{name:"Armed Forces Europe / Canada / Middle East / Africa",code:"AE"},{name:"Alabama",code:"AL"},{name:"Alaska",code:"AK"},{name:"Armed Forces Pacific",code:"AP"},{name:"Arizona",code:"AZ"},{name:"Arkansas",code:"AR"},{name:"California",code:"CA"},{name:"Colorado",code:"CO"},{name:"Connecticut",code:"CT"},{name:"Delaware",code:"DE"},{name:"District of Columbia",code:"DC"},{name:"Florida",code:"FL"},{name:"Georgia",code:"GA"},{name:"Hawaii",code:"HI"},{name:"Idaho",code:"ID"},{name:"Illinois",code:"IL"},{name:"Indiana",code:"IN"},{name:"Iowa",code:"IA"},{name:"Kansas",code:"KS"},{name:"Kentucky",code:"KY"},{name:"Louisiana",code:"LA"},{name:"Maine",code:"ME"},{name:"Maryland",code:"MD"},{name:"Massachusetts",code:"MA"},{name:"Michigan",code:"MI"},{name:"Minnesota",code:"MN"},{name:"Mississippi",code:"MS"},{name:"Missouri",code:"MO"},{name:"Montana",code:"MT"},{name:"Nebraska",code:"NE"},{name:"Nevada",code:"NV"},{name:"New Hampshire",code:"NH"},{name:"New Jersey",code:"NJ"},{name:"New Mexico",code:"NM"},{name:"New York",code:"NY"},{name:"North Carolina",code:"NC"},{name:"North Dakota",code:"ND"},{name:"Ohio",code:"OH"},{name:"Oklahoma",code:"OK"},{name:"Oregon",code:"OR"},{name:"Pennsylvania",code:"PA"},{name:"Rhode Island",code:"RI"},{name:"South Carolina",code:"SC"},{name:"South Dakota",code:"SD"},{name:"Tennessee",code:"TN"},{name:"Texas",code:"TX"},{name:"Utah",code:"UT"},{name:"Vermont",code:"VT"},{name:"Virginia",code:"VA"},{name:"Washington",code:"WA"},{name:"West Virginia",code:"WV"},{name:"Wisconsin",code:"WI"},{name:"Wyoming",code:"WY"}]],[r.a,[{name:"Alberta",code:"AB"},{name:"British Columbia",code:"BC"},{name:"Manitoba",code:"MB"},{name:"New Brunswick",code:"NB"},{name:"Newfoundland and Labrador",code:"NL"},{name:"Northwest Territories",code:"NT"},{name:"Nova Scotia",code:"NS"},{name:"Nunavut",code:"NU"},{name:"Ontario",code:"ON"},{name:"Prince Edward Island",code:"PE"},{name:"Quebec",code:"QC"},{name:"Saskatchewan",code:"SK"},{name:"Yukon",code:"YT"}]]]);return t.has(e)?t.get(e):[]}}}))},function(e,t,n){"use strict";n.r(t);n(5);function r(e,t,n){return{getAvailableLocalCurrencies:function(r,a,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,c=n.defer(),s=0,u=function n(){t.get(e.buildUrl("get-cc-available-currencies",{billingAddressCountry:r,ccType:a,issuingCountry:i}),{cache:!0}).then((function(e){return c.resolve(e.data)})).catch((function(){s<o?(s++,n()):c.reject()}))};return u(),c.promise}}}angular.module("bpa-ui.factories").factory("bpaCurrency",r),r.$inject=["bpaUrl","bpaOauth2Http","$q"]},function(e,t,n){"use strict";n.r(t);n(18),n(14),n(91),n(10);function r(e,t,n,r,a){var i=this,o="verification",c="subscription",s="CC",u="ACH",l="ACH_DEPOSIT",d=null,f=!1,p=!1,m=this,g=t({initial:"loading",transitions:[{from:"loading",to:o,can:function(e,t){return angular.isDefined(t.mop_data)&&-1!==[s,u,l].indexOf(t.mop_data.type)&&"in_progress"===t.mop_data.verification},on:function(e,t,n){b(t,n),m.mopData=n.mop_data,n.mop_data.primary&&(m.config.allowPrimary=!1),y()}},{from:[o,"loading"],to:c,can:function(e,t){return m.config.enableSubscription&&angular.isDefined(t.mop_data)&&-1!==[s,l].indexOf(t.mop_data.type)&&"verified"===t.mop_data.verification&&t.primary&&t.subscription_plan},on:function(t,n,r){o===t&&e.setMethodOfPaymentInfo(r.mop_data),b(n,r),n.subscribed=!1,m.subscriptionInfo={id:r.mop_data.id,primary:r.primary,plan:r.subscription_plan,type:r.mop_data.type},"loading"===t&&y()}},{from:["loading",o,c],to:"success",can:!0,on:function(e,t,n){b(t,n),t.subscribed=n.subscribed,h(t)}}]});function b(e,t){angular.isDefined(t.mop_data)&&(e.mopRid=t.mop_data.id,e.mopType=t.mop_data.type,e.verified="verified"===t.mop_data.verification),angular.isDefined(t.primary)&&(e.primary=t.primary),angular.isArray(t.messages)&&n.addAlertMessages(t.messages)}function h(e){d=v(e),p?m.close():m.handleClose()}function v(e){return{success:!0,mopData:{id:e.mopRid,verified:e.verified,primary:e.primary,type:e.mopType,subscribed:e.subscribed}}}function y(){a((function(){m.onReady().then((function(){m.open(),p=!0}))}))}e.getMethodOfPaymentInfo(this.mopRid,(function(e){g.traverse({mop_data:e})}),(function(){f=!0;var t=e.getAccountingEntityRid();n.clearMessages(t),n.addFatalErrorMessage(t),i.handleClose()})),this.pageTitles={},this.verifyCallbackObject={success:function(e){g.traverse(e)}},this.subscriptionCallbackObject={success:function(){var e=g.getContext();g.traverse({mop_data:{id:e.mopRid,verification:"verified",type:e.mopType},primary:!0,subscribed:!0})}},this.getPageTitle=function(){var e="";return i.isVerification()?e=i.isDisbursementMethod()?"disbursement":"billing":i.isSubscription()&&(e="subscription"),e?i.pageTitles[e]:""},this.isLoading=function(){return g.isState("loading")},this.isSubscription=function(){return g.isState(c)},this.isVerification=function(){return g.isState(o)},this.cancelVerification=function(){d=!1,i.close()},this.cancelSubscription=function(){h(g.getContext())},this.isBlocked=function(){return!(!i.isLoading()||f)||[{state:o,iface:i.verifyInterface},{state:c,iface:i.subscriptionInterface}].filter((function(e){return g.isState(e.state)&&e.iface&&e.iface.isBlocked()})).length>0},this.isDisbursementMethod=function(){return g.getContext().mopType===u},this.handleClose=function(){null===d&&i.isSubscription()&&(d=v(g.getContext())),d?i.onSuccess(d):!1===d?i.onCancel():i.onClose()},this.isSmallScreen=function(){return r.isSmallScreen()}}angular.module("bpa-ui.components").component("bpaVerifyMopModal",{bindings:{config:"<",mopRid:"<",onSuccess:"<",onCancel:"<",onClose:"<"},templateUrl:["bpaRouting",function(e){return e.get("template-verify-mop-modal")}],controller:r,controllerAs:"vm"}),r.$inject=["bpa","bpaStateMachine","bpaAlert","bpaScreenSize","$timeout"]},function(e,t,n){"use strict";n.r(t);n(10);function r(e,t,n){var r=!1;return{openModal:function(a){if(r)return null;return e.clearMessages(a,"add-paypal-modal"),n((function(e,n){t.open("bpa-pay-pal-modal",{currentAccountRid:a,onSuccess:function(t){return e(t)},onCancel:function(){return n("cancel")},onClose:function(){return n("close")}}),r=!0})).finally((function(){return r=!1}))}}}angular.module("bpa-ui.factories").factory("bpaPayPal",r),r.$inject=["bpaAlert","gcModal","$q"]},function(e,t,n){"use strict";n.r(t);n(4),n(5);angular.module("bpa-ui.factories").factory("bpaDisbursementSchedule",["$q","bpaOauth2Http","bpaUrl",function(e,t,n){return{save:function(r,a){return e((function(e,i){t.post(n.disbursementMethodsActionUrl(r,"save-schedule"),{disbursement_schedule_form:a}).then((function(t){t.data&&t.data.schedule?e(t.data):i(t.data)}),(function(){return i()}))}))}}}])},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaEventLog",["oLog","eoModelFactory",function(e,t){var n,r=angular.extend({setFlowName:function(e){n=e},logEvent:function(n,r,a,i){var o={event:n,location:r};i&&(o.sublocation=i),a&&(angular.isArray(a)?o.data=a:o.data=[a]),e.event(t.get("Event",o))},logErrors:function(e,t,n,a,i){var o=this,c=function(a){return o.logBpaEvent(r.EVENT_IMPRESSION,e,angular.extend({event_label:n,event_message:a||"Undefined error"},i||{}),t)};angular.isArray(a)?angular.forEach(a,c):angular.isString(a)?c(a):c()},logBpaEvent:function(e,t,r,a){!(r=r||{}).flow&&n?r.flow=n:r.flow||(r.flow="undefined"),this.logEvent(e,t,r,a)},logLoadingFailure:function(e,t,n){this.logErrors(e,t,r.LABEL_ERROR_3RD_PARTY,n)},getConstants:a},a());return r;function a(){return{get EVENT_CLICK(){return"click"},get EVENT_IMPRESSION(){return"impression"},get EVENT_PAGE(){return"page"},get LABEL_SUCCESS_UPM_ADDED(){return"success_event_upm_added"},get LABEL_ERROR_PROCESSING(){return"error_event_processing_errors"},get LABEL_ERROR_VALIDATION(){return"error_event_validation_errors"},get LABEL_ERROR_3RD_PARTY(){return"error_event_third_party_script"},get LABEL_CANCEL(){return"cancel"},get LABEL_SAVE(){return"save"},get LABEL_BACK(){return"back"},get LABEL_START_SCREEN(){return"start_screen"}}}}])},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaFlashMessage",["bpaOauth2Http","bpaUrl",function(e,t){var n=[],r=[];return{getMessages:function(e){return e?n.filter((function(t){return!t.aeRid||parseInt(t.aeRid)===parseInt(e)})):n},fetchMessages:function(a){e.post(t.baseUrl(!1)+(a?a+"/":"")+"get-messages",{specialMessages:r}).success((function(e){n=e&&e.length>0?e:[]}))},setSpecialMessages:function(e){r=e}}}])},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaFormMode",[function(){var e=document.querySelectorAll(".js-bpa-mode-switcher.js-mode-stub");return{isStub:e=!(!e||!e.length),isNormal:!e}}])},function(e,t,n){"use strict";n.r(t);n(4),n(5);angular.module("bpa-ui.factories").factory("bpaGetBankInfo",["bpaOauth2Http","$q","bpaUrl",function(e,t,n){var r={};return{get:function(a){return t((function(t,i){if(void 0===r[a])return e.get(n.baseUrl()+"bank-details/USA/"+a).then((function(e){e.data&&e.data.bank&&e.data.bank.name?(r[a]=e.data.bank,t(e.data.bank)):i({code:500,message:"Unexpected response"})}),(function(e){i({code:e.status,message:e.statusText})}));t(r[a])}))}}}])},function(e,t,n){"use strict";n.r(t);n(4);angular.module("bpa-ui.factories").factory("bpaGtmEvents",["$window",function(e){var t=angular.isDefined(e.dataLayer)?e.dataLayer:null,n={event:"billingEvents",eventCategory:"Billing"};return{postSuccessEvent:function(e){r(angular.extend({},{eventLabel:"Success"},e))},postFailureEvent:function(e){r(angular.extend({},{eventLabel:"Fail"},e))},postCancelEvent:function(e){r(angular.extend({},{eventLabel:"Cancel"},e))},postClickEvent:function(e,t){e&&r({eventAction:t&&1==t?"Click":"click",eventLabel:e})}};function r(e){t&&t.push(angular.extend({},n,e))}}])},function(e,t,n){"use strict";n.r(t);n(4);var r=n(2);angular.module("bpa-ui.factories").factory("bpaVerifyMopEventLogger",["bpaEventTrackerFactory",function(e){var t,n,a=e.create(r.t),i={setMopType:function(e){t=e},setMakePrimary:function(e){n=e},submitClick:function(){a.click("verify",i.getEventData(!0))},submitSuccess:function(){a.click("success_event_mop_verified",i.getEventData(!0))},submitProcessingFailure:function(e){angular.forEach(e,(function(e){return a.impression(r.e,angular.extend({status_message:e},i.getEventData(!0)))}))},submitValidationFailure:function(e){angular.forEach(e,(function(e){return a.impression(r.g,angular.extend({status_message:e},i.getEventData(!0)))}))},getEventData:function(e){var r={mop_type:t};return e&&(r.state_make_primary=n),r}};return i}])},,,,,,function(e,t,n){"use strict";t.a={name:"components.core.typeahead"}},function(e,t,n){"use strict";t.a={name:"components.core.tokenizer"}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){n(83),e.exports=n(735)},function(e,t,n){"use strict";var r=angular.module("bpa-ui",["components.core.time","components.core.validation","components.core.block","components.core.modal","components.core.fields.intlPhoneNumber","components.core.fields.input","components.core.popover","components.core.alert","components.core.authorization.oauth2","components.core.analytics","components.core.editable","components.core.templates","components.core.smf","components.core.select","components.core.countries.services","components.core.channels","components.core.customElement","components.core.gcModal","components.core","ngAnimate","ngRoute","ngResource","ngMessages","ngCookies","bpa-ui.constants","bpa-ui.directives","bpa-ui.factories","bpa-ui.controllers","bpa-ui.interceptors","bpa-ui.components","fe.components.upAddressAutocomplete"]);r.config(["$animateProvider",function(e){e.classNameFilter(/^((?!(ng-animate-disabled)).)*$/)}]),r.config(["$httpProvider",function(e){e.interceptors.push("bpaTemplateLoadingError"),e.interceptors.push("bpaRequirementsNotMet")}])},function(e,t,n){var r={"./base.js":4,"./bpa-add-billing-method.js":35,"./bpa-alert.js":10,"./bpa-balance.js":248,"./bpa-bank-account-event-logger.js":249,"./bpa-block-mode.js":90,"./bpa-cached-post-request.js":89,"./bpa-cc-event-logger.js":250,"./bpa-client-subscription.js":251,"./bpa-confirmation.js":42,"./bpa-country-state.js":253,"./bpa-currency.js":254,"./bpa-deposit-methods.js":43,"./bpa-disburse.js":44,"./bpa-disbursement-schedule.js":257,"./bpa-environment.js":92,"./bpa-event-log.js":258,"./bpa-flash-message.js":259,"./bpa-form-mode.js":260,"./bpa-form-validation.js":45,"./bpa-get-bank-info.js":261,"./bpa-gtm-events.js":262,"./bpa-hash-action.js":61,"./bpa-instant-pay.js":60,"./bpa-iovation.js":27,"./bpa-network-errors.js":93,"./bpa-paypal.js":256,"./bpa-plaid-event-logger.js":62,"./bpa-requirements-not-met-handler.js":63,"./bpa-screen-size.js":19,"./bpa-state-machine.js":91,"./bpa-subscription-event-logger.js":94,"./bpa-tax-info.js":22,"./bpa-three-ds.js":64,"./bpa-url.js":5,"./bpa-validation-errors.js":95,"./bpa-vars.js":13,"./bpa-verify-mop-event-logger.js":263,"./bpa-verify-mop.js":51,"./bpa.js":14,"./cookie-manager.js":65,"./credit-cards.js":37,"./external-scripts.js":36,"./plaid.js":52};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=606},function(e,t,n){var r={"./add-billing-method.js":608,"./add-primary-payment-button.js":609,"./bank-account-form.js":610,"./bank-account-plaid-form.js":611,"./bank-account-plaid-modal-form.js":612,"./bank-account-temporary-deposits.js":613,"./base.js":1,"./billing-address-form.js":614,"./bpa-aba-validate.js":615,"./bpa-address.js":616,"./bpa-alert-messages.js":617,"./bpa-amount-input.js":618,"./bpa-async-indicator.js":619,"./bpa-base-form.js":620,"./bpa-bind-compile.js":621,"./bpa-card-number-decorator.js":622,"./bpa-card-number.js":623,"./bpa-card-phone.js":624,"./bpa-check-vat-format.js":625,"./bpa-credit-card-form.js":626,"./bpa-deposit-methods-action.js":627,"./bpa-disburse-flow.js":628,"./bpa-external-scripts.js":629,"./bpa-flash-messages.js":630,"./bpa-form-action-url.js":631,"./bpa-form-controls.js":632,"./bpa-form-page.js":633,"./bpa-have-letter.js":634,"./bpa-help-popover.js":635,"./bpa-include-replace.js":636,"./bpa-input-group.js":637,"./bpa-location.js":638,"./bpa-maxlength-link.js":639,"./bpa-methods-page-link.js":640,"./bpa-model.js":641,"./bpa-paypal-button-placeholder.js":642,"./bpa-paypal-button.js":643,"./bpa-phone.js":644,"./bpa-prevent-leave.js":645,"./bpa-routing-number.js":646,"./bpa-secured-field.js":647,"./bpa-select.js":648,"./bpa-set-location.js":649,"./bpa-show-bank-info.js":650,"./bpa-show-tax-info.js":651,"./bpa-show-tax-residency.js":652,"./bpa-show-vat-info.js":653,"./bpa-tax-residency-form.js":654,"./bpa-validate-tin.js":655,"./bpa-var.js":656,"./bpa-vat-group.js":657,"./bpa-zip.js":658,"./choice-model-init.js":659,"./client-plan-subscription.js":660,"./deposit-methods.js":661,"./financial-account-selector.js":662,"./mpesa-form.js":663,"./pay-due-form.js":664,"./payment-method-selector.js":665,"./tax-info-form.js":666,"./vat-info-form.js":667,"./verify-payment-method.js":668};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=607},function(e,t,n){"use strict";n.r(t);n(1),n(35),n(10),n(5),n(13),n(14),n(52),n(94),n(91),n(19),n(63),n(92),n(64),n(12);var r=n(2);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}angular.module("bpa-ui.directives").directive("addBillingMethod",["bpaAddBillingMethod","bpaAlert","bpaUrl","bpaVars","bpa","plaid","bpaEventTrackerFactory","bpaSubscriptionEventLogger","bpaStateMachine","bpaScreenSize","$timeout","$templateCache","$document","ACCOUNTING_ENTITY_KEY","bpaRequirementsNotMetHandler","bpaEnvironment","bpaThreeDs","$q",function(e,t,n,i,o,c,s,u,l,d,f,p,m,g,b,h,v,y){var A="CC",S="ACH_DEPOSIT",C="PAYPAL_DEPOSIT",E="BALANCE",k="create_upm",M="billing_address",_="verification",I="subscription",F=s.create(r.q);return{restrict:"E",scope:{callbackObject:"=?",interfaceObject:"=?",skipVerification:"<",forcePrimary:"<",returnPaymentData:"<",formLockSelector:"@",ccFormLockSelector:"@",productChargeAmount:"@",enableSubscription:"<",updateBillingAddress:"<",submitLabel:"@",defaultMode:"<"},templateUrl:e.getTemplateUrl(),controller:["$scope",function(p){var P,w,D=!0,T=!1,O=!1,R=!1,j={},N={},L=[],$=!1,U=l({initial:k,transitions:[{from:k,to:M,can:function(e,t){return p.updateBillingAddress&&!angular.isUndefined(t.mop_data)&&t.mop_data.type===C&&"proposed"===t.mop_data.address_update},on:function(e,t,n){x(t,n),t.verified=!0,n.mop_data.billing_address instanceof Object&&(p.billingAddress=n.mop_data.billing_address)}},{from:k,to:_,can:function(e,t){return!p.skipVerification&&!angular.isUndefined(t.mop_data)&&t.mop_data.type===A&&"in_progress"===t.mop_data.verification},on:function(e,t,n){x(t,n),t.verified=!1,p.verificationMopRid=n.id,p.allowPrimary=!n.primary}},{from:[k,_],to:I,can:function(e,t){return p.enableSubscription&&!angular.isUndefined(t.mop_data)&&-1!==[A,S].indexOf(t.mop_data.type)&&("verified"===t.mop_data.verification||1===t.verified)&&t.subscription_plan},on:function(e,t,n){x(t,n),t.verified=!0,u.setMopType(n.mop_data.type),p.subscriptionInfo={id:n.mop_data.id,primary:n.primary,plan:n.subscription_plan,type:n.mop_data.type}}},{from:[k,M,_,I],to:"success",can:!0,on:function(e,t,n){-1!==[k,_].indexOf(e)?(x(t,n),t.verified=!angular.isUndefined(n.verify)&&"1"!==n.verify||!angular.isUndefined(n.verified)&&1===n.verified):M===e&&o.updateMethodOfPaymentInfo(t.mopRid,{billing_address:n.billing_address,address_update:n.address_update}),W(t.mopRid,t.verified,angular.isUndefined(n.mop_data)?p.mode:n.mop_data.type)}}]});function x(e,n){var r;n&&(n.messages&&(r=n.messages)&&r.length>0&&t.addAlertMessages(r),n.mop_data?(o.setMethodOfPaymentInfo(angular.extend({},n.mop_data,n.hasOwnProperty("primary")?{primary:n.primary}:{})),e.mopRid=n.mop_data.id):n.id&&(e.mopRid=n.id))}function B(e){N[e]=!0,V()}function V(){if(!O&&T&&p.availableMethods){for(var e in p.availableMethods)if(p.availableMethods.hasOwnProperty(e)&&!N[e])return;D=!1,p.mode=function(){if(p.defaultMode&&p.hasMethod(p.defaultMode))return p.defaultMode;return L.find((function(e){return p.hasMethod(e)}))}(),f((function(){for(var e=m[0].querySelectorAll(".bpa-add-primary-payment .bpa-hide-loading"),t=0,n=e.length;t<n;t++)e[t].classList.remove("bpa-hide-loading");G(p.mode)}),300),f((function(){F.impression(s.LABEL_WIDGET_LOAD,{selected_upm:p.mode,available_upms:Object.keys(p.availableMethods)}),Z()})),O=!0}}function H(e,t){p.hasPaypalError=e,w=t}function q(){switch(U.getState()){case k:switch(p.mode){case S:return p.isManualBankAccountShown()?r.n:r.m;case A:return p.isCcBillingAddressFormActive()?r.k:r.o;case C:return r.p;case E:return r.s}break;case M:return r.k;case _:return r.t;case I:return r.r}}function G(e){z(e),clearInterval(P),P=setInterval((function(){z(e)}),300)}function z(e){if(T){var t=Y(e);if(t&&0!==t.content.clientHeight){var n=t.content.clientHeight+"px";n!==t.container.style.height&&(t.container.style.height=n)}}}function Y(e){if(!j[e]){var t,n=m[0].querySelector("#bpa-method-"+e+" .bpa-collapsed");n&&(t=n.querySelector(".bpa-content"),j[e]={container:n,content:t})}return j[e]}function W(e,t,n){p.callbackObject&&p.callbackObject.success&&K(e,t,n,p.callbackObject.success)}function K(e,t,n,r){p.returnPaymentData?o.getMethodOfPaymentInfo(e,(function(e){"object"===a(e)&&e&&e.type?r(e):J()}),(function(){J()})):r({mopRid:e,verified:t,type:n})}function J(e){p.callbackObject&&p.callbackObject.error&&p.callbackObject.error(e)}function Z(){F.impression(r.i,void 0,q())}e.setProductChargeAmount(p.productChargeAmount),p.hasPaypalError=!1,p.paypalLoadingFailure=!1,p.mode=null,p.verificationMopRid=null,p.billingAddress={},p.config={},p.requirementsError=null,void 0===p.forcePrimary&&(p.forcePrimary=1),p.formLockSelector||(p.formLockSelector="#bpa-add-primary-payment"),function(){p.interfaceObject||(p.interfaceObject={});p.interfaceObject.getSublocation=q,p.interfaceObject.getCurrentStep=function(){return p.isAddPaymentFormActive()&&!p.isCcBillingAddressFormActive()?"addBillingMethod":p.isVerificationFormActive()?"verification":p.isSubscriptionFormActive()?"subscription":p.isBillingAddressFormActive()||p.isCcBillingAddressFormActive()?"billingAddress":""},p.interfaceObject.getPaymentData=function(e){var t=U.getContext();t.mopRid?K(t.mopRid,t.verified,p.mode,e):e(null)}}(),p.$on("$destroy",(function(){return clearInterval(P)})),e.getAvailableDataPromise().then((function(e){p.availableMethods=angular.extend({},e.data),"object"===a(p.availableMethods.config)&&(angular.extend(p.config,p.availableMethods.config),delete p.availableMethods.config),V()}),(function(){D=!1,t.addFatalErrorMessage(i.get(g)),J()})),b.promise.then((function(e){p.requirementsError=e,J(p.requirementsError.code)})),p.templateLoaded=function(){T=!0,V()},p.cancelVerification=function(){W(p.verificationMopRid,!1,p.mode)},p.cancelBillingAddress=function(){W(U.getContext().mopRid,U.getContext().verified,p.mode)},p.cancelSubscription=function(){W(p.subscriptionInfo.id,!0,p.mode)},p.isSmallScreen=function(){return d.isSmallScreen()},p.isActive=function(e){return p.mode===e},p.isBlocked=function(){return!(!D&&!c.isFormBlocked())||[{state:M,iface:p.addressInterface},{state:_,iface:p.verifyInterface},{state:I,iface:p.subscriptionInterface},{state:k,iface:p.bankAccountInterface},{state:k,iface:p.creditCardInterface}].filter((function(e){return U.isState(e.state)&&e.iface&&e.iface.isBlocked&&e.iface.isBlocked()})).length>0},p.isManualBankAccountShown=function(){return $||R},p.hasPlaid=function(){return!R},p.addMethod=function(e){L.push(e),A!==e&&S!==e&&B(e)},p.hasMethod=function(e){return p.availableMethods&&void 0!==p.availableMethods[e]},p.useBalance=function(){W(null,!0,E)},p.ccCallbackObject={success:function(e){e?U.traverse(e):J()},pageChanged:function(){p.isActive(A)&&f((function(){return G(A)}),400),B(A)},error:function(e){e&&e.anotherBillingMethodSuggestion&&p.creditCardInterface.previousPage()},handleResponseData:function(e){if(!e.ccRequestId)return!0;var t=y.resolve(window.location.href),r=p.callbackObject;if(r&&r.threeDs)if(t=r.threeDs(e.ccRequestId)){if(!t.then)throw new Error("threeDs callback must return a promise")}else t=y.resolve(window.location.href);return t.then((function(t){var r={originReturnUrl:t.returnUrl||t};t.failureUrl&&(r.failureUrl=t.failureUrl),v.redirectToIssuer(e.ccRequestId,n.buildUrl("save-credit-card-3ds",{context:Applet.getOrganization().getUid(),accountingEntity:o.getAccountingEntityRid(),ccRequest:e.ccRequestId},r))})),!1}},p.isThreeDsEnabled=function(){return p.callbackObject&&p.callbackObject.threeDs},p.getSubmitLabel=function(){return p.submitLabel?p.submitLabel:i.get("addUpmDefaultSubmitLabel")},p.plaidCallbackObject={blockForm:function(){D=!0},unblockForm:function(){D=!1},success:function(e){D=!1,c.setFormBlocked(!1),e?c.closeModal().then((function(){return U.traverse(e)})):J()},error:function(){c.setFormBlocked(!1)},showManual:function(){$=!0},loadingFailure:function(){R=!0}},p.ppCallbackObject={init:function(){H(!1)},success:function(e,t){D=!1,U.traverse({id:t.id,verified:1,messages:e,mop_data:t})},authorize:function(){D=!0},error:function(e){D=!1,H(!0,e)},loadingFailure:function(){D=!1,p.paypalLoadingFailure=!0},cancel:function(){D=!1}},p.verifyCallbackObject={success:function(e){U.traverse(e)}},p.baCallbackObject={success:function(e){e?U.traverse(e):J()},pageChanged:function(){p.isActive(S)&&f((function(){G(S)}),400),B(S)},showPlaid:function(){$=!1}},p.subscriptionCallbackObject={success:function(){U.traverse({id:p.subscriptionInfo.id,primary:!0,verified:1})}},p.addressCallbackObject={success:function(e){U.traverse(e)}},p.$watch("mode",(function(e,t){t&&e!==t&&(F.click(r.c,{from_upm:t,to_upm:e}),Z(),Y(t).container.style.height="0",G(e))})),p.paypalGetError=function(e){return w||e},p.isAddPaymentFormActive=function(){return U.isState(k)},p.isSubscriptionFormActive=function(){return U.isState(I)},p.isVerificationFormActive=function(){return U.isState(_)},p.isBillingAddressFormActive=function(){return U.isState(M)},p.isCcBillingAddressFormActive=function(){return U.isState(k)&&p.isActive(A)&&p.creditCardInterface&&p.creditCardInterface.isLastPage()},p.isNativeApp=function(){return h.isNativeApp()}}]}}])},function(e,t,n){"use strict";n.r(t);n(1),n(5),n(14),n(35),n(63),n(37);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}angular.module("bpa-ui.directives").directive("addPrimaryPaymentButton",["bpaUrl","bpa","bpaAddBillingMethod","bpaRequirementsNotMetHandler","CreditCards",function(e,t,n,a,i){return{scope:{callbacks:"=?",buttonClass:"@",buttonLabel:"@",productChargeAmount:"@",updateBillingAddress:"<",popupSubmitLabel:"@"},templateUrl:e.baseUrl()+"add-primary-method/add-button",link:function(e){function o(e){s("close",e),e&&e.threeDs||c()}function c(){e.isLoading=!0,t.getMethodOfPaymentInfo(null,(function(t){"object"===r(t)&&t?t.type?(e.paymentData=t,s("success",t)):n.preFetchData(t.new_card_form):s("error"),e.isLoading=!1}),(function(t){e.isLoading=!1,e.isError=!0,s("error",t)}))}function s(t,n){e.callbacks&&e.callbacks[t]&&e.callbacks[t](n)}n.setProductChargeAmount(e.productChargeAmount),e.isError=!1,e.requirementsError=null,a.promise.then((function(t){e.requirementsError=t,s("error",e.requirementsError.code)})),c(),e.click=function(){s("click"),n.show({forcePrimary:1,updateBillingAddress:e.updateBillingAddress,popupSubmitLabel:e.popupSubmitLabel,threeDsCallback:e.callbacks.threeDs}).then(o,o)},e.isVerificationInProgress=function(){return e.paymentData&&"in_progress"===e.paymentData.verification},e.isPrimaryPayment=function(){return!!e.paymentData},e.getAddButtonLabel=function(t){return e.buttonLabel||t},e.getAddButtonClass=function(t){return e.buttonClass||t},e.getPaymentIconClass=function(){if(e.paymentData)switch(e.paymentData.type){case"CC":return"bpa-cards-icon-img bpa-cards-icon bpa-primary-payment-icon bpa-cards-icon-"+i.cardTypeToBrand(e.paymentData.card_type);case"PAYPAL_DEPOSIT":return"bpa-primary-payment-icon bpa-payment-icon-paypal"}return""}}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(5),n(27),n(249),n(66);angular.module("bpa-ui.directives").directive("bankAccountForm",["bpaUrl","eoModal","$timeout","$document","bpaIovation","bpaBankAccountEventLogger",function(e,t,n,r,a,i){return{restrict:"E",scope:{cancelUrl:"@",removeMopUrl:"@",recordId:"@",mopType:"@",isModern:"@",forcePrimary:"@",aeType:"@",modeUsUs:"@",enableBackButton:"<",pagedSubmitLabel:"@",callbackObject:"<"},require:"bpaBaseForm",templateUrl:function(t,n){var r=n.mopType&&"deposit"===n.mopType?"bank-account-form":"direct-deposit-form",a="1"===n.isModern?"modern-":"",i=n.recordId?e.formUrl("edit-"+r):e.formUrl(a+"add-"+r);return i&&"/"===i[0]&&(n.recordId&&(i+="/"+n.recordId),i+="?"+Date.now()),i},link:function(e,r,o,c){c.init(e,r,"ach").setSubmit((function(t){e.ach_form.$valid&&(e.bpaFormData.forcePrimary=e.forcePrimary,a.updateScope(e,(function(){return c.sendFormData(e.bpaFormData,t)})))})),c.setEventLogger(i),e.commObject=c.getInterfaceObject(),e.commObject.isBlocked=function(){return c.isScreenLocked("form")};var s=e.commObject.isSubmitAllowed.bind(e.commObject);e.commObject.isSubmitAllowed=function(){return!e.ach_form.$pending&&s()},"deposit"!==e.mopType&&c.setRemoveAction((function(){t.custom({locals:{_injectedProperties:{}},keyboard:!1,controller:"yesNoModalController",templateUrl:"removalWarning.html"}).result.then((function(){e.removeMopUrl&&(document.location=e.removeMopUrl)}),(function(){}))})),r[0].querySelector(".bpa-flash-messages")&&c.setNeedAttention(),e.revalidateRoutingNumber=function(){c.revalidateField("routingNumber")},e.backToPlaid=function(){var t,r,a;t="showPlaid",e.callbackObject[t]&&n((function(){return e.callbackObject[t](r,a)})),i.backToPlaid()};var u=e.callbackObject.error;e.callbackObject.error=function(){c.waitOnPendingValidators(1e4).finally((function(){var e=c.getCtrlByModelName("routingNumber");e&&e.$invalid&&e.$viewValue&&i.logAbaValidationError(e.$viewValue)})),u&&u()}},controller:["$scope",function(e){e.accountHint={class:"hint-check",text:"&nbsp;<br />&nbsp;",update:function(t){if("blur"===t.type)e.accountHint.class="hint-check",e.accountHint.text="&nbsp;<br />&nbsp;";else if("focus"===t.type){var n=angular.element(t.target);e.accountHint.text=n.attr("data-account-hint-text"),e.accountHint.class=n.attr("data-account-hint-class")}}},e.bankInfo={}}]}}])},function(e,t,n){"use strict";n.r(t);n(1),n(5),n(52),n(35),n(13),n(62),n(12);angular.module("bpa-ui.directives").directive("bankAccountPlaidForm",["bpaUrl","plaid","bpaAddBillingMethod","$timeout","bpaVars","bpaPlaidEventLogger","DEPOSIT_METHODS_URL_PART",function(e,t,n,r,a,i,o){return{restrict:"E",scope:{accountTypes:"<",forcePrimary:"@",processingFee:"<",callbackObject:"<"},templateUrl:e.resourceUrl(o+"/partials/bank-account-plaid.html"),link:function(e){var n=20,a=0,o=!1;function c(){t.isPlaidLoaded()?t.getPlaidHandler().open():(a===n?(a=0,o=!0,t.closeModal()):r(c,1e3),a++)}function s(t,n,a){e.callbackObject[t]&&r((function(){return e.callbackObject[t](n,a)}))}function u(){r((function(){s("unblockForm"),r((function(){return c()}),2e3)}))}e.showPlaidModal=function(){s("blockForm"),t.openModal({accountTypes:e.accountTypes,callbackObject:e.callbackObject,forcePrimary:e.forcePrimary,onOpened:u})},e.showManual=function(){s("showManual"),i.logStartScreenManual()},e.isNetworkError=function(){return t.hasNetworkError()||o},e.isPlaidAccountsEmpty=function(){return t.isPlaidAccountsEmpty()},t.initPlaid((function(){e.loadingFailure=!0,i.logStartScreenManual(),s("loadingFailure")}))}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(5),n(27),n(52),n(62),n(19);angular.module("bpa-ui.directives").directive("bankAccountPlaidModalForm",["bpaUrl","bpaIovation","plaid","bpaPlaidEventLogger","bpaScreenSize",function(e,t,n,r,a){return{restrict:"E",scope:{accountTypes:"<",forcePrimary:"@"},require:"bpaBaseForm",templateUrl:function(){return e.baseUrl(!0)+"add-plaid-bank-account-form.html"},link:function(e,i,o,c){c.init(e,i,"plaidForm").setSubmit(d),c.setEventLogger(r);var s=!1,u=c.getInterfaceObject(),l=u.submit;function d(r){n.setFormBlocked(!0),e.setSubmitAttempt(!1);var a=n.getAccounts()[e.bpaFormData.bankAccount],i={routingNumberEncrypted:a.routingEncrypted,accountNumberEncrypted:a.accountEncrypted,accountType:a.subtype,ownerType:e.bpaFormData.combinedAccount[e.bpaFormData.bankAccount],beneficiaryName:e.bpaFormData.beneficiaryName,plaidAccountId:a.accountId,plaidAccessTokenEncrypted:n.getAccessTokenEncrypted(),primaryStatus:e.forcePrimary?"1":e.bpaFormData.primaryStatus?"1":"0"};t.setBlackBox(i,(function(){c.sendFormData(i,r)}))}u.submit=function(){r.setMakePrimary(e.forcePrimary?void 0:e.primaryStatusCheck),e.setSubmitAttempt(!0),l()},e.bpaFormData={combinedAccount:[],bankAccount:null},void 0!==e.primaryStatusCheck&&(e.bpaFormData.primaryStatus=e.primaryStatusCheck),e.$watch("bpaFormData.bankAccount",(function(t,n){n!==t&&(e.setSubmitAttempt(!1),e.plaidForm.radioGroup.$setPristine())})),e.getBankAccountString=function(){return n.getBankAccounts()},e.isSmallScreen=function(){return a.isSmallScreen()},e.getAccounts=function(){return n.getAccounts()},e.isAccountsLoaded=function(){return n.getAccounts().length>0},e.isSubmitAttempt=function(){return s},e.setSubmitAttempt=function(e){return s=e}}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bankAccountTemporaryDeposits",[function(){return{restrict:"E",scope:{gotItUrl:"@"},templateUrl:"bpaBankAccountTemporaryDeposits.html"}}])},function(e,t,n){"use strict";n.r(t);n(1),n(5);var r=n(8),a=n(2);angular.module("bpa-ui.directives").directive("billingAddressForm",["bpaUrl","bpaRouting","bpaCountryService","bpaEventTrackerFactory",function(e,t,n,i){var o=i.create(a.k);return{restrict:"E",require:"bpaBaseForm",scope:{addressData:"=?",callbackObject:"=?",enableAddressLookup:"<"},templateUrl:t.get("template-billing-address-form"),link:function(t,i,c,s){var u=!1;function l(){return{mop_type:t.mopType}}function d(){return u||s.isScreenLocked("form")}function f(e){if(s.isValid()){var n=angular.extend({},t.billingAddress);-1===[r.c,r.a].indexOf(n.country)&&delete n.state,s.sendFormData(n,e)}}s.init(t,i,"billingAddress"),s.setActionUrl(e.baseUrl(!1)+"billing-address"),s.setSubmit(f),s.setCheckSuccessResponse((function(e){return Boolean(e.status)})),s.setEventLogger({submitSuccess:function(){o.click("success_billing_address_saved",l())},submitProcessingFailure:function(e){o.messages(a.e,e,l())},submitValidationFailure:function(e){o.messages(a.g,e,l())}}),t.billingAddress={},s.getInterfaceObject().isBlocked=d,t.$watch("addressData",(function(e){if(!e||angular.equals({},e))return;t.billingAddress&&!angular.equals({},t.billingAddress)||(u=!0,n.get().then((function(n){var a={country:e.country,state:e.state,city:e.city,street:e.street,street2:e.street2,zip:e.zip,phone:e.phone},i=n.find((function(e){return e.name===a.country||e.code3===a.country}));i&&(a.country=i.code3,a.state=a.country===r.c?{stateUsa:a.state}:a.country===r.a?{stateCanada:a.state}:{},t.billingAddress=a)})).finally((function(){u=!1})))}))}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(261);angular.module("bpa-ui.directives").directive("bpaAbaValidate",["$q","bpaGetBankInfo","$parse",function(e,t,n){return{restrict:"A",require:"ngModel",link:function(r,a,i,o){var c,s=n(i.bankInfoModel);function u(){c&&0===c.promise.$$state.status||(c=e.defer())}o.$asyncValidators.bpaAbaValidate=function(n){return e((function(e,a){u(),t.get(n).then((function(t){s.assign(r,t),e(),c.resolve()}),(function(t){404===t.code?(a(),c.resolve(),s.assign(r,{})):(e(),c.reject(),s.assign(r,null))}))}))},o.$asyncValidators.bpaAbaValidationError=function(){return u(),c.promise}}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(253),n(22),n(10);var r=n(8);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n,i,o){return{restrict:"E",scope:{model:"=ngModel",onCountryChange:"&",showPhone:"@",enableAddressLookup:"<",postalCodeRequired:"<?",showJurisdictions:"<?",interfaceObject:"=?",editingDisabled:"<?"},require:{ngModel:"ngModel",bpaBaseForm:"?^^bpaBaseForm",bpaFormPage:"?^^bpaFormPage"},templateUrl:e.get("template-address-form"),link:function(e,c,s,u){var l="address",d={street:"",street2:"",city:"",state:{stateUsa:"",stateCanada:""},zip:"",jurisdictionId:""},f=0;function p(t){angular.merge(e.model,d),void 0!==t&&angular.merge(e.model,{street:t.street,zip:t.zip,city:t.city,state:{stateUsa:t.state}});var n=e[l][l+"[street2]"];n.element&&n.element.val(e.model.street2)}function m(){if(e.jurisdictionList=[],e.showJurisdictions&&e.model.country){var t=e.countryList.find((function(t){return t.code3===e.model.country}));t&&(f++,i.getJurisdictions(t.code3).then((function(t){return e.jurisdictionList=t})).catch((function(){return o.addFatalErrorMessage()})).finally((function(){return f--})))}}function g(e,t){return e.code3===r.c?-1:t.code3===r.c?1:0}e.countryList=[],e.jurisdictionList=[],e.canStateList=n.getByCountry(r.a),e.usaStateList=n.getByCountry(r.c),e.model?e.model.state instanceof Array&&(e.model.state={}):e.model=angular.extend({},d,{country:"",phone:""}),function(){!u.ngModel.$options.updateOnDefault&&u.ngModel.$options.updateOn&&(u.ngModel.element=c,c.on(u.ngModel.$options.updateOn,(function(t){var n;n=function(e){e.element||(e.element=angular.element(c[0].querySelector('[name="'+e.$name+'"]'))),e.element&&e.element.triggerHandler(t.type),u.bpaBaseForm&&u.bpaBaseForm.setViewValueToElement(e),e.$setDirty(),e.$validate()},angular.forEach(e[l],(function(e,t){"$"!==t[0]&&"object"===a(e)&&e.$name&&n(e)}))})));u.bpaBaseForm&&u.bpaBaseForm.addController(s.ngModel,s,u.ngModel);u.bpaFormPage&&u.bpaFormPage.addController(u.ngModel);f++,t.get().then((function(t){e.countryList=t.sort(g),m()})).catch((function(){return o.addFatalErrorMessage()})).finally((function(){return f--}))}(),e.gmapi={noStreetNumberError:!1,notFoundError:!1,isActive:function(){return e.enableAddressLookup&&e.isCountry(r.c)},errorNoStreetNumber:function(){this.noStreetNumberError=!0},errorNotFound:function(){this.notFoundError=!0},fillAddress:function(e){p(e),this.clearGmapiErrors()},clearGmapiErrors:function(){angular.extend(this,{noStreetNumberError:!1,notFoundError:!1})}},e.interfaceObject={isLoading:function(){return f>0},clearAutocomplete:function(){e.gmapi.fullAddress=""}},e.$watch("gmapi.fullAddress",(function(t){t||e.gmapi.clearGmapiErrors()})),e.$watch("model.country",(function(e,t){e!==t&&m()})),e.countryChanged=function(){p(),e.gmapi.fullAddress="","function"==typeof e.onCountryChange&&e.onCountryChange()},e.isEditingDisabled=function(){return e.gmapi.isActive()&&!e.gmapi.fullAddress||!!e.editingDisabled},e.isCountryWithStates=function(){return!!e.model.country&&-1<[r.c,r.a].indexOf(e.model.country)},e.isCountry=function(t){return!!e.model.country&&e.model.country===t},e.getNgModel=function(t){return e[l][t]},e.isPhoneShown=function(){return"1"===e.showPhone||"true"===e.showPhone},e.isJurisdictionShown=function(){return e.showJurisdictions&&e.model.country&&e.jurisdictionList.length>0},e.isCountryEditingDisabled=function(){return!!e.editingDisabled}}}}angular.module("bpa-ui.directives").directive("bpaAddress",i),i.$inject=["bpaRouting","bpaCountryService","bpaCountryState","bpaTaxInfo","bpaAlert"]},function(e,t,n){"use strict";n.r(t);n(1),n(10),n(5),n(19);angular.module("bpa-ui.directives").directive("bpaAlertMessages",["bpaAlert","bpaUrl","bpaScreenSize",function(e,t,n){return{scope:{messagesFromJson:"=",currentAe:"<",fatalErrorMessage:"@",resetMargins:"<",namespace:"@",isClosable:"<?"},templateUrl:t.resourceUrl("/resource/alert-messages.html"),link:function(t){e.setFatalErrorMessage(t.fatalErrorMessage),e.addAlertMessages(t.messagesFromJson),t.getAlertMessages=function(){return e.getAlertMessages(t.currentAe,t.namespace)},t.isAlertClosable=function(e){return void 0!==t.isClosable?t.isClosable:void 0===e.isClosable||e.isClosable},t.isSmallScreen=function(){return n.isSmallScreen()},t.closeAlert=function(t){return e.closeAlertMessage(t)}}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaAmountInput",["$parse",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,r,a){var i,o,c=/^[0-9]+[.,][0-9]{2}$/,s=.01;function u(e){return e||0===e?parseFloat(e):NaN}function l(e){return angular.isUndefined(e)||""===e}a.$validators.bpaMin=function(e){if(l(a.$viewValue))return!0;e=u(e);var n=function(){if(!angular.isUndefined(i))return u(i(t));return s}();return!!isNaN(n)||!isNaN(e)&&e>=n},a.$parsers.push((function(e){return e&&e.replace?e.replace(",","."):e})),a.$parsers.push((function(e){return a.$setValidity("bpaPattern",l(a.$viewValue)||c.test(a.$viewValue)),e})),angular.isUndefined(r.bpaAmountMin)||(i=e(r.bpaAmountMin)),angular.isUndefined(r.bpaAmountMax)||(o=e(r.bpaAmountMax),a.$validators.bpaMax=function(e){if(l(a.$viewValue))return!0;e=u(e);var n=u(o(t));return!isNaN(e)&&!isNaN(n)&&e<=n})}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaAsyncIndicator",["$compile",function(e){var t=0;return{restrict:"A",link:function(n,r,a){if(!r.hasClass("bpa-has-async-indicator")){var i="isBpaAsyncPerformed"+ ++t;n[i]=!1;var o=angular.element('<div data-ng-show="'+i+'" class="bpa-indicator-anchor no-hide-animation"><span class="glyphicon air-icon-loading bpa-indicator-icon" aria-hidden="true"></span></div>');r.after(o),r.addClass("bpa-has-async-indicator"),e(o)(n),n.$watch(a.bpaAsyncIndicator,(function(e){n[i]=!!e}))}}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(5),n(260),n(90),n(93),n(95),n(262);angular.module("bpa-ui.directives").directive("bpaBaseForm",["bpaUrl","bpaFormMode","bpaBlockMode","bpaNetworkErrors","bpaValidationErrors","bpaGtmEvents","bpaOauth2Http","$parse","$document","$window","$timeout","$interval","$q",function(e,t,n,r,a,i,o,c,s,u,l,d,f){return{require:["bpaBaseForm","?^^bpaBaseForm"],restrict:"A",link:function(e,t,n,r){var a=r[0],i=r[1];n.bpaCommObject&&(0,c(n.bpaCommObject).assign)(e,a.getInterfaceObject());if(n.callbackObject){var o=c(n.callbackObject);a.setCallbackObject(o(e))}if(n.isActive){var s=c(n.isActive);a.setIsActiveGetter(s)}if(n.pagedMode&&a.setPagedMode(!0),n.hideControls){var u=c(n.hideControls);a.setControlsHidden(u(e))}if(n.validateOnSubmit){var l=c(n.validateOnSubmit);a.setValidateOnSubmitGetter(l)}if(n.standardErrorMessage&&a.setStandardErrorMessage(n.standardErrorMessage),n.showErrorNotification){var d=c(n.showErrorNotification);a.setShowErrorNotification(d(e))}if(n.lockOnSubmit){var f=c(n.lockOnSubmit);a.setLockOnSubmit(f(e)||n.lockOnSubmit)}if(n.preventLeaveOnSubmit){var p=c(n.preventLeaveOnSubmit);a.setPreventLeaveOnSubmit(p(e))}n.enableFlashMessages&&(c(n.enableFlashMessages)(e)&&a.enableFlashMessages());i&&(a.setParentForm(i),i.addChildForm(a)),a.triggerFormLinked()},controller:["$scope",function(e){var c,p,m,g,b,h,v,y,A,S={},C={},E={},k={},M=[],_={},I=[],F=!0,P=!0,w=!0,D=!1,T=!1,O="",R="",j="",N=0,L=0,$=!1,U=!1,x=this,B={},V=[],H=!1,q=0,G={},z=!1,Y="Client-side validation error";function W(e,t){t.isControlsHidden=e}function K(e){var t=!0;if(null!==e)for(var n=0,r=e.controls.length;n<r;n++)z&&x.setViewValueToElement(e.controls[n]),x.validateCtrl(e.controls[n]),e.controls[n].$invalid&&(t=!1);return t}function J(e){return e.isActiveGetter&&e.isActiveGetter(g)}function Z(e){return function(t){return!!g&&g[e](t)}}function X(){var e=function e(t){return t?t.offsetTop+e(t.offsetParent):0}(p[0]);u.scroll(0,e)}function Q(e,t){if(B[e]){var n=n||{},r=B[e];angular.isString(r)&&(r={eventAction:r});var a=angular.extend({},r,n);switch(e){case"success":i.postSuccessEvent(a);break;case"failure":i.postFailureEvent(a);break;case"cancel":i.postCancelEvent(a)}}}function ee(e){Q("failure")}function te(e,t,n){ee(),ie(t||n!==Y?"submitProcessingFailure":"submitValidationFailure",!0),e&&e.error&&e.error(t)}function ne(e,t){ee(),e&&e.networkError&&e.networkError(t.code,t.data)}function re(e,t){Q("success"),ie("submitSuccess"),e&&e.success&&e.success(t)}function ae(e){for(var t in e.$error)e.$setValidity(t,!0)}function ie(e,t){G&&G[e]&&(t?l((function(){return x.waitOnPendingValidators(1e4).finally((function(){return G[e](function(){var e=[];for(var t in g.bpaFormErrors)e.push(g.bpaFormErrors[t]);return e.concat(a.extract(m))}())}))}),100):G[e]())}this.setGtmEvents=function(e){return B=e,x},this.templateIsOk=function(e){var t=r.getErrorForUrl(e);return!t||(h?ne(h,t):A=t,!1)},this.init=function(e,t,n){return e.getCtrlByModelName=x.getCtrlByModelName,e.getCtrlByInputName=x.getCtrlByInputName,e.isErrorNotification=x.isErrorNotification,e.getFormName=x.getFormName,e.hasError=x.hasError,p=t,(m=function(e){for(var t,n=["div.ng-form","div[ng-form]","form"],r=0,a=n.length;r<a;r++)if(t=e[0].querySelector(n[r]))return t;return null}(t))&&(O=m.getAttribute("data-name"),b=e[O]),R=n,g=e,function(e){e.bpaFormErrors={},e.bpaFormData={},e.isScreenLocked=x.isScreenLocked,e.isLeavePrevented=x.isLeavePrevented,e.isPagedMode=x.isPagedMode,e.bpaFormCtrl=b,void 0!==x.isControlsHidden&&W(x.isControlsHidden,e)}(e),x},this.getFormName=function(){return R},this.triggerFormLinked=function(){h&&h.formLinked&&h.formLinked(this)},this.setParentForm=function(e){return c=e,x},this.setStandardErrorMessage=function(e){return y=e,x},this.setCallbackObject=function(e){return h=e,A&&ne(h,A),x},this.setStubMode=function(e){return U=e,x},this.setForceValueToModelAllFields=function(e){return z=e,x},this.setSubmit=function(t){if(!g)throw"init must be called first";return g.submitForm=function(n){if(n=n||h,x.isStubMode())re(n);else{if(function(){if(!x.validateOnSubmitGetter)return void x.validateAllFields();x.validateOnSubmitGetter(e)&&x.validateAllFields()}(),!x.isValid())return te(n,null,Y),void x.showErrorNotification();n&&n.beforeSubmit?n.beforeSubmit((function(){t(n)})):t(n)}},x},this.setRemoveAction=function(e){if(!g)throw"init must be called first";return g.removeAction=function(t){e(t=t||h)},x},this.setViewValueToElement=function(e){var t=e.element&&e.element.length>0?e.element[0]:null;t&&null!==t.offsetParent&&void 0!==t.value&&"checkbox"!==t.type&&(e.$setViewValue(t.value),angular.element(t).triggerHandler("updateEvent"))},this.showErrorNotification=function(){x.isErrorNotificationAllowed&&X(),D=!0},this.setIsValid=function(e){return x.customIsValidFunction=e,x},this.setCheckSuccessResponse=function(e){return x.customCheckSuccessResponse=e,x},this.setIsAboutToRedirect=function(e){return x.customIsAboutToRedirect=e,x},this.setValidateOnSubmitGetter=function(e){x.validateOnSubmitGetter=e},this.setControlsHidden=function(e){x.isControlsHidden=e,g&&W(e,g)},this.setShowErrorNotification=function(e){x.isErrorNotificationAllowed=e},this.setLockOnSubmit=function(e){x.lockOnSubmit=e},this.setPreventLeaveOnSubmit=function(e){x.preventLeaveOnSubmit=e},this.addController=function(e,t,n){S[e]=n,C[t.name]=n,function(e,t,n){if(!t.validationGroup)return;var r=_[t.validationGroup]||[];r[e]=n,_[t.validationGroup]=r,n.$parsers.push((function(n){return r=_[t.validationGroup],l((function(){for(var t in r)if(e!==t){var n=r[t];n.validationLock||n.$viewValue&&(n.validationLock=!0,x.validateCtrl(n),n.validationLock=!1)}})),n}))}(e,t,n)},this.setPagedMode=function(e){(H=!!e)&&V.length&&V[0]&&(q=0,this.setPageVisible(V[0].id))},this.isFirstPage=function(){return 0===q},this.isLastPage=function(){return q===V.length-1},this.isPagedMode=function(){return H},this.addFormPage=function(e,t){V.push({id:e,controller:t,controls:[],visible:!0})},this.getPageById=function(e){for(var t=0,n=V.length;t<n;t++)if(V[t].id===e)return V[t];return null},this.isPageVisible=function(e){var t=this.getPageById(e);return null!==t&&t.visible},this.getFormPages=function(){return V.map((function(e){return e.id}))},this.setPageVisible=function(e){for(var t=null,n=0,r=V.length;n<r;n++)V[n].visible="all"===e||V[n].id===e,null===t&&V[n].visible&&(t=n);null!==t&&V[t].controls.length&&V[t].controls[0].element&&l((function(){V[t].controls[0].element[0].focus()})),h&&h.pageChanged&&h.pageChanged("all"===e?V.length:t)},this.nextPage=function(){x.isLastPage()||(ie("nextPageClick"),K(V[q])&&("function"!=typeof V[q].pageValidator||V[q].pageValidator())?(x.setPageVisible(V[++q].id),ie("nextPageSuccess")):ie("nextPageFailure",!0))},this.previousPage=function(){x.isFirstPage()||(x.setPageVisible(V[--q].id),ie("previousPage"))},this.addControllerToPage=function(e,t){var n=this.getPageById(e);null!==n&&n.controls.push(t)},this.setPageValidator=function(e,t){var n=this.getPageById(e);return n&&(n.pageValidator=t),x},this.validateFormPageById=function(e){var t=this.getPage(e);return null!==t&&K(t)},this.getCtrlByModelName=function(e){return S[e]},this.getCtrlByInputName=function(e){return C[e]},this.setPostNameMap=function(e,t){E[e]=t},this.addSensitiveField=function(e,t){M.push({model:e,element:t})},this.addChildForm=function(e){I.push(e),this.addActiveFormCallback&&J(e)&&this.addActiveFormCallback(e)},this.getActiveChildForm=function(){for(var e,t=0,n=I.length;t<n;t++)if(J(e=I[t]))return e},this.setIsActiveGetter=function(e){x.isActiveGetter=e},this.getInterfaceObject=function(){return v||(v={submit:Z("submitForm"),remove:Z("removeAction"),isSubmitAllowed:x.isCanSubmit,isValid:x.isValid,isAboutToRedirect:x.isAboutToRedirect,validate:x.validateAllFields,formIsCancelled:x.postCancelFormEvent,isPagedMode:x.isPagedMode,nextPage:x.nextPage,previousPage:x.previousPage,isFirstPage:x.isFirstPage,isLastPage:x.isLastPage})},this.isCanSubmit=function(e){return(!e||x.isValid())&&F},this.isErrorNotification=function(){return x.isErrorNotificationAllowed&&D},this.isValid=function(){return!!x.isStubMode()||(x.customIsValidFunction?x.customIsValidFunction():b.$valid&&!b.$pristine)},this.isStubMode=function(){var e=g.isSubmited&&!g.allowDoubleSubmit;return U||e||t.isStub},this.isAboutToRedirect=function(){return!!x.customIsAboutToRedirect&&x.customIsAboutToRedirect()},this.setNeedAttention=function(e){e=e||R,x.formNeedAttention=e,x.needAttentionCallback&&x.needAttentionCallback(e),c&&c.setNeedAttention(e)},this.setNeedAttentionCallback=function(e){return x.formNeedAttention&&e(x.formNeedAttention),x.needAttentionCallback=e,x},this.isScreenLocked=function(e){return!("page"===e&&!L)&&(("form"!==e||!L)&&!P)},this.isLeavePrevented=function(){return!1!==x.preventLeaveOnSubmit&&!w},this.setSubmitLock=function(e,t,r){t&n.lockScreen&&"none"===r&&(t&=~n.lockScreen);var a={mode:t=t||n.lockSubmit};t&n.lockScreen&&(P=!1,a.param=function(e){e=L?"page":e||"page";if("page"===e){var t=s.find("body");t.hasClass("eo-block-all")||L||($=!0,t.addClass("eo-block-all")),L++}return e}(r)),t&n.preventLeave&&(w=!1),F=!1,k[e]=a},this.releaseSubmitLock=function(e){var t=0,r=k[e];if(r){for(var a in r.mode&n.lockScreen&&"page"===r.param&&L--,$&&0===L&&s.find("body").removeClass("eo-block-all"),delete k[e],k)t|=k[a].mode;F=0===t,P=!(t&n.lockScreen),w=!(t&n.preventLeave)}},this.areErrorsVisible=function(){for(var e in S){var t=S[e];if(t.$dirty&&t.$invalid)return!0}return!1},this.validateAllFields=function(){for(var e in S)z&&x.setViewValueToElement(S[e]),x.validateCtrl(S[e])},this.revalidateField=function(e){var t=x.getCtrlByModelName(e);t&&x.validateCtrl(t)},this.validateCtrl=function(e){if(e.element&&e.element.triggerHandler("updateEvent"),!e.$valid||!Object.keys(e.$asyncValidators).length||void 0===e.$modelValue){e.$setDirty(),e.$validate();var t=e.bpaInputGroup;t&&(e.$invalid?t.setStatus(!1,!0):t.hasParent()||t.setStatus(!0,!1))}},this.setActionUrl=function(e){j=e},this.enableFlashMessages=function(){T=!0},this.sendFormData=function(e,t){if(!j)throw"actionUrl must be set first";ie("submitClick"),e=e||g.bpaFormData,t=t||h;var r=function(e){var t,n,r={},a={};for(var i in e)if(e.hasOwnProperty(i)&&null!==(t=E[i])&&(n=e[i]))if(-1!==(t=t||i).indexOf(":")){var o=t.split(":");void 0===r[o[0]]&&(r[o[0]]={}),r[o[0]][o[1]]=n}else r[t]=n;return a[O]=r,a}(e);x.clearFormErrors(),x.setSubmitLock("sendFormData",n.preventLeave|n.lockScreen,x.getSubmitLockMode()),T&&(r.flashMessagesEnabled=!0),o.post(j,r,{doNotRetry:!0}).success((function(e){if(x.releaseSubmitLock("sendFormData"),e){if(!t||!t.handleResponseData||t.handleResponseData(e))return e.redirect?(te(null,e,"Server-side redirection"),void(u.location=e.redirect)):void(!function(e){var t=e.errors&&e.errors.length?e.errors:!e.status&&e.messages&&e.messages.length?e.messages:null;if(!t)return!1;for(var n=0,r=t.length;n<r;n++)x.addFormError(t[n]);return X(),!0}(e)?x.checkSuccessResponse(e)?(g.isSubmited=!0,x.setSubmitLock("success"),function(){for(var e,t=0,n=M.length;t<n;t++)(e=M[t]).model.$setViewValue(""),ae(e.model)}(),re(t,e)):x.addStandardError(t,e):te(t,e,"Server-side validation or saving error"))}else x.addStandardError(t,e)})).error((function(e){x.releaseSubmitLock("sendFormData"),x.addStandardError(t,e)}))},this.postCancelFormEvent=function(){return Q("cancel"),!0},this.addStandardError=function(e,t){x.clearFormErrors(),x.addFormError(y||"We are sorry! We are experiencing a technical problem and cannot process your request right now. Please try again in a minute."),X(),te(e,t,"Request error or response is invalid")},this.hasError=function(){return Object.keys(g.bpaFormErrors).length>0||x.isErrorNotification()},this.getSubmitLockMode=function(){return x.lockOnSubmit||"page"},this.getFormNode=function(){return m},this.checkSuccessResponse=function(e){return x.customCheckSuccessResponse?x.customCheckSuccessResponse(e):!!e.id},this.addFormError=function(e,t){t=t||++N,g.bpaFormErrors[t]=e},this.clearFormErrors=function(){D=!1,g.bpaFormErrors={}},this.setEventLogger=function(e){G=e,g.flowName&&G.setFlowName&&G.setFlowName(g.flowName)},this.waitOnPendingValidators=function(e){var t=f.defer(),n=function(){return b.$pending?Object.keys(b.$pending).length:0};if(0===n())t.resolve();else{var r=d((function(){var e=n();t.notify(e),0===e&&(d.cancel(r),t.resolve())}),100);e&&e>0&&l((function(){d.cancel(r),t.reject()}),e)}return t.promise}}]}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaBindCompile",["$compile","$parse","$sanitize",function(e,t,n){return{restrict:"A",link:function(r,a,i){var o=t(i.bpaBindCompile);r.$watch((function(){return o(r)}),(function(t){a.html(t&&n(t.toString())),e(a.contents())(r)}))}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(37);function r(e,t,n){return{restrict:"A",link:function(r,a,i){var o;function c(e,t){var n=a[0],r=document.createElement("span"),i=n.parentNode;return s(r,"bpa-decoration-node "+e),i.insertBefore(r,t?n:n.nextSibling),r}function s(e,t){e.setAttribute("class","bpa-cards-icon-img "+t)}(function(){var e=a[0].parentNode.querySelectorAll(".bpa-decoration-node"),t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0)i.value.remove()}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}})(),(t(i.bpaCardNumberDecorator)(r)||e.getAvailableCreditCards()).forEach((function(e){return c("bpa-cards-icon bpa-cards-icon-"+e+" bpa-card-icon-list")})),c("bpa-card-lock-icon"),a.addClass("bpa-card-icon"),o=c("bpa-cards-icon",!0),e.getSecuredFieldsPromise().then((function(e){e.onBrand((function(e){n((function(){return t=e.brand,void s(o,"bpa-cards-icon  "+(t&&"card"!==t?"bpa-cards-icon-"+t:""));var t}))}),"bpaCardNumberDecorator")}))}}}angular.module("bpa-ui.directives").directive("bpaCardNumberDecorator",r),r.$inject=["CreditCards","$parse","$timeout"]},function(e,t,n){"use strict";n.r(t);n(1),n(37);function r(e,t,n){return{restrict:"A",require:["ngModel","bpaSecuredField"],link:function(r,a,i,o){var c="bpaCardNumber",s="",u=t(i.bpaCardNumber)(r),l=t(i.bpaFirstSixDigits).assign,d=t(i.bpaLastFourDigits).assign,f=t(i.bpaRawValue).assign,p=e.getSecuredFieldsPromise(),m=o[0],g=o[1];p.then((function(t){t.onBrand((function(t){n((function(){s=t.brand,e.updateBrand(s)}))}),c),t.onBinValue((function(e){n((function(){l(r,e.binValue)}))}),c),t.onFieldValid((function(e){"encryptedCardNumber"===e.fieldType&&n((function(){f(r,e.valid?e.blob:""),d(r,e.endDigits)}))}),c)})),m.$validators.bpaCcType=function(){return-1!==u.indexOf(s)},m.$validators.bpaCcNumber=function(){return!g.getError()||"luhn check failed"===g.getError()},m.$validators.bpaCcFormat=function(){return"luhn check failed"!==g.getError()}}}}angular.module("bpa-ui.directives").directive("bpaCardNumber",r),r.$inject=["CreditCards","$parse","$timeout"]},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaCardPhone",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){r.$validators.phoneFormat=function(e){return!e||!!/^[0-9()\-.\s]+$/.test(e)&&10===e.replace(/\D/g,"").length}}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaCheckVatFormat",[function(){return{restrict:"A",require:["ngModel","^^bpaVatGroup"],link:function(e,t,n,r){var a=r[0],i=r[1],o=new RegExp(n.vatPattern.replace(/^\/(.*)\/$/,"$1")),c=/[^0-9]/g,s=parseInt(n.minDigitsCount),u=!1;e.inputController=a,isNaN(s)||i.isStrict()||(a.$validators.vatDigits=function(){return!a.$viewValue||s<=a.$viewValue.replace(c,"").length}),a.$validators.vatFormat=function(){return u=a.$viewValue&&o.test(a.$viewValue),!i.isStrict()||u},e.$watch(n.ngModel,(function(){i.setCorrectness(a.$valid&&u)}))}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(5),n(37),n(90),n(13),n(36),n(27),n(250),n(254),n(64);var r="CC",a="IPO";function i(e,t,n,i,o,c,s,u,l,d,f,p,m,g){return{restrict:"E",scope:{allowDoubleSubmit:"=?",colFieldsClass:"@",cancelUrl:"@",recordId:"@",disallowCurrencies:"<",disallowAddress:"<",lockOnCountryChange:"@",formLockSelector:"@",forcePrimary:"@",pagedSubmitLabel:"@",updateBillingAddress:"<",enableAddressLookup:"<",allowedCardTypes:"<",invalidCardTypeMessage:"@",hideControls:"<",actionUrl:"<",enableExternalScripts:"<?",eoBlockers:"<?",threeDsCardTypes:"<?",enableThreeDs:"<?",mopType:"@",callbackObject:"<?"},require:"bpaBaseForm",templateUrl:function(t,n){var r="";a===n.mopType?r=n.recordId?e.buildDefaultUrl("template-ipo-edit-form",{mopRid:n.recordId}):e.buildDefaultUrl("template-ipo-add-form")+"?"+Date.now():(r=n.recordId?e.formUrl("edit-credit-card"):o.getAddFormUrl())&&"/"===r[0]&&(n.recordId&&(r+="/"+n.recordId),r+="?"+Date.now());return r},link:function(t,b,h,v){var y,A=null,S=null,C=!1;if(v.init(t,b,"creditCard"),t.mopType=t.mopType||r,t.commObject=v.getInterfaceObject(),t.commObject.isBlocked=function(){return v.isScreenLocked("form")},t.rawFormData={},void 0===t.eoBlockers&&(t.eoBlockers=!0),function(){if(!t.disallowAddress){var e=s.get("billingAddress");e&&"string"==typeof e&&(t.billingAddress=JSON.parse(e)),f.get().then((function(e){return y=e}))}}(),(void 0===t.enableExternalScripts||t.enableExternalScripts)&&(!function(){t.jsLoadError=!1,u.isGroupReady("cc-external-scripts")||v.setSubmitLock("cc-js-lock",c.lockScreen,"form");u.addReadyCallback("cc-external-scripts",(function(){n((function(){v.releaseSubmitLock("cc-js-lock"),v.setSubmitLock("secured-fields-init-lock",c.lockScreen,"form"),o.initSecuredFields(b[0].tagName).catch((function(e){t.jsLoadError=!0,d.loadingFailure("CSF initialization failure: "+e)})).finally((function(){v.releaseSubmitLock("secured-fields-init-lock")}))}))})),u.addErrorCallback("cc-external-scripts",(function(){n((function(){v.releaseSubmitLock("cc-js-lock"),t.jsLoadError=!0,d.loadingFailure("External scripts loading error")}))}))}(),t.$on("$destroy",(function(){return o.destroySecuredFieldsPromise()}))),t.recordId)!function(){if(o.getCurrentCard())return;var e=s.get("cardType");e&&"string"==typeof e&&o.updateBrand(o.cardTypeToBrand(e))}(),function(){var t=document.getElementById("card-error-status");if(!t)return;"not-found"===t.value&&(i.location=e.getMainBillingMethodsPageUri())}(),v.setSubmit((function(e){_(),M(),l.updateScope(t,(function(){v.sendFormData(t.bpaFormData,e)}))})),t.disallowCurrencies||n((function(){I(),A=E(),S=t.bpaFormData&&t.bpaFormData.chargeCurrency})),n((function(){v.areErrorsVisible()&&v.showErrorNotification()}),300);else switch(v.setForceValueToModelAllFields(!0).setSubmit((function(e){_(),M(),t.bpaFormData.forcePrimary=t.forcePrimary,t.bpaFormData.updateBillingAddress=Boolean(t.updateBillingAddress),t.bpaFormData.cardType=o.getCurrentCard().type,function(e){return t.enableThreeDs&&t.threeDsCardTypes&&-1!==t.threeDsCardTypes.indexOf(e)}(t.bpaFormData.cardType)&&(t.bpaFormData.browserInfo=m.getBrowserInfo());l.updateScope(t,(function(){v.sendFormData(t.bpaFormData,e)}))})).setGtmEvents({success:"Add Credit Card",failure:"Add Credit Card",cancel:"Click"}),h.pagedMode&&v.setEventLogger(d),t.mopType){case r:t.$watch("bpaFormData.encryptedCardNumber",(function(e){o.getCurrentCard()&&e&&I()}));break;case a:t.$watch("rawFormData.cardNumber",(function(e){e&&t.notInstantFunds&&(t.bpaFormErrors={},t.notInstantFunds=!1)})),t.callbackObject&&(t.callbackObject.error=function(e){e&&e&&(t.notInstantFunds=!0)})}function E(){return t.billingAddress&&t.billingAddress.country}function k(){var e=o.getCurrentCard();return!t.disallowCurrencies&&(!e||e.currenciesAllowed)}function M(){t.disallowAddress||(angular.extend(t.bpaFormData,{address1:t.billingAddress.street,address2:t.billingAddress.street2,city:t.billingAddress.city,country:t.billingAddress.country,zip:t.billingAddress.zip}),"USA"===t.billingAddress.country?t.bpaFormData.countryState={stateUsa:t.billingAddress.state.stateUsa}:"CAN"===t.billingAddress.country&&(t.bpaFormData.countryState={stateCanada:t.billingAddress.state.stateCanada}),t.billingAddress.phone&&(t.bpaFormData.phone=t.billingAddress.phone))}function _(){t.disallowCurrencies?t.bpaFormData.chargeCurrency=null:k()||(t.bpaFormData.chargeCurrency="USD")}function I(){var e=E(),n=o.getCurrentCard();e&&n&&function(e,n){if(!k())return void F(e,[{code:"USD"}]);(!v.isPagedMode()||v.isPagedMode()&&!v.isFirstPage())&&v.setSubmitLock("ccDataLock",c.lockScreen,t.lockOnCountryChange);(t.recordId?g.resolve({issuingCountry:s.get("issuingCountry")}):o.getDetails(r,t.bpaFormData.encryptedCardNumber)).then((function(t){return p.getAvailableLocalCurrencies(e,n,t.issuingCountry)})).then((function(t){F(e,t.currencies)})).catch((function(){F(e,[])})).finally((function(){return v.releaseSubmitLock("ccDataLock")}))}(e,n.type)}function F(e,n){var r,a=t.bpaFormData.chargeCurrency;if(1===n.length&&"USD"===n[0].code&&e&&S&&e===A&&"USD"!==S)t.chargeCurrenciesList=function(e){return[{code:e,date:"",name:"",rate:""},{code:"USD",date:"",name:"U.S. dollars",rate:""}]}(S),a=S;else{if(n.length<=1)return t.chargeCurrenciesList=[],void(t.bpaFormData.chargeCurrency="");t.chargeCurrenciesList=n}a&&(r=P(a)),r||(r=n[0]),r&&w(r)}function P(e){for(var n,r=0,a=t.chargeCurrenciesList.length;r<a;r++)if((n=t.chargeCurrenciesList[r]).code===e)return n;return null}function w(e){t.currentCurrency=e,t.bpaFormData.chargeCurrency=e.code}t.$watch("bpaFormData.firstSixDigits",(function(e){return d.setBin(e)})),t.countryChange=function(){t.bpaFormData.chargeCurrency="",C=!1,I()},t.currencyChange=function(){var e;(e=P(t.bpaFormData.chargeCurrency))&&w(e)},t.isCurrencyChangeRequested=function(){return C},t.requestCurrencyChange=function(){C=!0},t.getCountryName=function(){var e=E();if(e){if(!y)return e;var t=y.find((function(t){return t.code3===e}));return t?t.name:e}},t.isAmexCard=function(){var e=o.getCurrentCard();return e&&"amex"===e.type},t.isCurrencySelected=function(e,n){var r=t.bpaFormData.chargeCurrency;return r?e===r:0===n},t.areCurrenciesAllowed=k}}}angular.module("bpa-ui.directives").directive("bpaCreditCardForm",i),i.$inject=["bpaUrl","bpaOauth2Http","$timeout","$window","CreditCards","bpaBlockMode","bpaVars","ExternalScripts","bpaIovation","bpaCcEventLogger","bpaCountryService","bpaCurrency","bpaThreeDs","$q"]},function(e,t,n){"use strict";n.r(t);n(1),n(43),n(61);angular.module("bpa-ui.directives").directive("bpaDepositMethodsAction",["bpaDepositMethods","bpaHashAction",function(e,t){return{restrict:"C",scope:{href:"@"},link:function(n,r){var a=decodeURI(n.href).split("#",2);if(2===a.length){var i=t.getAction(a[1]);i.action===t.ACTION_VERIFY_PAYMENT_METHOD&&r.on("click",(function(t){t.preventDefault(),t.stopPropagation(),e.verifyMop(i.mopRid)}))}}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(44);function r(e,t,n){return{restrict:"E",scope:{accountingEntity:"<",forceMethodType:"<",interfaceObject:"=",callbackObject:"<",alertNamespace:"@"},templateUrl:t.get("template-disburse-flow"),link:function(t){var r="form",a="confirmation",i=r;function o(e){var n=r===i?t.disburseInterface:t.confirmationInterface;return n[e]?n[e]():""}n.getDataForAeRid(t.accountingEntity,[n.DISBURSE_CONFIGURATION],!0).then((function(e){t.config=e[n.DISBURSE_CONFIGURATION],t.forceMethodType&&(t.forcedPaymentMethod=function(e,t){var n=[];for(var r in e.withdrawalOptions||{}){var a=e.withdrawalOptions[r];t===a.code&&n.push(a)}if(n.length)return n.sort((function(e,t){return t.id-e.id})),n[0];return null}(t.config,t.forceMethodType))}),(function(){t.config={},t.callbackObject&&t.callbackObject.loadingError&&t.callbackObject.loadingError()})),t.disburseInterface={onSuccessfulDisburse:function(n){t.withdrawalResult=n.withdrawalResult,e((function(){i=a})),t.callbackObject&&t.callbackObject.success&&t.callbackObject.success()}},t.confirmationInterface={},t.interfaceObject={getSaveLabel:function(){return o("getSaveLabel")},getTitle:function(){return o("getTitle")},submit:function(){o("submit")},isBlocked:function(){return!t.config},isSubmitDisabled:function(){return o("isSubmitDisabled")},hasForcedPaymentMethod:function(){return!!t.forcedPaymentMethod},isFormState:function(){return t.isFormState()},isConfirmationState:function(){return t.isConfirmationState()}},t.isFormState=function(){return r===i},t.isConfirmationState=function(){return a===i}}}}angular.module("bpa-ui.directives").directive("bpaDisburseFlow",r),r.$inject=["$timeout","bpaRouting","bpaDisburse"]},function(e,t,n){"use strict";n.r(t);n(1),n(36);angular.module("bpa-ui.directives").directive("bpaExternalScriptsGroup",["ExternalScripts","$timeout",function(e,t){return{restrict:"E",require:"bpaExternalScriptsGroup",link:function(e,t,n,r){r.setName(n.name)},controller:["$scope",function(n){var r,a=0,i=!1,o=this,c=null;function s(){c&&t.cancel(c)}this.setName=function(e){r=e},this.registerScript=function(){a++,s(),c=t(o.setError,3e4)},this.setScriptReady=function(){--a||(s(),e.setReady(r))},this.setError=function(){!i&&a&&(i=!0,e.setError(r))}}]}}]).directive("bpaExternalScript",["ExternalScripts",function(e){return{restrict:"E",require:"?^^bpaExternalScriptsGroup",link:function(t,n,r,a){if(!r.src)throw'"src" is mandatory attribute for bpaExternalScript';a&&a.registerScript(),e.download(r.src,{onload:function(){a&&a.setScriptReady()},onerror:function(){a&&a.setError()}})}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(259);angular.module("bpa-ui.directives").directive("bpaFlashMessages",["bpaFlashMessage","bpaUrl",function(e,t){return{scope:{currentAe:"<",specificClass:"@",specialMessages:"<"},templateUrl:t.resourceUrl("/resource/flash-messages.html"),link:function(t){t.getSpecificClass=function(){return t.specificClass||""},e.setSpecialMessages(t.specialMessages),e.fetchMessages(t.currentAe),t.getMessages=function(){return e.getMessages(t.currentAe)}}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaFormActionUrl",(function(){return{restrict:"A",require:"^bpaBaseForm",link:function(e,t,n,r){r.setActionUrl(n.bpaFormActionUrl)}}}))},function(e,t,n){"use strict";n.r(t);n(1),n(5);angular.module("bpa-ui.directives").directive("bpaFormControls",["bpaUrl",function(e){return{restrict:"E",templateUrl:e.resourceUrl(["/resources/html/form-controls.partial.html","form-controls.partial.html"]),require:"^^bpaBaseForm",scope:{submitLabel:"@",cancelUrl:"@",showRemoveButton:"@"},link:function(e,t,n,r){e.commObject=r.getInterfaceObject()}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaFormPage",[function(){return{restrict:"E",transclude:!0,scope:{pageId:"=",validator:"&?",enabled:"<?"},require:["^^bpaBaseForm","bpaFormPage"],compile:function(){return{pre:function(e,t,n,r){var a=r[0],i=r[1];if(!a)throw new Error("bpa-form-page should be used only inside bpa-base-form");i.init(e.pageId,a),void 0===e.enabled&&(e.enabled=!0),e.enabled&&a.addFormPage(e.pageId,i),"function"==typeof e.validator&&a.setPageValidator(e.pageId,e.validator),e.isPageVisible=function(){return e.enabled&&i.isVisible()}}}},controller:[function(){var e,t;this.init=function(n,r){e=n,t=r},this.getPageId=function(){return e},this.isVisible=function(){return t.isPageVisible(e)},this.isValid=function(){return t.validateFormPageById(e)},this.addController=function(n){t.addControllerToPage(e,n)}}],template:'<div data-ng-transclude data-ng-show="isPageVisible()" ng-if="enabled" ng-class="isPageVisible() ? \'bpa-growable\' : \'\'" class="bpa-form-page"></div>'}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaHaveLetter",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){r.$validators.bpaHaveLetter=function(e){if(!e)return!0;return/[^0-9 -.,]/.test(e)}}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaHelpPopover",["bpaRouting",function(e){return{restrict:"E",scope:{contents:"@"},template:function(e,t){return t.contents?'<a class="bpa-help-popover" eo-popover="{{ getContentsUrl() }}"\n                        eo-popover-trigger="mouseenter" eo-popover-size="lg" eo-popover-placement="bottom"\n                        eo-popover-append-to-body="true">'.concat(e.html(),"</a>"):e.html()},link:function(t){t.getContentsUrl=function(){return e.get(t.contents)}}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaIncludeReplace",["$timeout",function(e){return{restrict:"A",require:"ngInclude",link:function(t,n){var r=n[0];t.$on("$includeContentLoaded",(function(t){t.stopPropagation(),e((function(){r.childNodes.forEach((function(e){r.parentNode&&r.parentNode.appendChild(e)})),e((function(){return r.remove()}))}))}))}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaInputGroup",[function(){return{restrict:"A",require:["bpaInputGroup","?^^bpaInputGroup"],controller:[function(){var e,t,n,r=[],a=this;this.addController=function(t){t.bpaInputGroup=a,r.push(t),e&&e()},this.setAddControllersCallback=function(t){e=t,r.length&&e()},this.getControllers=function(){return r},this.setElementAndParent=function(e,r){t=e,n=r},this.hasParent=function(){return!!n},this.setStatus=function(e,r){n?n.setStatus(e,r):(t.toggleClass("has-success",e),t.toggleClass("has-error",r))}}],link:function(e,t,n,r){var a,i,o,c,s,u=r[0],l=[],d=0;function f(){var e=a[d];return e.$dirty&&(o=!0),c=c&&e.$valid&&!!e.$modelValue,s=s||e.$invalid,d++,e.$modelValue||e.$viewValue+"_"}u.setElementAndParent(t,r[1]),u.setAddControllersCallback((function(){var t=(a=u.getControllers()).length,n=l.length;for(t&&!n&&(l.push((function(){return d=0,o=!1,c=!0,s=!1,f()})),n++);n<t;n++)l.push(f);i&&i(),i=e.$watchGroup(l,(function(){o&&u.setStatus(c,s)}))}))}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaLocation",["eoUtils",function(e){return{restrict:"E",template:"<div ng-bind-html='formatLocation()'></div>",scope:{location:"=?"},link:function(t){t.formatLocation=function(){if(!angular.isObject(t.location))return"";var n=[];return["street","street2","city","zip","jurisdiction","country"].forEach((function(r){t.location[r]&&n.push(e.escapeText("city"===r?"".concat(t.location.city).concat(t.location.state?", "+t.location.state:""):t.location[r]))})),n.join("<br />")}}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaMaxlengthLink",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){if(r){var a,i=+n.maxlength,o=!1,c=r.$$parentForm.$name+"["+n.bpaMaxlengthLink+"]";r.$validators.maxlengthLink=function(e){return((e||"")+(s()||"")).length<=i},e.$watch(s,(function(e){var t=r.$viewValue;o?(r.$setViewValue(t?"":" "),r.$setViewValue(t)):e&&t&&(o=!0)}))}function s(){return a||(a=angular.isDefined(r.$$parentForm[c])?r.$$parentForm[c]:void 0),a&&a.$viewValue}}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaMethodsPageLink",["$window","$injector",function(e,t){return{restrict:"C",scope:{href:"@"},link:function(n,r){if(e.location.pathname===n.href&&null!==function(e,t){for(;e;e=e.parentNode)if(e.classList&&e.classList.contains(t))return e;return null}(r[0],"modal-dialog")&&t.has("$modalStack")){var a=t.get("$modalStack");r.on("click",(function(t){t.preventDefault(),t.stopPropagation(),a.dismissAll(),e.scrollTo&&e.scrollTo(0,0)}))}}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaModel",["$compile","$parse","$timeout",function(e,t,n){return{restrict:"A",require:["?^bpaInputGroup","?^^bpaBaseForm","?ngModel","?^^bpaFormPage"],scope:{bpaModel:"@",ngModel:"@",bpaPostName:"@",bpaPostSkip:"@",bpaSensitive:"@",bpaAddInputGroup:"@",skipCompilation:"<?"},compile:function(r,a){return r.attr("ng-model","bpaFormData."+a.bpaModel),{pre:function(r,a,i,o){if(r.skipCompilation)return;var c=o[0],s=o[1],u=o[2],l=o[3];if(u){if(u.bpaPostName=r.bpaPostName,u.element=a,i.value&&"radio"!==i.type&&n((function(){t(i.ngModel).assign(r.$parent,i.value)})),c&&"false"!==r.bpaAddInputGroup&&c.addController(u),s){var d,f=r.bpaModel||r.ngModel;s.addController(f,i,u),l&&l.addController(u),d=r.bpaPostSkip?null:r.bpaPostName?r.bpaPostName:f,s.setPostNameMap(f,d),r.bpaSensitive&&s.addSensitiveField(u,a)}}else e(a)(r.$parent)}}}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(14);function r(e,t){return{template:'<a target="_self" class="btn btn-primary btn-block" ng-href="{{ vm.getUrl() }}">Link PayPal Account</a>',controllerAs:"vm",controller:function(){this.getUrl=function(){return e.get("add-paypal-deposit").replace("{accountingEntity}",t.getAccountingEntityRid())}}}}angular.module("bpa-ui.directives").directive("bpaPaypalButtonPlaceholder",r),r.$inject=["bpaRouting","bpa"]},function(e,t,n){"use strict";n.r(t);n(1),n(36),n(27),n(5);var r=n(2);angular.module("bpa-ui.directives").directive("bpaPaypalButton",["ExternalScripts","bpaIovation","bpaUrl","$compile","bpaOauth2Http","$timeout","bpaEventTrackerFactory",function(e,t,n,a,i,o,c){var s=c.create(r.p);return{restrict:"E",scope:{size:"@",color:"@",shape:"@",label:"@",callbacks:"=?",forcePrimary:"@",updateBillingAddress:"<"},link:function(a,c){var u;function l(e,t){s.click("pay_with_paypal"),g("init");var r={};a.forcePrimary&&(r.forcePrimary=a.forcePrimary),i.post(n.urlSetAe(u),r).success((function(n){if(!n)return p(),t(new Error("no data"));if(!n.agreement_key||!n.status){var r=n.messages&&n.messages.length?n.messages[0].message:void 0;return p(r),t(new Error(r))}e(n.agreement_key)})).error((function(e){p(),t(new Error(e))}))}function d(e){s.impression("success_event_accepted_ba"),g("authorize"),t.getBlackBox((function(t){return n=e.returnUrl,r={iovationBlackBox:t,updateBillingAddress:Boolean(a.updateBillingAddress)},void i.post(n,r).success((function(e){return e?e.status?(s.click("success_event_upm_added"),void g("success",e.messages,e.mop_data)):p(e.messages&&e.messages.length?e.messages[0].message:void 0):p()})).error((function(){p()}));var n,r}))}function f(){s.impression("success_event_cancel"),g("cancel")}function p(e){s.impression(r.e,{status_message:e}),g("error",e)}function m(e){s.messages(r.f,[e]),g("loadingFailure")}function g(e,t,n){a.callbacks[e]&&o((function(){return a.callbacks[e](t,n)}))}a.callbacks=a.callbacks||{},c[0].setAttribute("id","_bpaPayPalElement"),i.get(n.resourceUrl("paypal/config"),{cache:!0}).success((function(t){t&&t.key||m("Paypal configuration response is invalid"),u=t.createUrl;var n={};n["data-version-"+t.version]="",e.download(t.url,{onload:function(){angular.isDefined(paypal)&&angular.isDefined(paypal.Button)?o((function(){!function(e,t,n){paypal.Button.props&&paypal.Button.props.payment&&(paypal.Button.props.payment.timeout=1e5);paypal.Button.render({env:t,client:{production:n,sandbox:n},locale:"en_US",payment:l,commit:!0,onAuthorize:d,onCancel:f,logLevel:"error",style:{size:a.size||"responsive",color:a.color||"blue",shape:a.shape||"rect",label:a.label||"pay"}},"#"+e)}("_bpaPayPalElement",t.env,t.key)}),1e3):m("Paypal API failed to load")},onerror:function(){m("External scripts loading error")}},n)})).error((function(){m("Paypal configuration loading error")}))}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaPhone",(function(){return{restrict:"A",require:["^^bpaBaseForm","ngModel"],link:function(e,t,n,r){var a=r[0],i=r[1];a.addController(n.ngModel,n,i),e.$watch(n.ngModel,(function(){var t=i.$modelValue,r=e.bpaFormData;if(t){var a=""+(t.country?t.country["Phone Code"]:"")+(t.number?t.number:"");r[n.name]=a.replace(/\D/g,"")}}))}}}))},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaPreventLeave",["$window",function(e){return{restrict:"A",scope:{active:"&",message:"@"},link:function(t,n,r,a){e.addEventListener("beforeunload",(function(e){if(t.active())return(e||window.event).returnValue=t.message,t.message}))}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaRoutingNumber",[function(){return{restrict:"A",link:function(e,t){t.on("input",(function(){t.val().length>8&&t.triggerHandler("updateEvent")}))}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(37);function r(e){return{restrict:"A",require:["ngModel","bpaSecuredField"],link:function(t,n,r,a){var i=r.cse,o=e.getSecuredFieldsPromise(),c=a[0],s=a[1];o.then((function(e){e.onFieldValid((function(e){i===e.type&&c.$setViewValue(e.valid?e.blob:"")}),i),e.onError((function(e){i===e.fieldType&&s.setError(e.error)}),i),e.onFocus((function(e){i===e.fieldType&&(e.focus?n.addClass("focused"):n.removeClass("focused"))}),i)})),c.$validators.required=function(){return!(!c.$viewValue&&!s.getError())},r.bpaSecuredFieldErrorValidator&&"false"===r.bpaSecuredFieldErrorValidator||(c.$validators.bpaSecuredFieldError=function(){return""===s.getError()})},controller:function(){var e="";this.setError=function(t){e=t},this.getError=function(){return e}}}}angular.module("bpa-ui.directives").directive("bpaSecuredField",r),r.$inject=["CreditCards"]},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaSelect",["bpaRouting",function(e){return{restrict:"A",require:"ngModel",scope:{model:"=ngModel",placeholder:"@",choices:"<",idMap:"&?",valueMap:"&?",labelMap:"&?",dropdownClass:"@",disabled:"<?",onSelectionChange:"&?"},templateUrl:e.get("template-bpa-select"),link:function(e,t,n,r){var a=null,i=t[0].querySelector("up-c-dropdown span[slot='label']");function o(){var t=[];return angular.forEach(e.choices,(function(e,n){t.push({id:c("idMap",e,n).toString(),label:c("labelMap",e,n),data:c("valueMap",e,n)})})),t}function c(t,n,r){return angular.isFunction(e[t])?e[t]({item:n,key:r}):n}function s(e,t){var n=e&&c("idMap",e);if(a=null,null!=n)for(var r=0,i=t.length;r<i;r++)if(t[r].id===n.toString()){a=t[r];break}}void 0===e.disabled&&(e.disabled=!1),angular.extend(e,{options:o(),isSelected:function(e){return a&&a.id===e.id},getSelectionLabel:function(){return a&&a.label||e.placeholder},getSelectionLabelText:function(){return i&&i.innerText.replace(/\n/g,"").replace(/\s{2,}/g," ")},selectionChanged:function(t){a&&a.id===t.id||(a=t,e.model=a.data,r.$setViewValue(a.data),angular.isFunction(e.onSelectionChange)&&e.onSelectionChange())}}),e.$watchCollection("choices",(function(){e.options=o(),s(e.model,e.options)})),e.$watch("model",(function(t){s(t,e.options)}))}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaSetLocation",["$window","$location",function(e,t){return{restrict:"E",scope:{location:"@",reload:"@"},link:function(n){n.reload?e.location=n.location:t.path(n.location)}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaShowBankInfo",[function(){return{restrict:"E",templateUrl:"bpaShowBankInfo.html",scope:{bankInfo:"="},link:function(e,t,n){e.getAddress=function(){return[(t=e.bankInfo.info).city,t.district&&"-"!=t.district?t.district:"",t.state!=t.city?t.state:"","-"!=t.zip?t.zip:"",t.country||("US"==t.country_code2?"UNITED STATES":"")].filter((function(e){return e||null})).join(", ");var t}}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(22);angular.module("bpa-ui.directives").directive("bpaShowTaxInfo",["bpaRouting","bpaTaxInfo",function(e,t){return{restrict:"E",templateUrl:e.get("template-tax-show"),scope:{taxInfo:"=?"},link:function(e,n,r){r.taxInfo||t.get().then((function(t){return e.taxInfo=t.taxInfo})),e.isW8=function(){return e.taxInfo&&"w8"===e.taxInfo.type},e.isW9=function(){return e.taxInfo&&"w9"===e.taxInfo.type}}}}])},function(e,t,n){"use strict";n.r(t);n(1);function r(e){return{restrict:"E",templateUrl:e.get("template-show-tax-residency"),scope:{residencyAddress:"<"},controller:a,controllerAs:"vm",bindToController:!0}}function a(e){var t=this;e.$watch("vm.residencyAddress",(function(e){t.location=e?{country:e.country.name,state:e.state,city:e.city,street:e.street,street2:e.street2,zip:e.zip,jurisdiction:e.jurisdiction&&e.jurisdiction.name}:null}))}angular.module("bpa-ui.directives").directive("bpaShowTaxResidency",r),r.$inject=["bpaRouting"],a.$inject=["$scope"]},function(e,t,n){"use strict";n.r(t);n(1),n(22);angular.module("bpa-ui.directives").directive("bpaShowVatInfo",["bpaRouting","bpaTaxInfo",function(e,t){return{restrict:"E",templateUrl:e.get("template-vat-show"),scope:{vatInfo:"=?"},link:function(e,n,r){r.vatInfo||t.get().then((function(t){return e.vatInfo=t.vatInfo}))}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(10),n(42),n(22);var r=n(8);function a(e,t,n,a,i,o){return{restrict:"E",templateUrl:e.get("template-tax-residency-form"),require:"bpaBaseForm",scope:{residencyInfo:"<",locationAddress:"<",context:"<"},link:function(c,s,u,l){var d=!1,f=!1,p=[];function m(e){l.isValid()&&function(){var e=o.defer();t=c.residencyInfo.residencyAddress,t&&t.country.code3===c.address.country?!function(){var e=c.residencyInfo.residencyAddress;return e&&e.jurisdiction&&e.jurisdiction.id!==c.address.jurisdictionId}()?e.reject():e.resolve():!function(){var e=c.residencyInfo.residencyAddress;return e&&e.country.vatEnabled&&c.residencyInfo.hasVatId}()?(f=!0,i.getCountryVatStatus(c.address.country).then((function(t){t.enabled?e.resolve():e.reject()})).catch((function(){n.addFatalErrorMessage(),e.reject()})).finally((function(){return f=!1}))):e.resolve();var t;return e.promise}().then((function(){a.open("template-tax-residency-change-warning").then((function(){return g(e)})).catch((function(){return c.taxResidency.$setPristine()}))})).catch((function(){g(e)}))}function g(e){d=!0;var t=angular.extend({fromProfile:c.useMyLocationAddress},c.address);-1===[r.c,r.a].indexOf(t.country)&&delete t.state,l.sendFormData(t,e)}function b(e){var t=e.country.name||e.country;return t===r.d?{stateUsa:e.state}:t===r.b?{stateCanada:e.state}:{}}function h(e){return e?v(e.country.code3,b(e),e.city,e.street,e.street2,e.zip,e.jurisdiction&&e.jurisdiction.id):v()}function v(){return{country:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",state:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},city:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",street:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",street2:arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",zip:arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",jurisdictionId:arguments.length>6&&void 0!==arguments[6]?arguments[6]:""}}c.allowDoubleSubmit=!0,c.address={},l.init(c,s,"taxResidency"),l.setActionUrl(e.get("submit-tax-residency").replace("{context}",c.context)),l.setSubmit(m),l.setCheckSuccessResponse((function(e){return Boolean(e.status)})),angular.extend(l.getInterfaceObject(),{isBlocked:function(){return f||c.addressInterface&&c.addressInterface.isLoading()||l.isScreenLocked("form")},triedToSubmit:function(){return d},resetValues:function(){d=!1,c.useMyLocationAddress=!1,c.address=h(c.residencyInfo.residencyAddress),c.addressInterface&&c.addressInterface.clearAutocomplete(),c.taxResidency.$setPristine()}}),f=!0,t.get().then((function(e){p=e,c.$watch("residencyInfo",(function(e){var t=e&&e.residencyAddress;c.address=h(t)}))})).catch((function(){return n.addFatalErrorMessage()})).finally((function(){return f=!1})),c.setMyLocationAddress=function(){var e,t;c.useMyLocationAddress&&(c.address=v((e=c.locationAddress.country,(t=p.find((function(t){return t.name===e})))?t.code3:""),b(c.locationAddress),c.locationAddress.city,c.locationAddress.street,c.locationAddress.street2,c.locationAddress.zip))}}}}angular.module("bpa-ui.directives").directive("bpaTaxResidencyForm",a),a.$inject=["bpaRouting","bpaCountryService","bpaAlert","bpaConfirmation","bpaTaxInfo","$q"]},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaValidateTin",["$parse",function(e){var t={SSN:/^\d{3}-\d{2}-\d{4}$/,EIN:/^\d{2}-\d{7}$/};return{restrict:"A",require:"ngModel",link:function(n,r,a,i){var o=e(a.watchModel);i.$validators.invalidSSN=function(e){var r=o(n);return r&&("SSN"!==r||t.SSN.test(e))},i.$validators.invalidEIN=function(e){var r=o(n);return r&&("EIN"!==r||t.EIN.test(e))},n.$watch(a.watchModel,(function(){i.$validate()}))}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(13);angular.module("bpa-ui.directives").directive("bpaVar",["bpaVars",function(e){return{restrict:"E",scope:{key:"@",value:"@"},link:function(t){e.set(t.key,t.value)}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaVatGroup",[function(){return{scope:{bpaVatGroup:"<",formatCorrectnessFlag:"="},restrict:"A",controller:["$scope",function(e){this.isStrict=function(){return e.bpaVatGroup},this.setCorrectness=function(t){e.formatCorrectnessFlag=t}}]}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("bpaZip",["$parse",function(e){var t={USA:/^\d{5}$/,CAN:/^[a-z]\d[a-z](?:\s?\d[a-z]\d)?$/i};return{restrict:"A",require:"ngModel",link:function(n,r,a,i){var o=e(a.zipIsOptional),c=e(a.zipCountryModel),s=e(a.postalCodeRequired);function u(e){if(!c(n))return!0;if(!e)return!0;e=e.trim();var r=t[l()];return!r||r.test(e)}function l(){return c(n)?c(n):""}function d(){return"CAN"===l()}function f(){return"USA"===l()}i.$validators.bpaZip=function(e){if(!f())return!0;return u(e)},i.$validators.bpaZipRequired=function(e){if(!f())return!0;return!!e},i.$validators.bpaPostal=function(e){if(!d())return!0;return u(e)},i.$validators.bpaPostalRequired=function(e){if(!d()&&!s(n))return!0;return!!e},i.$validators.bpaPostalIncorrect=function(e){if(!e)return!0;return(e=e.trim())&&/^[a-z0-9\/,.:;+()# -]{1,10}$/i.test(e)},o.assign(n,!0),n.$watch(l,(function(e){o.assign(n,!t[e]&&!s(n))}))}}}])},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("choiceModelInit",["$parse",function(e){return{restrict:"A",link:function(t,n,r){r.ngModel&&e(r.ngModel).assign(t,n[0].value)}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(14),n(5),n(13),n(251),n(43),n(94),n(12);angular.module("bpa-ui.directives").directive("clientPlanSubscription",["bpa","bpaUrl","bpaVars","bpaClientSubscription","$filter","bpaDepositMethods","bpaSubscriptionEventLogger","DEPOSIT_METHODS_URL_PART","ACCOUNTING_ENTITY_KEY",function(e,t,n,r,a,i,o,c,s){return{restrict:"E",require:"bpaBaseForm",scope:{subscriptionInfo:"=?",callbackObject:"=?",subscriptionUrl:"@"},templateUrl:t.resourceUrl(c+"/partials/client-plan-subscription-form.html"),link:function(e,t,c,u){var l=!0;function d(){return l||u.isScreenLocked("form")}function f(t){l=!0,e.subscriptionInfo.primary?p(t):i.setPrimaryMop(n.get(s),e.subscriptionInfo.id).then((function(e){e.data&&!e.data.status?m():p(t)}),(function(){return m()}))}function p(t){r.subscribe(e.subscriptionInfo.plan.product_id).then((function(){l=!1,t&&t.success&&(t.success(),o.submitSuccess())}),(function(){return m()}))}function m(){u.addStandardError(),o.submitProcessingFailure(),l=!1}u.init(e,t,"clientPlanSubscription").setSubmit(f).setIsValid((function(){return!!e.subscriptionInfo})),r.setUrl(e.subscriptionUrl),u.setEventLogger(o),u.getInterfaceObject().isBlocked=d,e.$watch("subscriptionInfo",(function(e){void 0!==e&&(l=!1)})),e.getSubscriptionFee=function(){return e.subscriptionInfo&&e.subscriptionInfo.plan&&e.subscriptionInfo.plan.fee?a("number")(e.subscriptionInfo.plan.fee,2)+"%":""},e.getBenefitAmount=function(){return e.subscriptionInfo&&e.subscriptionInfo.plan&&e.subscriptionInfo.plan.fee?100*e.subscriptionInfo.plan.price/e.subscriptionInfo.plan.fee:0}}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(14),n(5),n(10),n(35),n(43),n(61),n(63),n(66),n(12);function r(e,t,n,r,a,i,o,c,s,u,l,d,f,p,m){var g=l.create("list");return{scope:{currentAe:"<",aeType:"@",interfaceObject:"=?"},templateUrl:"depositMethodsTpl.html",link:function(t){var i="add-paypal";function o(e,t){s.setPrimaryMop(e,t).success((function(t){s.processResponse(e,t)})).error((function(){s.processFatalErrorInResponse(e)}))}function l(e){var t=c.show({enableSubscription:!0,forcePrimary:0,defaultMode:e,threeDsCallback:v});t&&t.then(b,b)}function b(e){if(e){if(e.threeDs)return;e.success&&n.publish(s.CHANNEL_MOP_ADDED,e.mopData)}d.CODE_EMAIL_NOT_VERIFIED!==e&&h()}function h(){s.setScreenLoading(!0),s.depositMethodsReload()}function v(){return p.resolve(m.location.pathname)}t.interfaceObject={refresh:h},s.setScreenLoading(!1),r.setAccountingEntityRid(t.currentAe),c.preFetchData(),function(){var e=u.getAction();switch(e.action){case u.ACTION_ADD_PAYMENT_METHOD:return void l();case u.ACTION_VERIFY_PAYMENT_METHOD:return void s.verifyMop(e.mopRid)}void 0!==f.search()[i]&&l("PAYPAL_DEPOSIT")}(),t.$watch("currentAe",(function(e,t){e!=t&&(c.removeAddCardFormFromCache(),h())})),t.getDepositTemplateUrl=function(){return s.getDepositTemplateUrl()},t.templateLoaded=function(){s.setScreenLoading(!1)},t.verifyMop=function(e){g.click("verify"),s.verifyMop(e)},t.setPrimary=function(e,t,n,r,a){1==n&&(s.setScreenLoading(!0),1==r&&0==a?s.setUpModal({locals:{_injectedProperties:{}},size:"sm",keyboard:!1,backdrop:"static",controller:"yesNoModalController",templateUrl:"changePrimaryWarning.html"},(function(n){n&&n.success&&(s.setScreenLoading(!0),o(e,t))})):o(e,t))},t.showAddMopModal=function(){g.click("add_method"),l()},t.deleteMop=function(t,r,i){s.setScreenLoading(!0),s.setUpModal({locals:{_injectedProperties:{remove:i}},size:"sm",keyboard:!1,backdrop:"static",controller:"yesNoModalController",templateUrl:"deleteMopWarning.html"},(function(i){var o,c,u;i&&i.success&&(s.setScreenLoading(!0),e.post((o=t,c="remove",u=r,a.depositMethodsBaseUrl(o)+"/"+u+"/"+c)).success((function(e){e.status&&n.publish(s.CHANNEL_MOP_REMOVED),s.processResponse(t,e)})).error((function(){s.processFatalErrorInResponse(t)})))}))}}}}angular.module("bpa-ui.directives").directive("depositMethods",r),r.$inject=["bpaOauth2Http","$templateCache","eoChannel","bpa","bpaUrl","bpaAlert","DEPOSIT_METHODS_URL_PART","bpaAddBillingMethod","bpaDepositMethods","bpaHashAction","bpaEventTrackerFactory","bpaRequirementsNotMetHandler","$location","$q","$window"]},function(e,t,n){"use strict";n.r(t);n(1),n(65);angular.module("bpa-ui.directives").directive("financialAccountSelector",["bpaOauth2Http","cookieManager","bpaRouting","eoUtils","bpaFlashMessage",function(e,t,n,r,a){return{scope:{currentAe:"<",collection:"<",cookie:"@",callback:"&"},templateUrl:n.get("template-financial-account-selector"),link:function(i){var o=i.cookie,c=i.currentAe,s=i.collection,u=!1;function l(e,t){var n,a=[];return angular.forEach(t,(function(t,i){var o,c=t.split("(");o=2===c.length?'<span class="d-flex"><span class="ellipsis">'.concat(r.escapeText(c[0]),"</span>&nbsp;")+"<span>(".concat(r.escapeText(c[1]),"</span></span>"):r.escapeText(t),a.push({id:i,label:o}),i===e&&(n=o)})),i.selectedAe={id:e,label:n},a}i.dropdownDidClose=function(){if(u){(n=new Date).setDate(n.getDate()+30),t.put(o,i.selectedAe.id,{expires:n});var e=i.selectedAe.id;a.fetchMessages(e),i.callback({id:e,label:i.selectedAe.label}),u=!1}var n},i.change=function(){return u=!0},s&&o&&c?(angular.isString(s)&&(s=angular.fromJson(s)),Object.keys(s).length>1&&(i.aeCollection=l(c,s))):e.get(n.get("financial-account-selector-fetch")).success((function(e){Object.keys(e.collection).length>1&&(o=e.cookie,c=e.currentAe,i.aeCollection=l(c,e.collection))}))}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(5),n(27),n(66);angular.module("bpa-ui.directives").directive("mpesaForm",["bpaUrl","eoModal","bpaIovation","$timeout",function(e,t,n,r){return{restrict:"E",scope:{cancelUrl:"@",removeMopUrl:"@",recordId:"@"},require:"bpaBaseForm",templateUrl:function(t,n){var r=n.recordId?e.formUrl("edit-mpesa-form"):e.formUrl("add-mpesa-form");return r&&"/"===r[0]&&(n.recordId&&(r+="/"+n.recordId),r+="?"+Date.now()),r},link:function(e,a,i,o){var c,s=!1;o.init(e,a,"mpesa").setSubmit((function(t){o.isValid()&&n.updateScope(e,(function(){o.sendFormData(e.bpaFormData,t)}))})),o.setRemoveAction((function(n){t.custom({locals:{_injectedProperties:{}},keyboard:!1,controller:"yesNoModalController",templateUrl:"removalWarning.html"}).result.then((function(){e.removeMopUrl&&(document.location=e.removeMopUrl)}),(function(){}))})),e.isAccountHolderPopoverVisible=function(){return s},e.showAccountHolderPopover=function(){c&&(r.cancel(c),c=null),s=!0},e.hideAccountHolderPopover=function(){c&&r.cancel(c),c=r((function(){s=!1,c=null}),100)},e.changeCountry=function(){var t=e.countries.find((function(t){return t.Code2===e.bpaFormData.country}));t&&(e.phone={country:t,number:null},e.mpesaPhonePattern=t.numberPattern)},e.initPhoneCodes=function(t){for(var n in e.countries=[],t)e.countries.push({Code2:n,"Phone Code":t[n].countryCode,numberPattern:t[n].numberPattern});r((function(){e.changeCountry()}))},a[0].querySelector(".bpa-flash-messages")&&o.setNeedAttention()}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(248),n(43),n(258),n(35),n(42),n(12);function r(e,t,n,r,a,i,o,c,s,u,l,d){return{restrict:"E",scope:{currentAe:"<",minChargeAmount:"<",defaultErrorMessage:"@",flowName:"@",addBillingMethodConfig:"<",interfaceObject:"=?",callbackObject:"=?"},templateUrl:u.get("template-pay-due"),link:function(u){var f="pay_now",p=d.create("pay_now_informational_modal"),m=!0,g=!1,b={balance:0,isChargeable:!1},h={mops:[],isManualChargeAllowed:!0},v={};function y(){return m||0===A()}function A(){return b&&!angular.isUndefined(b.balance)&&b.balance<0?Math.abs(b.balance):0}function S(){return h.mops.length>0}function C(){I().finally((function(){y()||function(e,t,n,r){(t=t||{}).flow=u.flowName,a.logBpaEvent(e,n||f,t,r)}(a.EVENT_IMPRESSION,{event_label:"button_enabled"})}))}function E(e){g=!1,e&&e.threeDs||(I(),e&&e.addMop&&M())}function k(){g=!1,I()}function M(){s.show(angular.extend({flowName:u.flowName,enableSubscription:!0,forcePrimary:0},u.addBillingMethodConfig)).then(_)}function _(e){e&&e.success&&(!function(e,t){u.callbackObject&&u.callbackObject[e]&&u.callbackObject[e](t)}("mopAdded",e.mopData),D(e.mopData))}function I(){return m=!0,c.all([r.getInfo(u.currentAe),e.getBalance()]).then(F).catch((function(){r.processFatalErrorInResponse(u.currentAe)})).finally((function(){return m=!1}))}function F(e){var t=e[0];b=e[1],angular.isArray(t.depositMethods)&&(h.mops=t.depositMethods.filter((function(e){return e.canBeManuallyCharged}))),h.isManualChargeAllowed=t.isManualChargeAllowed,v=t.urls}function P(e,t,n){var r=l.open(e,t);r&&(i(w,500),n&&r.then(n),r.catch((function(e){return p.click(e)})))}function w(){var e=document.querySelector("up-c-modal.is-fullscreen.hydrated [slot=body]");p.impression("pay_now_informational_modal_impression",{status_message:e?e.innerText.trim():""})}function D(e){A()>0&&(e&&e.verified&&!S()||!e&&S())&&I()}angular.isUndefined(u.addBillingMethodConfig)&&(u.addBillingMethodConfig={}),u.isDisabled=y,u.getBalanceDue=A,u.payNow=function(){h.isManualChargeAllowed?S()?A()<u.minChargeAmount?P("template-pay-due-less-that-threshold-warning",{minChargeAmount:u.minChargeAmount}):g||(t.open("bpa-pay-due-modal",{currentAe:u.currentAe,minChargeAmount:u.minChargeAmount,defaultErrorMessage:u.defaultErrorMessage,flowName:u.flowName,onClose:E,onCancel:k}),g=!0):P("template-pay-due-no-billing-methods-warning",{},(function(){return M()})):P("template-pay-due-manual-charge-is-not-allowed-warning",{},(function(){return o.location=v.customerSupport}))},u.interfaceObject={refresh:D},u.$watch("currentAe",(function(e,t){e!==t&&C()})),n.subscribe(r.CHANNEL_MOP_ADDED,u,D),n.subscribe(r.CHANNEL_MOP_REMOVED,u,D),C()}}}angular.module("bpa-ui.directives").directive("payDueForm",r),r.$inject=["bpaBalance","gcModal","eoChannel","bpaDepositMethods","bpaEventLog","$timeout","$window","$q","bpaAddBillingMethod","bpaRouting","bpaConfirmation","bpaEventTrackerFactory"]},function(e,t,n){"use strict";n.r(t);n(1);angular.module("bpa-ui.directives").directive("paymentMethodSelector",["eoUtils","$timeout","$compile","bpaRouting",function(e,t,n,r){return{restrict:"E",scope:{ngModel:"=",collection:"<",onChange:"&",name:"@",bpaSelectClass:"@"},templateUrl:r.get("template-payment-method-selector"),link:function(r,a,i){if(angular.isDefined(i.required)&&!a.hasClass("payment-method-required")){a.addClass("payment-method-required");var o=a[0].querySelector("div[bpa-select]");o.setAttribute("required",!0===i.required?"required":i.required),t((function(){return n(angular.element(o))(r)}))}function c(t){angular.isArray(t)&&(r.paymentsCollection=t.map((function(t){var n=t.hasOwnProperty("namePlain")?t.namePlain:t.name,r=n.match(/^(.+) (ending in \d+)$/);if(null===r&&(r=n.match(/^(.+) (\([^()]+)(\))$/)),null!==r){var a='<span class="ellipsis payment-label-second">'.concat(e.escapeText(r[2]),"</span>");t.formattedName='<span class="d-flex payment-label">'+'<span class="ellipsis payment-label-first">'.concat(e.escapeText(r[1]),"&nbsp;</span>")+(r[3]?'<span class="payment-label-middle-ellipsis">'.concat(a).concat(r[3],"</span>"):"".concat(a))+"</span>"}else t.formattedName=n;return t})))}r.change=function(){return t((function(){return r.onChange()}))},c(r.collection),r.$watch("collection",c)}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(22),n(45),n(10),n(5);angular.module("bpa-ui.directives").directive("taxInfoForm",["bpaTaxInfo","bpaRouting","bpaFormValidation","bpaAlert","bpaUrl",function(e,t,n,r,a){return{restrict:"E",templateUrl:t.get("template-tax-form"),scope:{taxInfo:"=?",interfaceObject:"=?",callbackObject:"=?",context:"<"},link:function(t,i,o){var c=!1,s=!1;function u(e){if(angular.isObject(t.callbackObject)&&angular.isFunction(t.callbackObject[e])){for(var n,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(n=t.callbackObject)[e].apply(n,a)}}o.taxInfo||(c=!0,e.get().then((function(e){return t.taxInfo=e.taxInfo})).finally((function(){return c=!1}))),t.interfaceObject=t.interfaceObject||{},angular.extend(t.interfaceObject,{isBlocked:function(){return c},getType:function(){return t.form.type||t.taxInfo&&t.taxInfo.type},triedToSubmit:function(){return s},resetValues:function(){t.taxInfo&&angular.extend(t.form,{type:t.taxInfo.type,tin:"",tinType:t.taxInfo.tinType,legalName:t.taxInfo.legalName,classification:t.taxInfo.classification,classificationOther:t.taxInfo.classificationOther,certification:!1}),s=!1,t.tax_info.$setPristine()},submit:function(){u("submit"),r.clearMessages(),n.revalidateAllFields(t.tax_info),t.tax_info.$valid?(s=!0,c=!0,r.clearMessages(),e.save(t.form,t.context).then((function(e){r.addAlertMessages(e.messages),u("success",e)}),(function(e){e&&e.messages.length>0?r.addAlertMessages(e.messages):r.addFatalErrorMessage(),u("error",e)})).finally((function(){return c=!1}))):u("validationError")}}),angular.extend(t,{form:{},isW9:function(){return"w9"===this.form.type},taxCertificateContents:function(){return this.isW9()?"template-tax-certificate-w9":"template-tax-certificate-w8"},resolveClassification:function(e){return angular.isObject(e)?e.id:e},getAgencyProfileLocationUrl:function(){return a.buildUrl("agency-profile",{context:t.context})}}),t.$watch("taxInfo",(function(e){e&&t.interfaceObject.resetValues()}))}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(22),n(45),n(10),n(42);angular.module("bpa-ui.directives").directive("vatInfoForm",["bpaConfirmation","bpaTaxInfo","bpaRouting","bpaFormValidation","bpaAlert",function(e,t,n,r,a){return{restrict:"E",templateUrl:n.get("template-vat-form"),scope:{vatInfo:"=?",interfaceObject:"=?",callbackObject:"=?",context:"<"},link:function(n,i,o){var c=!1,s=!1;function u(e){if(angular.isObject(n.callbackObject)&&angular.isFunction(n.callbackObject[e])){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=n.callbackObject)[e].apply(t,a)}}function l(){var e=n.isVatSkipped()?t.skipVat(n.context):t.saveVat(n.form.vatId,n.form.registrationDate,n.context);c=!0,e.then((function(e){a.addAlertMessages(e.messages),u("success",e)}),(function(e){e&&e.messages.length>0?a.addAlertMessages(e.messages):a.addFatalErrorMessage(),u("error",e)})).finally((function(){return c=!1}))}function d(){return n.vatInfo.format.defaultHaveVatId?"0":"1"}o.vatInfo||(c=!0,t.get().then((function(e){return n.vatInfo=e.vatInfo})).finally((function(){return c=!1}))),n.interfaceObject=n.interfaceObject||{},angular.extend(n,{form:{skipVat:d(),registrationDate:""},flag:{formatIsCorrect:!0},isVatSkipped:function(){return"1"===n.form.skipVat},datePicker:{isOpen:!1},toggleDatePicker:function(e){e.preventDefault(),e.stopPropagation(),this.datePicker.isOpen=!this.datePicker.isOpen}}),angular.extend(n.interfaceObject,{isBlocked:function(){return c},resetValues:function(){angular.extend(n.form,{skipVat:d(),vatId:"",registrationDate:"",certification:!1}),s=!1,n.vat_info.$setPristine()},triedToSubmit:function(){return s},submit:function(){if(u("submit"),a.clearMessages(),r.revalidateAllFields(n.vat_info),n.vat_info.$valid)if(s=!0,a.clearMessages(),n.isVatSkipped()||n.flag.formatIsCorrect)l();else{var t=e.open("template-vat-format-warning",{vatFormat:n.vatInfo.format});t&&t.then((function(){return l()}))}else u("validationError")}})}}}])},function(e,t,n){"use strict";n.r(t);n(1),n(5),n(14),n(263);angular.module("bpa-ui.directives").directive("verifyPaymentMethod",["bpaUrl","bpa","$timeout","$window","bpaVerifyMopEventLogger",function(e,t,n,r,a){return{restrict:"E",require:"bpaBaseForm",scope:{mopRid:"=?",mopData:"=?",forcePrimary:"<",allowPrimary:"<",callbackObject:"=?"},templateUrl:e.resourceUrl("verify-payment/partial/modern-form.partial.html"),link:function(n,r,i,o){var c=!1;!function(){o.init(n,r,"verifyPaymentMethod"),o.setActionUrl(e.baseUrl(!0)+"verify-payment"),o.setSubmit(u),o.setCheckSuccessResponse(l),o.setEventLogger(a);var t=o.getInterfaceObject();t.isBlocked=function(){return c||o.isScreenLocked("form")},t.isLoading=function(){return c}}(),n.$watch("mopRid",(function(e){e&&(n.mopData||(c=!0,t.getMethodOfPaymentInfo(e,(function(e){e&&e.id?n.mopData=e:o.showErrorNotification(),c=!1}),(function(){o.showErrorNotification(),c=!1}))))})),n.$watch("mopData",(function(e){e&&e.type&&a.setMopType(e.type)}));var s=n.$watch("allowPrimary",(function(e){e&&(n.$watch("bpaFormData.makePrimary",(function(e){a.setMakePrimary(Boolean(e))})),s())}));function u(e){n.mopData&&o.isValid()&&(n.bpaFormData.mopRid=n.mopData.id,n.bpaFormData.forcePrimary=-1!==["CC","ACH_DEPOSIT"].indexOf(n.mopData.type)&&(Boolean(n.forcePrimary)||Boolean(n.allowPrimary)&&n.bpaFormData.makePrimary),o.sendFormData(n.bpaFormData,e))}function l(e){return Boolean(e.verified)}n.getEventData=a.getEventData}}}])},function(e,t,n){var r={"./base.js":96,"./bpa-template-loading-error.js":670};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=669},function(e,t,n){"use strict";n.r(t);n(96),n(93);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}angular.module("bpa-ui.interceptors").factory("bpaTemplateLoadingError",["$q","$injector","$window","$templateCache","bpaNetworkErrors",function(e,t,n,a,i){var o=Applet.getVar("bpa_ui_base_url")||[];function c(e){for(var t=o.length-1;t>=0;t--)if(0===e.indexOf(o[t]))return!0;return!1}return"string"==typeof o&&(o=[o]),{request:function(e){return e.isBpaTemplateRequest="GET"===e.method&&-1!==e.url.indexOf(".html")&&"object"===r(e.cache)&&void 0===e.cache.get(e.url)&&c(e.url),e},responseError:function(r){if(!r.config)return e.reject("Invalid Response.");if(r.config.isBpaTemplateRequest){var a="application/json"===r.headers("content-type")?JSON.parse(r.data):r.data;return i.setErrorForUrl(r.config.url,r.status,a),c(n.location.pathname)&&function(){var e=t.get("bpaConfirmation");if(!e)throw"bpa-ui.interceptors requires bpaConfirmation";var r=e.open("template-loading-error-modal");r&&r.then((function(){return n.location.reload()}))}(),r.status=200,r.statusText="OK",r.data="",e.resolve(r)}return e.reject(r)}}}])},function(e,t,n){var r={"./base.js":28,"./closable-popup-controller.js":672,"./deposit-method.js":673,"./disbursement-method.js":674,"./simple-modal.js":675,"./us-us-method.js":676,"./yes-no-modal-controller.js":66};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=671},function(e,t,n){"use strict";n.r(t);n(28);angular.module("bpa-ui.controllers").controller("closablePopupController",["$scope","$modalInstance","_injectedProperties",function(e,t,n){e.injectedProperties=n,e.close=function(e){t.dismiss(e)}}])},function(e,t,n){"use strict";n.r(t);n(28),n(5);angular.module("bpa-ui.controllers").controller("depositMethodCtrl",["$scope","$location","$window","bpaUrl",function(e,t,n,r){var a=r.getMainBillingMethodsPageUri();e.cancelUrl=a,e.showTemporaryCharge=!1,e.callbackObject={success:function(t){t&&t.id&&("1"===t.verify?(n.scroll(0,0),e.showTemporaryCharge=!0):document.location=a)}}}])},function(e,t,n){"use strict";n.r(t);n(28),n(5);angular.module("bpa-ui.controllers").controller("disbursementMethodCtrl",["$scope","$location","$window","bpaUrl",function(e,t,n,r){var a=r.getDisbursementMethodsPageUri();e.cancelUrl=a,e.showTemporaryCharge=!1,e.callbackObject={success:function(e){e&&e.id&&(document.location=e.return_to||a)}}}])},function(e,t,n){"use strict";n.r(t);n(28),n(19);function r(e){var t=this;this.result=!1,this.cancel=function(){t.result=!1,t.close()},this.ok=function(){t.result=!0,t.close()},this.isSmallScreen=function(){return e.isSmallScreen()}}angular.module("bpa-ui.controllers").controller("simpleModalController",r),r.$inject=["bpaScreenSize"]},function(e,t,n){"use strict";n.r(t);n(28);angular.module("bpa-ui.controllers").controller("usUsCtrl",["$scope",function(e){var t=Applet.getVar("find_work_home_uri")||"/";e.cancelUrl=t,e.showTemporaryCharge=!1,e.callbackObject={success:function(){document.location=t}}}])},function(e,t,n){var r={"./base.js":18,"./bpa-add-billing-method-modal.js":678,"./bpa-confirmation-modal.js":252,"./bpa-instant-pay-modal.js":679,"./bpa-pay-due-modal.js":680,"./bpa-paypal-modal.js":681,"./bpa-plaid-modal.js":682,"./bpa-verify-mop-modal.js":255,"./bpa-withdrawal-modal.js":683,"./disbursement-methods-popup.js":684,"./disbursement-schedule-modal.js":685};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=677},function(e,t,n){"use strict";n.r(t);n(18);var r=n(2);function a(e,t,n,a,i){var o=this,c=this,s=null,u=null,l=null;function d(){n[0].getElementById("bpa-add-primary-payment-modal").shadowRoot.querySelector(".modal-body").setAttribute("style","display: flex; flex-direction: column; flex: 1 0 auto;")}function f(e){s={success:!0,mopData:e}}function p(){s&&s.success?c.onSuccess(s):(s&&s.threeDs&&u&&u.resolve(c.config.threeDsCallback(l)),c.onClose(s))}e.$on("$destroy",(function(){return c.onRemoved()})),this.pageTitles={},this.addBillingInterface={},this.addBillingCallback={success:function(e){f(e),c.close()},error:function(e){s=e,c.close()}},c.config.threeDsCallback&&(this.addBillingCallback.threeDs=function(e){return u=i.defer(),l=e,s={threeDs:!0},c.close(),u.promise}),this.handleClosed=function(e){"UP-C-MODAL"===e.target.tagName&&(null===s?(t.create(r.q).click("close_widget"),o.addBillingInterface.getPaymentData((function(e){e?f(e):s=!1,p()}))):p())},this.getPageTitle=function(){var e="";return o.addBillingInterface.getCurrentStep&&(e=o.addBillingInterface.getCurrentStep()),o.pageTitles[e]},a((function(){c.onReady().then(d)}))}angular.module("bpa-ui.components").component("bpaAddBillingMethodModal",{bindings:{config:"<",onSuccess:"<",onClose:"<",onRemoved:"<"},templateUrl:["bpaRouting",function(e){return e.get("template-add-billing-method-modal")}],controller:a,controllerAs:"vm"}),a.$inject=["$scope","bpaEventTrackerFactory","$document","$timeout","$q"]},function(e,t,n){"use strict";n.r(t);n(18),n(44);angular.module("bpa-ui.components").component("bpaInstantPayModal",{bindings:{currentAccountRid:"<",onSuccess:"<",onCancel:"<",onClose:"<",onRemoved:"<"},templateUrl:["bpaRouting",function(e){return e.get("template-add-ipo-modal")}],controller:i,controllerAs:"vm"}),i.$inject=["bpaDisburse","bpaVars","bpaAlert","bpaScreenSize","$timeout","$scope"];var r=1,a=2;function i(e,t,n,i,o,c){var s,u=this,l=this;this.result=null,this.state=r,this.schedule=null,this.paymentMethods=null,this.getTitle=function(){return t.get(u.isAddCardState()?"addMethodTitle":"scheduleTitle")},this.cancel=function(){u.close()},this.cardCallback={success:function(t){l.result=t,n.addAlertMessages(t.messages),l.isBlocked=!0,e.getDataForAeRid(l.currentAccountRid,[e.MOP_LIST],!0).then((function(t){return l.paymentMethods=t[e.MOP_LIST],e.hasSchedule(l.currentAccountRid)})).then((function(n){if(!n)return l.preselectedMop=t.id,e.getDataForAeRid(l.currentAccountRid,[e.CURRENT_SCHEDULE],!0).then((function(t){l.schedule=t[e.CURRENT_SCHEDULE],l.state=a}));l.close()})).catch((function(){n.addFatalErrorMessage(l.currentAccountRid),l.close()})).finally((function(){return l.isBlocked=!1}))}},this.scheduleCallback={success:function(){l.close()}},this.handleClose=function(e){"UP-C-MODAL"===e.target.tagName&&(null!==u.result&&angular.isFunction(u.onSuccess)&&u.onSuccess(),angular.isFunction(u.onClose)&&u.onClose(u.result))},this.isAddCardState=function(){return r===u.state},this.isScheduleState=function(){return a===u.state},this.isSmallScreen=function(){return i.isSmallScreen()},this.isContentBlocked=function(){return u.isBlocked||u.cardInterface&&u.cardInterface.isBlocked&&u.cardInterface.isBlocked()||u.scheduleInterface&&u.scheduleInterface.isBlocked&&u.scheduleInterface.isBlocked()},c.$on("$destroy",(function(){return l.onRemoved()})),l.isBlocked=!0,s=c.$watch((function(){return l.cardInterface&&l.cardInterface.isBlocked&&l.cardInterface.isBlocked()||!1}),(function(e,t){t&&(l.isBlocked=!1,s())}))}},function(e,t,n){"use strict";n.r(t);n(18),n(19),n(64);function r(e,t,n,r,a,i,o,c){var s=this,u=o.create("pay_now_form"),l=this,d=!1,f=null,p=null,m={balance:0,isChargeable:!1};function g(e){var t=e[0];angular.isArray(t.depositMethods)&&(l.mops=t.depositMethods.filter((function(e){return e.canBeManuallyCharged})),l.mops.length>0?l.selectedMop=l.mops[0]:S("noMops")),A(e[1]),0===l.getBalanceDue()?S("noDue"):l.getBalanceDue()<l.minChargeAmount?S("dueIsLess"):t.isManualChargeAllowed||S("manualChargeIsNotAllowed"),l.isPage("form")?u.impression("widget_load"):k()}function b(){S("network"),k()}function h(){return l.isCustomAmount()?1*l.customAmount:l.getBalanceDue()}function v(e){if(e.ccRequestId)return p=e.ccRequestId,void l.closeModal({threeDs:!0});var t;t=e.paymentStatus,-1!==["SUCCESS","INITIATED","REQUESTED","PENDING"].indexOf(t)?(l.page="success",l.paymentMessage=e.message,u.impression("success_event_paid",M())):l.mops.length>1?(l.error=e.message,C(l.error)):(l.page="failure",l.paymentMessage=e.message,C(l.paymentMessage)),A(e)}function y(e){var t=e.data;t.message?l.error=t.message:l.error=l.defaultErrorMessage,C(l.error),angular.isUndefined(t.balance)||A(t)}function A(e){m.balance=e.balance,m.isChargeable=e.isChargeable}function S(e){l.initErrors[e]=!0,l.page="init"}function C(e){u.impression("error_event_processing_error",M(e))}function E(){var e=F();e&&angular.forEach(r.extract(e),(function(e){return u.impression("error_event_validation_errors",M(e))}))}function k(){a((function(){return u.impression("error_event_processing_error",{status_message:_()})}),100)}function M(e){var t={amount:I(),whole_balance:!l.isCustomAmount(),mop_type:l.selectedMop.type};return e&&(t.status_message=e),t}function _(){var e=F();if(e){var t=e.querySelector(".bpa-init-error [data-ng-messages]:not(.ng-hide)");return t?t.innerText.trim():void 0}}function I(){var e=h();return e>=500?">=500":e>=100?">=100":e<100?"<100":void 0}function F(){return document.getElementById("pay-balance-due-modal")}function P(){return h().toFixed(2)}l.mops=[],l.depositType="full",l.selectedMop=null,l.customAmount="",l.paymentMessage="",l.initErrors={},l.error="",l.page="form",d=!0,n.all([t.getInfo(l.currentAe),e.getBalance()]).then(g,b).finally((function(){return d=!1})),this.closeModal=function(e){f=e,s.close()},this.handleClosed=function(t){"UP-C-MODAL"===t.target.tagName&&(null===f&&(f="close"),"close"===f||"cancel"===f?(u.click(f),s.onCancel(f)):(s.onClose(f),f.threeDs&&c.redirectToIssuer(p,e.buildPayBalanceDue3dsUrl(l.selectedMop.rid,P(),p))))},this.getBalanceDue=function(){return!angular.isUndefined(m.balance)&&m.balance<0?Math.abs(m.balance):0},this.submit=function(){u.click("pay_now",M()),function(){l.isCustomAmount()&&(l.payDueForm.customAmount.$setDirty(),l.payDueForm.customAmount.$validate());return l.payDueForm.$valid}()?(d=!0,(void(l.error=""),e.payBalanceDue(l.selectedMop.rid,P(),c.getBrowserInfo()).then(v,y)).finally((function(){return d=!1}))):a(E,100)},this.isBlocked=function(){return d},this.isSubmitDisabled=function(){return d||!l.selectedMop||!m.isChargeable},this.isCustomAmount=function(){return"custom"===l.depositType},this.depositTypeChanged=function(){l.isCustomAmount()||(l.customAmount="",l.payDueForm.customAmount.$setPristine())},this.customAmountFocused=function(){return l.depositType="custom"},this.isPayPal=function(){return l.selectedMop&&"PAYPAL_DEPOSIT"===l.selectedMop.type},this.isPage=function(e){return l.page===e},this.isSmallScreen=function(){return i.isSmallScreen()}}angular.module("bpa-ui.components").component("bpaPayDueModal",{bindings:{currentAe:"<",minChargeAmount:"<",defaultErrorMessage:"<",flowName:"<",onClose:"<",onCancel:"<"},templateUrl:["bpaRouting",function(e){return e.get("template-pay-due-modal")}],controller:r,controllerAs:"vm"}),r.$inject=["bpaBalance","bpaDepositMethods","$q","bpaValidationErrors","$timeout","bpaScreenSize","bpaEventTrackerFactory","bpaThreeDs"]},function(e,t,n){"use strict";n.r(t);n(44),n(27);angular.module("bpa-ui.components").component("bpaPayPalModal",{bindings:{currentAccountRid:"<",onSuccess:"<",onCancel:"<",onClose:"<",onRemoved:"<"},templateUrl:["bpaRouting",function(e){return e.get("template-add-paypal-modal")}],controller:i,controllerAs:"vm"}),i.$inject=["bpaDisburse","bpaVars","bpaScreenSize","bpaUrl","bpaOauth2Http","$q","bpaAlert","bpaIovation"];var r=1,a=2;function i(e,t,n,i,o,c,s,u){var l=this,d=this;this.isBlocked=!1,this.alternateEmail=null,this.daysToApply=0,this.fee=null,this.result=null,this.state=r,this.schedule=null,this.paymentMethods=null,this.getTitle=function(){return t.get(l.isAddState()?"addMethodTitle":"scheduleTitle")},this.cancel=function(){l.close()},this.submit=function(){d.isBlocked=!0;var t={};u.setBlackBox(t,(function(){o.post(i.buildUrl("save-paypal",{context:Applet.getOrganization().getUid(),accountingEntity:d.currentAccountRid}),{paypal_form:t}).then((function(t){d.result=t,s.addAlertMessages(t.data.messages),e.getDataForAeRid(d.currentAccountRid,[e.MOP_LIST],!0).then((function(t){return d.paymentMethods=t[e.MOP_LIST],e.hasSchedule(d.currentAccountRid)})).then((function(n){if(!n)return d.preselectedMop=t.id,e.getDataForAeRid(d.currentAccountRid,[e.CURRENT_SCHEDULE],!0).then((function(t){d.schedule=t[e.CURRENT_SCHEDULE],d.state=a}));d.close()})).catch((function(){s.addFatalErrorMessage(d.currentAccountRid,"add-paypal-modal"),d.close()})).finally((function(){return d.isBlocked=!1}))}),(function(){d.isBlocked=!1,s.addFatalErrorMessage(d.currentAccountRid,"add-paypal-modal")}))}))},this.scheduleCallback={success:function(){d.close()}},this.handleClose=function(e){"UP-C-MODAL"===e.target.tagName&&(null!==l.result&&angular.isFunction(l.onSuccess)&&l.onSuccess(),angular.isFunction(l.onClose)&&l.onClose(l.result))},this.isAddState=function(){return r===l.state},this.isScheduleState=function(){return a===l.state},this.isSmallScreen=function(){return n.isSmallScreen()},this.isContentBlocked=function(){return l.isBlocked||l.scheduleInterface&&l.scheduleInterface.isBlocked&&l.scheduleInterface.isBlocked()},d.isBlocked=!0,c.all([o.get(i.buildUrl("load-paypal-form",{context:Applet.getOrganization().getUid(),accountingEntity:d.currentAccountRid})),e.getDataForAeRid(d.currentAccountRid,[e.MOP_TYPES])]).then((function(t){var n=t[1][e.MOP_TYPES].types.find((function(e){return"PAYPAL"===e.type}));d.alternateEmail=t[0].data.alternateEmail,d.daysToApply=n.daysToApply,d.fee=n.fee})).finally((function(){return d.isBlocked=!1}))}},function(e,t,n){"use strict";n.r(t);n(18),n(52),n(19);function r(e,t,n,r){var a=this,i=this,o=null;this.isAddPlaidFormActive=function(){return e.isAddPlaidFormActive()},this.isSmallScreen=function(){return n.isSmallScreen()},this.handleClosed=function(e){"UP-C-MODAL"===e.target.tagName&&a.onClose(o)},t((function(){i.onReady().then((function(){r[0].getElementById("bpa-add-plaid-modal").shadowRoot.querySelector(".modal-body").setAttribute("style","display: flex; flex-direction: column; flex: 1 0 auto;"),i.onOpened&&i.onOpened()}))}),500),Object.assign(this.interfaceObject,{closeModal:function(){o=!1,i.close()}})}angular.module("bpa-ui.components").component("bpaPlaidModal",{bindings:{config:"<",accountTypes:"<",interfaceObject:"=",callbackObject:"<",forcePrimary:"<",onClose:"<",onOpened:"<"},templateUrl:["bpaRouting",function(e){return e.get("template-plaid-modal")}],controller:r,controllerAs:"vm"}),r.$inject=["plaid","$timeout","bpaScreenSize","$document"]},function(e,t,n){"use strict";n.r(t);n(18),n(44),n(13),n(10),n(19);function r(e,t,n,r,a){var i=this,o=this;this.result=null,this.cancel=function(){o.close()},this.callbackObject={loadingError:function(){n.addFatalErrorMessage(o.currentAccountRid),r((function(){return o.close()}),500)},success:function(){o.result=!0}},this.handleClose=function(e){"UP-C-MODAL"===e.target.tagName&&(!0===i.result&&angular.isFunction(i.onSuccess)?i.onSuccess():angular.isFunction(i.onClose)&&i.onClose())}}angular.module("bpa-ui.components").component("bpaWithdrawalModal",{bindings:{currentAccountRid:"<",forceMethodType:"<",onSuccess:"<",onClose:"<"},templateUrl:["bpaRouting",function(e){return e.get("template-disburse-modal")}],controller:r,controllerAs:"vm"}),r.$inject=["bpaDisburse","bpaVars","bpaAlert","$timeout","$element"]},function(e,t,n){"use strict";n.r(t);n(18);angular.module("bpa-ui.components").component("disbursementMethodsPopup",{bindings:{currentAccountRid:"<",paymentTypes:"<",onClose:"<"},templateUrl:["bpaRouting",function(e){return e.get("template-disbursement-methods-popup")}],controller:function(){var e,t=this,n=this;this.callbackObject={paymentAdded:function(){e=!0,n.close()}},this.handleClose=function(n){"UP-C-MODAL"===n.target.tagName&&angular.isFunction(t.onClose)&&t.onClose(e)}},controllerAs:"vm"})},function(e,t,n){"use strict";n.r(t);n(18),n(19);function r(e){var t=this,n=this;this.result=null,this.cancel=function(){t.result="cancel",t.close()},this.formCallbacks={success:function(e){n.result=e,n.close()}},this.handleClose=function(e){"UP-C-MODAL"===e.target.tagName&&angular.isFunction(t.onClose)&&t.onClose(t.result)},this.isSmallScreen=function(){return e.isSmallScreen()}}angular.module("bpa-ui.components").component("disbursementScheduleModal",{bindings:{schedule:"<",paymentMethods:"<",currentAccountRid:"<",onClose:"<"},templateUrl:["bpaRouting",function(e){return e.get("template-disbursement-schedule-form-modal")}],controller:r,controllerAs:"vm"}),r.$inject=["bpaScreenSize"]},function(e,t,n){var r={"./ae-manage.js":29,"./ae-messages.js":53,"./base.js":46,"./lock-submit.js":67,"./scroller.js":68};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=686},function(e,t,n){var r={"./ae-header-link.js":688,"./ae-init.js":689,"./align-left.js":690,"./auto-focus.js":691,"./base.js":23,"./hidden-title.js":692,"./save-scroll-pos.js":693,"./team-init.js":694,"./title-provider.js":695};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=687},function(e,t,n){"use strict";n.r(t);n(23);angular.module("bpa-ui.financial-accounts.directives").directive("aeHeaderLink",[function(){return{restrict:"A",scope:{aeHeaderLink:"@"},link:function(e,t){e.$watch("aeHeaderLink",(function(){void 0!==e.aeHeaderLink&&t.text(function(e,t){t<e.length&&(e=e.substr(0,t-3)+"...");return e}(e.aeHeaderLink,25))}))}}}])},function(e,t,n){"use strict";n.r(t);n(23),n(29);angular.module("bpa-ui.financial-accounts.directives").directive("aeInit",["aeManage",function(e){return{restrict:"A",link:function(t,n,r){var a=n[0].querySelector(".ae-name");e.registerExistingAe({aeId:r.aeId,name:a?a.innerText.trim():"",hidden:"false"!=r.aeHidden&&"0"!=r.aeHidden,suspended:"false"!=r.aeSuspended&&"0"!=r.aeSuspended})}}}])},function(e,t,n){"use strict";n.r(t);n(23);angular.module("bpa-ui.financial-accounts.directives").directive("alignLeft",["$timeout",function(e){return{restrict:"A",link:function(t,n){var r=n[0],a=document.querySelector(".container");function i(){if(r.offsetWidth>a.offsetWidth){var e=function e(t){return t.offsetParent?t.offsetLeft+e(t.offsetParent):t.offsetLeft}(a),t=(a.offsetWidth-r.offsetWidth)/2;r.style.position="relative",r.style.left=(e+t<0?10-e:t)+"px"}}e(i),window.addEventListener("resize",(function(){i()}))}}}])},function(e,t,n){"use strict";n.r(t);n(23);angular.module("bpa-ui.financial-accounts.directives").directive("autoFocus",["$timeout",function(e){return{restrict:"A",link:function(t,n){e((function(){n[0].focus()}),300)}}}])},function(e,t,n){"use strict";n.r(t);n(23);angular.module("bpa-ui.financial-accounts.directives").directive("hiddenTitle",[function(){return{restrict:"A",require:"^^titleProvider",link:function(e,t,n,r){n.ngDisabled&&e.$watch(n.ngDisabled,(function(e){e?t.attr("title",r.getTitle("hidden")):t.removeAttr("title")}))}}}])},function(e,t,n){"use strict";n.r(t);n(23),n(68);angular.module("bpa-ui.financial-accounts.directives").directive("saveScrollPos",["scroller",function(e){return{restrict:"A",link:function(t,n){var r,a,i=n[0];i.addEventListener("mousedown",(function(){r=e.getPosition().left})),i.addEventListener("mouseup",(function(){clearTimeout(a),a=setTimeout((function(){e.getPosition().left!=r&&e.setPosition(r,null)}))}))}}}])},function(e,t,n){"use strict";n.r(t);n(23),n(29);angular.module("bpa-ui.financial-accounts.directives").directive("teamInit",["aeManage",function(e){return{restrict:"A",link:function(t,n,r){var a=n[0].querySelector(".team-name");e.registerExistingTeam({teamId:r.teamId,name:a?a.innerText.trim():"",disabled:"false"!=r.teamDisabled&&"0"!=r.teamDisabled,hidden:"false"!=r.teamHidden&&"0"!=r.teamHidden,isRoot:"false"!=r.teamRoot&&"0"!=r.teamRoot})}}}])},function(e,t,n){"use strict";n.r(t);n(23);angular.module("bpa-ui.financial-accounts.directives").directive("titleProvider",[function(){return{restrict:"A",require:"titleProvider",link:function(e,t,n,r){r.setTitle("hidden",n.titleHidden)},controller:[function(){var e={};this.getTitle=function(t){return e[t]},this.setTitle=function(t,n){e[t]=n}}]}}])},function(e,t,n){var r={"./add-ae-modal.js":697,"./base.js":30,"./edit-ae-modal.js":698,"./edit-ae.js":699,"./financial-accounts-big-account.js":700,"./financial-accounts.js":701,"./submit-modal.js":702};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=696},function(e,t,n){"use strict";n.r(t);n(30),n(29);angular.module("bpa-ui.financial-accounts.controllers").controller("AddAeModalCtrl",["$scope","$modalInstance","aeManage",function(e,t,n){e.aeLimit=n.getAddAeLimit(),e.ok=function(){t.close()}}])},function(e,t,n){"use strict";n.r(t);n(30),n(29);angular.module("bpa-ui.financial-accounts.controllers").controller("EditAeModalCtrl",["$scope","$modalInstance","aeManage","item",function(e,t,n,r){var a={};e.currentName=r.name,e.item=r,function(){for(var e in r)a[e]=r[e]}(),e.isHideAeDisabled=function(){return!n.canHideAe(r.aeId)},e.ok=function(){e.canSubmit()&&t.close(e.item)},e.canSubmit=function(){if(!r.name)return!1;for(var e in r)if(a[e]!=r[e])return!0;return!1},e.cancel=function(){t.dismiss("cancel")}}])},function(e,t,n){"use strict";n.r(t);n(30),n(29);angular.module("bpa-ui.financial-accounts.controllers").controller("editAeCtrl",["$routeParams","$modal","$location","aeManage",function(e,t,n,r){function a(){n.path("/")}!function(e){var n=r.getAeById(e);if(!n)return;t.open({templateUrl:"editAeModalContent.html",controller:"EditAeModalCtrl",resolve:{item:function(){return{aeId:n.aeId,name:n.name,hidden:n.hidden}}}}).result.then((function(e){r.updateAe(e),a()}),(function(){a()}))}(e.aeId)}])},function(e,t,n){"use strict";n.r(t);n(30),n(67),n(29),n(53);angular.module("bpa-ui.financial-accounts.controllers").controller("FinancialAccountsBigAccountCtrl",["$scope","$modal","lockSubmit","aeManage","aeMessages",function(e,t,n,r,a){var i=!0;e.showHidden=!1,e.isLocked=n.isLocked,e.messagesService=a,e.teamId="",e.accountingEntityId=null,e.newAe={},e.getTeamName=r.getTeamName;var o=Applet.getVar("big_account_aes");for(var c in o){var s=o[c];for(var u in r.registerExistingAe({aeId:s.id,name:s.name,hidden:s.hidden,suspended:s.suspended}),s.teams){var l=s.teams[u];r.registerExistingTeam({teamId:l.id,name:l.name,disabled:l.disabled,hidden:l.hidden,fullName:l.fullName,isRoot:l.isRoot}),r.getFinData()[l.id]=s.id,r.setFinInitData(l.id,s.id)}}function d(){return""!=e.teamId&&null==e.accountingEntityId}function f(e,t){var n=r.isRootAe(e.aeId),a=r.isRootAe(t.aeId),i=0;if(!e.hidden&&t.hidden)i=-1;else if(e.hidden&&!t.hidden)i=1;else if(n&&!a)i=-1;else if(!n&&a)i=1;else{var o=e.name.toLowerCase(),c=t.name.toLowerCase();o<c?i=-1:o>c&&(i=1)}return i}function p(){var t=null;e.teamId&&(t=r.getAeInitiallyAssignedToTeam(e.teamId).aeId);e.accountingEntityId=t}function m(e){i=!e}function g(e){var n;r.aboutToAssignForExistingAe()&&(n="assign"),r.aboutToCreateAe()&&(n=n?"assign_create":"create");var a=function(e,n){return t.open({templateUrl:"submitModalContent.html",controller:"SubmitModalCtrl",resolve:{params:function(){return{mode:e,params:n}}}}).result}(n,r.getAffectedTeamObjects());return a.then((function(){r.assignCreate().success((function(){e&&e()}))})),a}e.getAeList=function(){var e=[],t=r.getExistingAes();for(var n in t)e.push(t[n]);return e.sort(f)},e.getTeamsAssignedToAe=function(e){return r.getTeamsInitiallyAssignedToAe(e)},e.onChangeTeam=function(){r.resetFinData(),r.removeUnusedNewAe(),i=!0,p()},e.onChangeAe=function(){if(r.resetFinData(),r.removeUnusedNewAe(),i=!0,e.teamId)if(d())if(r.aeLimitRiched())t.open({templateUrl:"noAddAeModalContent.html",controller:"AddAeModalCtrl"});else{var n=r.addNewAe(r.getTeamName(e.teamId));e.newAe=r.getNewAeById(n),r.getFinData()[e.teamId]=r.createTemporaryNewAeId(e.newAe.id),r.canTeamSwitchAe(e.teamId,void 0,m)}else r.getFinData()[e.teamId]=e.accountingEntityId,r.canTeamSwitchAe(e.teamId,e.accountingEntityId,m)},e.submit=function(){e.submitIsLocked()||(d()?g((function(){p()})):g())},e.submitIsLocked=function(){return n.isLocked()||r.isFinDataEmpty()||d()&&(!e.newAe.name||r.isRootAeSuspended())||!i},e.isNewAeAddingAvailable=function(){return d()&&!r.isFinDataEmpty()&&!r.isRootAeSuspended()},e.getAddAeHint=function(){return d()&&r.isRootAeSuspended()?r.getAddAeHint():""}}])},function(e,t,n){"use strict";n.r(t);n(30),n(29),n(67),n(53);angular.module("bpa-ui.financial-accounts.controllers").controller("financialAccountsCtrl",["$scope","$timeout","$modal","aeManage","lockSubmit","aeMessages",function(e,t,n,r,a,i){e.finData=r.getFinData(),e.newAeList=r.getNewAeList(),e.showHidden=!1,e.isLocked=a.isLocked,e.getAeName=r.getAeName,e.getAeHidden=r.getAeHidden,e.setFinInitData=r.setFinInitData,e.messagesService=i,e.createTemporaryNewAeId=r.createTemporaryNewAeId,e.getTeamName=r.getTeamName,e.getAddAeHint=r.getAddAeHint,e.submit=function(){var t;e.submitIsLocked()||(r.aboutToAssignForExistingAe()&&(t="assign"),r.aboutToCreateAe()&&(t=t?"assign_create":"create"),function(e,t,r){n.open({templateUrl:"submitModalContent.html",controller:"SubmitModalCtrl",resolve:{params:function(){return{mode:e,params:t}}}}).result.then(r)}(t,r.getAffectedTeamObjects(),(function(){r.assignCreate()})))},e.shouldShowColumn=function(t){return!t||!r.getAeHidden(t)||e.showHidden},e.submitIsLocked=function(){return a.isLocked()||r.isFinDataEmpty()},e.addNewAE=function(t){if(e._finData[t]="",e.canAddNewAEForTeam(t))if(r.aeLimitRiched())n.open({templateUrl:"noAddAeModalContent.html",controller:"AddAeModalCtrl"});else{var a=r.getTeamName(t),i=r.addNewAe(a);e.finData[t]=r.createTemporaryNewAeId(i),r.countNewUsedAe(t)}},e.canAddNewAEForTeam=function(t){if(r.isRootAeSuspended())return!1;var n,a=r.extractNewAeId(e.finData[t]);return!a||(0==(n=r.getNewAeCountForTeam(a))||1<n)},e.onChangeAE=function(e){r.countNewUsedAe(e),r.removeUnusedNewAe()}}])},function(e,t,n){"use strict";n.r(t);n(30),n(53);angular.module("bpa-ui.financial-accounts.controllers").controller("SubmitModalCtrl",["$scope","$modalInstance","aeMessages","params",function(e,t,n,r){function a(){return"assign_create"==r.mode}e.messageData=n.formatObjectNameList(r.params),e.teamCount=r.params.length,e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")},e.isCreateMode=function(){return"create"==r.mode||a()},e.isAssignMode=function(){return"assign"==r.mode||a()}}])},function(e,t,n){var r={"./base.js":97,"./vat-ctrl-utils.js":98,"./vat-form.js":99};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=703},function(e,t,n){var r={"./base.js":69,"./bpa-vat-form.js":705,"./bpa-vat-input.js":706};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=704},function(e,t,n){"use strict";n.r(t);n(69),n(99);angular.module("bpa-ui.vat-info.directives").directive("bpaVatForm",["vatForm",function(e){return{restrict:"A",link:function(t,n,r){e.setSubmitUrl(r.actionUrl),e.setFormName(r.name)}}}])},function(e,t,n){"use strict";n.r(t);n(69),n(99);angular.module("bpa-ui.vat-info.directives").directive("bpa-vat-input",["vatForm",function(e){return{require:"ngModel",restrict:"A",link:function(t,n,r,a){e.addInput(r.bpaVatInput,r.ngModel,a)}}}])},function(e,t,n){var r={"./base.js":70,"./vat-Info-main-ctrl.js":708,"./vat-info-edit-ctrl.js":709};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=707},function(e,t,n){"use strict";n.r(t);n(70),n(22),n(65),n(98);angular.module("bpa-ui.vat-info.controllers").controller("vatInfoMainCtrl",["$scope","$window","bpaTaxInfo","cookieManager","vatCtrlUtils",function(e,t,n,r,a){a.setDefaults(e,t,r,n),e.skipEntry=function(){e.locked=!0,e.hasError=!1,n.skipVat().then((function(n){n.data&&n.data.status&&a.redirectToReturnUrl(t),e.locked=!1,e.hasError=!0}),(function(){e.locked=!1,e.hasError=!0}))}}])},function(e,t,n){"use strict";n.r(t);n(70),n(22),n(65),n(98);angular.module("bpa-ui.vat-info.controllers").controller("vatInfoEditCtrl",["$scope","$window","bpaTaxInfo","eoModal","cookieManager","vatCtrlUtils",function(e,t,n,r,a,i){var o={};function c(){e.locked=!0,n.saveVat(e.vatId).then((function(n){n.data&&n.data.status?i.redirectToReturnUrl(t):(e.locked=!1,n.data&&n.data.messages?s(n.data.messages[0]):s())}),(function(){e.locked=!1,s()}))}function s(e){(o={})[e||"net_error"]=!0}e.getErrors=function(){return o},e.locked=!1,i.setDefaults(e,t,a,n),e.isLocked=function(){return e.locked||e.vat_info.$invalid},e.submit=function(){o={},!e.hasOwnProperty("vatIdIsCorrect")||e.vatIdIsCorrect?c():e.vatIdIsCorrect||r.custom({locals:{_injectedProperties:{saveLabel:"submit"}},size:"sm",keyboard:!1,controller:"yesNoModalController",templateUrl:"VatFormatWarning.html"}).result.then((function(){c()}))}}])},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function r(){var e=Applet.getVar("pageId");if(!e||!e.substr)return!1;e=e.substr("Bpa-OdeskBpa-".length);for(var t=0,n=arguments.length;t<n;t++)if(new RegExp("^"+arguments[t]+"(-Explicit.*)?$").test(e))return!0;return!1}n.r(t);n(605),n(12),n(4);var a=n(606);a.keys().forEach(a);n(1);var i=n(607);i.keys().forEach(i);n(96);var o=n(669);o.keys().forEach(o);n(28);var c=n(671);c.keys().forEach(c);n(18);var s=n(677);s.keys().forEach(s);n(5),n(14),n(43);function u(e,t,n,r,a,i){e.currentAe=r.getAccountingEntityRid(),e.switchEntity=function(a){e.currentAe=a,r.setAccountingEntityRid(a),t.path(n.depositMethodsBaseUrl(a,!0)),i.create(i.SUBLOCATION_PAGE).impression(i.LABEL_PAGE_RELOAD)},e.isScreenLoading=function(){return a.isScreenLoading()},e.payDueCallbackObject={mopAdded:function(){e.depositMethodsInterface.refresh()}}}if(angular.module("bpa-ui.deposit-methods.controllers",[]).controller("depositMethodsCtrl",u),u.$inject=["$scope","$location","bpaUrl","bpa","bpaDepositMethods","bpaEventTrackerFactory"],r("DepositMethods")){var l=angular.module("bpa-ui");l.requires.push("bpa-ui.deposit-methods.controllers"),l.config(d)}function d(e,t,n){e.html5Mode({enabled:!0}),t.group="payments",t.page="deposit-methods",n.pageLoadTracking=!0}d.$inject=["$locationProvider","SMF_CONFIG","BPA_EVENT_TRACKING_CONFIG"];n(89),n(13),n(10),n(51),n(61),n(42),n(44),n(60);var f="bpa_ui_disbursement_methods_data";angular.module("bpa-ui.controllers").controller("disbursementMethodsCtrl",["$location","$window","$routeParams","bpaOauth2Http","$anchorScroll","$timeout","$q","gcModal","eoUtils","sensitiveZone","bpaUrl","bpaCachedPostRequest","bpaVars","bpaAlert","bpaVerifyMop","bpaConfirmation","ACCOUNTING_ENTITY_KEY","bpaHashAction","bpaEventTrackerFactory","bpaDisburse","bpaInstantPay",function(e,t,n,r,a,i,o,c,s,u,l,d,p,m,g,b,h,v,y,A,S){var C=this,E=this;this.preferredMop=null,this.hasSchedule=!1,this.pageData=Applet.getAngularCache()[f]||{},this.shouldBlockContent=0;var k=y.create(y.SUBLOCATION_PAGE),M=y.create("payment_details");this.pageData.currentAccountRid||(this.pageData.currentAccountRid=p.get(h)||n.aeId),this.getActionUrl=function(e){return l.disbursementMethodsActionUrl(this.pageData.currentAccountRid,e,!1)};var _,I={schedule:A.CURRENT_SCHEDULE,paymentMethods:A.MOP_LIST,lastWithdrawal:A.LAST_WITHDRAWAL,paymentTypes:A.MOP_TYPES,accountInfo:A.ACCOUNT_INFO},F=!1,P=!1;function w(e,t,n,r){var a=b.open(t,n);if(a){var i=y.create(e);r&&a.then(r),a.then((function(){return i.click("proceed")}),(function(e){return i.click(e)})),i.impression(e+"_impression")}}function D(e){return angular.isObject(e)&&Object.keys(e).length>0}function T(e,t){if(E.hasPaymentMethods())for(var n in E.pageData.paymentMethods)if(t===E.pageData.paymentMethods[n][e])return!0;return!1}function O(){return R([A.MOP_LIST],!0)}function R(e,t){var n=E.pageData.currentAccountRid;return E.setContentBlock(!0),A.getDataForAeRid(n,e,t).catch((function(){m.clearMessages(n),m.addFatalErrorMessage(n)})).finally((function(){E.setContentBlock(!1)}))}function j(e){for(var t in I)if(e===I[t])return t}function N(e){var t=g.show(e,{allowPrimary:!1,enableSubscription:!1});t&&t.then((function(){return O()}))}A.addDataUpdateCallback((function(e,t){for(var n in t)if(t.hasOwnProperty(n))switch(E.pageData[j(n)]=t[n],n){case A.MOP_LIST:angular.forEach(E.pageData.paymentMethods,(function(e){var t=e.descriptionSuffix.match(/^(.+)(\d{4})$/);e.oneLineDescription='<span class="d-flex"><span class="ellipsis">'.concat(s.escapeText(e.label))+(t?"".concat(s.escapeText(t[1]),"</span>&nbsp;<span>").concat(t[2]):s.escapeText(e.descriptionSuffix))+".</span></span>"}));case A.CURRENT_SCHEDULE:A.hasSchedule(e).then((function(e){C.hasSchedule=e})),A.getPreferredMop(e).then((function(e){C.preferredMop=e}))}})),this.hasPaymentMethods=function(){return!angular.isUndefined(this.pageData.paymentMethods)&&D(this.pageData.paymentMethods)},this.hasPaymentMethodsWithStatus=function(e){return T("status",e)},this.hasPaymentMethodsWithCode=function(e){return T("code",e)},this.hasAvailableMethods=function(){return this.pageData.paymentTypes&&this.pageData.paymentTypes.types},this.hasAvailableMethodWithType=function(e){var t=this.pageData.paymentTypes;if(!t)return!1;for(var n=(t.types||[]).concat(t.recommendedTypes||[]),r=0,a=n.length;r<a;r++)if(n[r].type===e)return!0;return!1},this.getBalance=function(){return this.pageData.accountInfo&&this.pageData.accountInfo.balance||0},this.hasNegativeBalance=function(){return this.pageData.accountInfo&&this.pageData.accountInfo.balance<0},this.isEligibleForAddIPO=function(){return!C.hasPaymentMethodsWithCode("IPO")&&C.hasAvailableMethodWithType("IPO")},this.openAddPaymentMethodModal=function(e){A.openAddPaymentMethodModal(C.pageData.currentAccountRid,e)},this.onGetPaidClicked=function(e){var n=this,r=this;if(this.pageData.accountInfo.taxInfo.incomplete)w("modal_no_tax_info","template-disburse-warning-tax-info",{taxInfoType:this.pageData.accountInfo.taxInfo.type},(function(){return t.location=r.pageData.urls.taxInfo}));else if(this.hasPaymentMethods())if(this.pageData.accountInfo.isSuspended)w("modal_ae_suspended","template-disburse-warning-account-suspended",{},(function(){return t.location=r.pageData.urls.customerSupport}));else if(this.hasPaymentMethodsWithStatus("NOTVALIDYET")&&!this.hasPaymentMethodsWithStatus("ACTIVE"))w("modal_upm_is_not_active","template-disburse-warning-method-not-valid");else if(this.hasPaymentMethods()&&!this.hasPaymentMethodsWithStatus("ACTIVE"))w("modal_no_active_upms","template-disburse-warning-no-active-methods");else{var a=this.pageData.currentAccountRid,i=A.openModal(a,e);i&&i.then((function(){n.setContentBlock(!0),A.getDataForAeRid(a,[A.ACCOUNT_INFO,A.LAST_WITHDRAWAL],!0).finally((function(){return n.setContentBlock(!1)}))}))}else w("modal_no_upms","template-disburse-warning-no-payment-methods",{},(function(){return r.showDisbursementMethodsPopup()}))},this.getPreferredMop=function(){return this.preferredMop},this.hasAdditionalMop=function(){for(var e in this.pageData.paymentMethods)if(this.pageData.paymentMethods.hasOwnProperty(e)&&this.preferredMop&&String(this.preferredMop.id)!==String(e))return!0;return!1},this.getPaymentStatus=function(e){var t={};return t[e.status]=!0,t},this.switchAccount=function(t){for(var n in this.pageData.currentAccountRid=t,I)I.hasOwnProperty(n)&&delete this.pageData[n];var r;r=this.pageData,Applet.getAngularCache()[f]=r,e.path(l.disbursementMethodsActionUrl(t,"",!0)),k.impression(y.LABEL_PAGE_RELOAD)},this.showDisbursementScheduleModal=function(){if(!P){var e=y.create("schedule_form");c.open("disbursement-schedule-modal",{schedule:this.pageData.schedule,paymentMethods:this.pageData.paymentMethods,currentAccountRid:this.pageData.currentAccountRid,onClose:function(t){P=!1,t&&"cancel"!==t||e.click(t||"close")}}),P=!0,e.impression("schedule_form_impression")}},this.verifyMop=function(e){M.click("verify"),N(e.id)},this.hasLastWithdrawal=function(){return D(C.pageData.lastWithdrawal)},this.initiateVerification=function(e){function n(e){M.messages("error_event_initiate_verification",[e])}b.open("template-initiate-verification-modal").then((function(){E.setContentBlock(!0),r.post(l.baseUrl(!1)+E.pageData.currentAccountRid+"/initiate-verification/"+e.id).then((function(e){e.data.result?M.click("success_event_initiate_verification"):n(e.data.message),e.data.result&&e.data.redirect?t.location=e.data.redirect:(O(),m.clearMessages(E.pageData.currentAccountRid),m.addAlertMessages([{type:e.data.result?"success":"danger",message:e.data.message,aeRid:E.pageData.currentAccountRid}]))})).catch((function(){m.clearMessages(E.pageData.currentAccountRid),m.addFatalErrorMessage(E.pageData.currentAccountRid),n()})).finally((function(){return E.setContentBlock(!1)}))})),M.click("initiate_verification")},this.showDisbursementMethodsPopup=function(){if(!F){var e=y.create("add_method");c.open("disbursement-methods-popup",{paymentTypes:this.pageData.paymentTypes,currentAccountRid:this.pageData.currentAccountRid,onClose:function(t){F=!1,e.click("close"),t&&R([A.MOP_TYPES],!0)}}),F=!0,e.impression("add_method_impression")}},this.setContentBlock=function(e){e?this.shouldBlockContent++:this.shouldBlockContent>0&&this.shouldBlockContent--},this.getScheduleLabel=function(){if(this.pageData.schedule){for(var e in this.pageData.schedule.schedulesList)if(this.pageData.schedule.schedulesList[e].key===this.pageData.schedule.schedule)return this.pageData.schedule.schedulesList[e].label;return null}},this.getNextDate=function(){return this.pageData.schedule&&this.pageData.schedule.nextDate},this.isContentBlocked=function(){return!u.isModalShown()&&this.shouldBlockContent>0},this.removePaymentMethod=function(e){var t=function(){m.clearMessages(C.pageData.currentAccountRid),m.addFatalErrorMessage(C.pageData.currentAccountRid),a("alert-messages"),o()},n=y.create("remove_method_modal");function o(e){n.messages("event_error_remove",e||[void 0])}b.open("template-disbursement-methods-removal-confirmation").then((function(){n.click("remove"),C.setContentBlock(!0);var c,s,u,d=C.pageData.currentAccountRid;r.post((c=d,s="remove",u=e.id,l.depositMethodsBaseUrl(c)+"/"+u+"/"+s)).success((function(e){return function(e,r){r?(r.messages&&r.messages.length>0&&(m.clearMessages(e),m.addAlertMessages(r.messages),i((function(){return a("alert-messages")}))),void 0===r.status?t():r.status?(R([A.MOP_LIST,A.MOP_TYPES,A.CURRENT_SCHEDULE],!0),n.click("success_event_removed")):o(r.messages.map((function(e){return e.message})))):t()}(d,e)})).error((function(){return t()})).finally((function(){return C.setContentBlock(!1)}))}),(function(e){n.click(e)})),M.click("remove"),n.impression("remove_method_modal_impression")},this.isPaymentEditAllowed=function(e){return e.editLink&&("PAYPAL"!==e.code||!Applet.getVar("bpaAgatePayPal"))},this.hasPaymentMethodWithCodeAndStatus=function(e,t){if(!C.hasPaymentMethods())return!1;var n=C.pageData.paymentMethods;for(var r in n)if(n.hasOwnProperty(r)){var a=n[r];if(a.code===e&&a.status===t)return!0}return!1},this.enableAutoDisbursement=function(e){var t=C,n=E.pageData.currentAccountRid,a={};t.setContentBlock(!0),m.clearMessages(n),r.post(e.reenableLink).then((function(e){a=e.data||{}})).finally((function(){t.setContentBlock(!1),m.addAlertMessages(a.messages),!0===a.status?(e.status="ACTIVE",M.click("success_event_reenabled")):(m.addFatalErrorMessage(n),M.impression("error_event_reenable"))}))},this.isEligibleForAddIPO()&&S.preFetchAddForm(),function(){var e=[];for(var t in I)if(I.hasOwnProperty(t)){var n=E.pageData[t];n?A.setDataForAeRid(E.pageData.currentAccountRid,I[t],n):E.pageData.hasOwnProperty(t)||e.push(I[t])}e.length&&R(e)}(),_=v.getAction(),v.ACTION_VERIFY_PAYMENT_METHOD===_.action&&N(_.mopRid)}]);n(45),n(257);var p="disbursement_schedule";function m(e){return{restrict:"E",templateUrl:e.get("template-disbursement-method-types-list"),require:"paymentTypesList",scope:{accountingEntity:"<",paymentTypes:"<",country:"<",callbackObject:"<?"},controller:["$scope","bpaDisburse",function(e,t){this.bpaAgatePayPal=Applet.getVar("bpaAgatePayPal"),this.openAddPaymentMethodModal=function(n){var r=t.openAddPaymentMethodModal(e.accountingEntity,n);r&&r.then((function(){e.callbackObject&&e.callbackObject.paymentAdded&&e.callbackObject.paymentAdded()}))}}],controllerAs:"vm"}}if(angular.module("bpa-ui.directives").directive("disbursementScheduleForm",["$filter","bpaFormValidation","bpaValidationErrors","bpaDisbursementSchedule","bpaEventTrackerFactory","bpaRouting","bpaDisburse",function(e,t,n,r,a,i,o){return{restrict:"E",templateUrl:i.get("template-disbursement-schedule-form"),scope:{interfaceObject:"=?",callbackObject:"=?",disbursementSchedule:"<",accountingEntity:"<",paymentMethods:"<",preselectedMop:"<"},link:function(n){var i=!1,c=a.create(p);function s(){return{target_upm:n.selectedPayment.code,target_schedule:n.form.schedule,target_threshold:parseInt(n.form.threshold)}}function u(e){if(angular.isObject(n.callbackObject)&&angular.isFunction(n.callbackObject[e])){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];(t=n.callbackObject)[e].apply(t,a)}}c.impression(a.LABEL_WIDGET_LOAD),n.$watchGroup(["disbursementSchedule","paymentMethods","preselectedMop"],(function(){n.disbursementSchedule&&n.paymentMethods&&(function(t){if(t.thresholdsList=[],t.disbursementSchedule.minThreshold<t.disbursementSchedule.hardThreshold)for(var n=t.disbursementSchedule.minThreshold;n<=t.disbursementSchedule.hardThreshold;n+=t.disbursementSchedule.thresholdStep)t.thresholdsList[t.thresholdsList.length]=n;else t.disbursementSchedule.threshold!==t.disbursementSchedule.hardThreshold&&(t.thresholdsList[t.thresholdsList.length]=t.disbursementSchedule.hardThreshold,t.thresholdsList[t.thresholdsList.length]=t.disbursementSchedule.threshold);t.thresholdsList=t.thresholdsList.map((function(t){return{name:"$".concat(e("number")(t,2)," or more"),value:String(t)}}))}(n),function(e){for(var t in e.paymentMethodsCount=0,e.paymentMethodsCollection=[],e.paymentMethods)e.paymentMethodsCount++,e.paymentMethodsCollection.push(e.paymentMethods[t])}(n),function(e){var t=e.disbursementSchedule.schedulesList.filter((function(t){return t.key===e.disbursementSchedule.schedule})),n="";angular.isDefined(e.preselectedMop)?n=e.preselectedMop.toString():e.disbursementSchedule.preferredMop?n=e.disbursementSchedule.preferredMop.toString():1===e.paymentMethodsCount&&(n=e.paymentMethodsCollection[0].id.toString()),e.form={schedule:t.length>0?t[0].key:void 0,threshold:e.disbursementSchedule.threshold.toString(),reservedAmount:e.disbursementSchedule.reservedAmount&&e.disbursementSchedule.reservedAmount.toString(),mopRid:n},e.form.mopRid&&(e.selectedPayment=e.paymentMethods[e.form.mopRid])}(n),function(t){t.reservedAmountOptions=angular.isDefined(t.disbursementSchedule.reservedAmountChoices)?t.disbursementSchedule.reservedAmountChoices.map((function(t){return{name:"$".concat(e("number")(t,2)),value:String(t)}})):[]}(n))})),n.interfaceObject=n.interfaceObject||{},angular.extend(n.interfaceObject,{isBlocked:function(){return i},submit:function(){u("submit"),t.revalidateAllFields(n.scheduleForm),n.scheduleForm.$valid?(i=!0,c.click("update",s()),r.save(n.accountingEntity,n.form).then((function(e){o.setDataForAeRid(n.accountingEntity,o.CURRENT_SCHEDULE,e.schedule),c.click("success_event_updated",s()),u("success",e)}),(function(e){var t=e&&e.errors||[];n.networkError=0===t.length,n.formErrors=t,c.messages(a.LABEL_ERROR_PROCESSING,t.length?t:[void 0],s()),u("error",e)})).finally((function(){return i=!1}))):u("validationError")}}),angular.extend(n,{hasPreselectedMop:function(){return angular.isDefined(n.preselectedMop)},getNextDate:function(){if(n.form&&n.form.schedule)for(var e in n.disbursementSchedule.schedulesList)if(n.disbursementSchedule.schedulesList.hasOwnProperty(e)&&n.disbursementSchedule.schedulesList[e].key===n.form.schedule)return n.disbursementSchedule.schedulesList[e].nextDate||"";return n.disbursementSchedule?n.disbursementSchedule.nextDate:""},isManualScheduleSelected:function(e){return e===n.disbursementSchedule.manualSchedule},eventLogClick:function(e){c.click(e)},getFee:function(){if(!n.selectedPayment)return"";var e=n.selectedPayment.fee;return e.percentage?100*e.percentage+"%":"$"+parseFloat(e.fixed).toFixed(2)}})}}}]),angular.module("bpa-ui.directives").directive("paymentTypesList",m),m.$inject=["bpaRouting"],r("Payments-DisbursementMethods")){var g=angular.module("bpa-ui");g.requires.push("account-security-ui"),g.config(b)}function b(e,t,n,r,a,i){e.when("/:aeId?/"+r,{templateUrl:"disbursementMethods.html",controller:"disbursementMethodsCtrl",controllerAs:"disbursements"}),t.html5Mode({enabled:!0}),a.group="payments",a.page="withdrawal-methods",i.pageLoadTracking=!0}function h(e,t,n,r,a){var i=this,o=a.create(p);this.pageData=Applet.getAngularCache().bpa_ui_disbursement_methods_data||{},this.pageData.currentAccountRid||(this.pageData.currentAccountRid=n.get(r)),this.getReturnUrl=function(){return t.getDisbursementMethodsPageUri()},this.trackCancelClick=function(){o.click(a.LABEL_CANCEL)},this.formCallbacks={success:function(e){window.location=i.pageData.successUrls[e.schedule.taxInfo.incomplete?"taxInfo":"disbursements"]}}}if(b.$inject=["$routeProvider","$locationProvider","$compileProvider","DISBURSEMENT_METHODS_URL_PART","SMF_CONFIG","BPA_EVENT_TRACKING_CONFIG"],angular.module("bpa-ui.controllers").controller("disbursementSchedulePageCtrl",h),h.$inject=["$window","bpaUrl","bpaVars","ACCOUNTING_ENTITY_KEY","bpaEventTrackerFactory"],r("Payments-DisbursementMethods-ScheduleForm")){var v=angular.module("bpa-ui");v.requires.push("account-security-ui"),v.config(["BPA_EVENT_TRACKING_CONFIG",function(e){e.pageLoadTracking=!0}])}n(46);var y=n(686);y.keys().forEach(y);n(23);var A=n(687);A.keys().forEach(A);n(30);var S=n(696);if(S.keys().forEach(S),r("FinancialAccounts")||r("FinancialAccounts-Edit")){var C=angular.module("bpa-ui");C.requires.push("bpa-ui.financial-accounts.factories"),C.requires.push("bpa-ui.financial-accounts.directives"),C.requires.push("bpa-ui.financial-accounts.controllers"),C.config(["$routeProvider",function(e){e.when("/edit/:aeId",{template:" ",controller:"editAeCtrl"})}])}n(22),n(19);if(angular.module("bpa-ui.controllers").controller("taxInfoCtrl",["$scope","$anchorScroll","$timeout","$location","$window","bpaScreenSize","bpaAlert","bpaTaxInfo","bpaFormValidation","bpaRouting","bpaConfirmation","sensitiveZone",function(e,t,n,r,a,i,o,c,s,u,l,d){var f="tax-info-form",p="vat-info-form",m="return-to-disbursements",g=!1,b=!1,h="show",v=Applet.getVar("bpaTaxInfoInitData");function y(t){g=!0,c.get(e.context).then((function(n){e.pageData=n,t&&A()}),(function(t){return e.pageDataError=t})).finally((function(){return g=!1}))}function A(){switch(r.hash()){case m:b=!0;case f:e.showTaxInfoForm();break;case p:e.pageData&&e.pageData.vatInfo&&!e.pageData.vatInfo.isPresent&&e.showVatInfoForm()}}function S(e){i.is("xs","sm","md")&&t(e)}function C(){t("alert-messages")}e.context=Applet.getOrganization().getUid(),angular.extend(e,{isTaxInfo:function(){return h===f},isVatInfo:function(){return h===p},isTaxResidency:function(){return"tax-residency-form"===h},vatInfoForm:{},taxInfoForm:{},taxResidencyForm:{},taxInfoCallbacks:{success:function(){h="show",C(),b?a.location=u.get("page-disbursement-methods"):y()},error:function(){C()}},vatInfoCallbacks:{success:function(){h="show",C(),y()},error:function(){C()}},taxResidencyCallbacks:{success:function(){h="show",y()},error:function(e){null!==e&&(o.addAlertsOrFatal(e),C())}},shouldBlockContent:function(){return(g||angular.isFunction(e.taxInfoForm.isBlocked)&&e.taxInfoForm.isBlocked()||angular.isFunction(e.vatInfoForm.isBlocked)&&e.vatInfoForm.isBlocked()||angular.isFunction(e.taxResidencyForm.isBlocked)&&e.taxResidencyForm.isBlocked())&&!d.isModalShown()},showTaxInfoForm:function(){h=f,n((function(){return S(h)})),angular.isFunction(e.taxInfoForm.resetValues)&&e.taxInfoForm.resetValues()},cancelTaxInfoForm:function(){S(h="show"),b?a.location=u.get("page-disbursement-methods"):e.taxInfoForm.triedToSubmit()&&y()},showVatInfoForm:function(){h=p,n((function(){return S(h)}),100),angular.isFunction(e.vatInfoForm.resetValues)&&e.vatInfoForm.resetValues()},cancelVatInfoForm:function(){S(h),h="show",e.vatInfoForm.triedToSubmit()&&y()},removeVatInfo:function(){var t=l.open("template-vat-removal-warning",{vatInfo:e.pageData.vatInfo});t&&t.then((function(){o.clearMessages(),g=!0,c.removeVat(e.context).then((function(e){o.addAlertMessages(e.messages),C(),y()}),(function(e){e&&e.messages.length>0?o.addAlertMessages(e.messages):o.addFatalErrorMessage(),g=!1,C()}))}))},showTaxResidencyForm:function(){h="tax-residency-form",n((function(){return S(h)}),100),angular.isFunction(e.taxResidencyForm.resetValues)&&e.taxResidencyForm.resetValues()},cancelTaxResidencyForm:function(){S(h),h="show",e.taxResidencyForm.triedToSubmit()&&y()},isTaxResidencyAvailable:function(){return v.taxResidencyAllowed}}),e.pageData?A():y(!0)}]),r("TaxInfo-Show")){var E=angular.module("bpa-ui");E.requires.push("components.core.datepicker"),E.requires.push("account-security-ui"),E.config(["$routeProvider","$locationProvider","TAX_INFO_URL_PART","SMF_CONFIG",function(e,t,n,r){e.when("/"+n,{templateUrl:"taxInfoIndex.html",controller:"taxInfoCtrl"}),t.html5Mode({enabled:!0}),r.group="tax",r.page="show-info"}])}n(97);var k=n(703);k.keys().forEach(k);n(69);var M=n(704);M.keys().forEach(M);n(70);var _=n(707);if(_.keys().forEach(_),r("TaxInfo-VatInterstitial")){var I=angular.module("bpa-ui");I.requires.push("bpa-ui.vat-info.factories"),I.requires.push("bpa-ui.vat-info.controllers"),I.requires.push("bpa-ui.vat-info.directives"),I.config(["$routeProvider",function(e){var t={templateUrl:"VatMain.html",controller:"vatInfoMainCtrl"};e.when("/",t).when("/skip",{templateUrl:"VatSkip.html",controller:"vatInfoSkipCtrl"}).when("/edit",{templateUrl:"VatEdit.html",controller:"vatInfoEditCtrl"}).otherwise(t)}])}function F(e,t,n,r,a,i,o){this.pageData=Applet.getVar("bpa_ui_disburse_data"),a.get(o)||a.set(o,e.aeId),this.isForm=function(){return angular.isUndefined(e.paymentTrxId)},this.getTitle=function(){return this.isForm()?this.pageData.titles.disburse:this.pageData.titles.confirmation},this.onSubmit=function(e){angular.extend(this.pageData,{accountInfo:e.accountInfo,withdrawalResult:e.withdrawalResult});var n="/"+e.accountInfo.id+"/disburse/"+e.withdrawalResult.payment.id;e.withdrawalResult.adjustment&&(n+="-"+e.withdrawalResult.adjustment.id),t.path(n)},this.getCancelUrl=function(){return r.getDisbursementMethodsPageUri()},this.onSave=function(){n.print()},this.isForm()&&i.create(i.SUBLOCATION_PAGE).impression(i.LABEL_PAGE_LOAD)}angular.module("bpa-ui.controllers").controller("disburseCtrl",F),F.$inject=["$routeParams","$location","$window","bpaUrl","bpaVars","bpaEventTrackerFactory","ACCOUNTING_ENTITY_KEY"];n(95);var P="get_paid_now_confirmation";function w(e){return{restrict:"E",templateUrl:e.get("template-disburse-confirmation"),scope:{accountInfo:"<",withdrawalResult:"<",onClose:"&?",onSave:"&?",closeUrl:"@",saveLabel:"@",title:"@",interfaceObject:"=?",hideControls:"<"},controllerAs:"vm",controller:D}}function D(e,t,n){var r=this,a=n.create(P);e.interfaceObject&&Object.assign(e.interfaceObject,{getSaveLabel:function(){return e.saveLabel},getTitle:function(){return e.title},submit:function(){t.print()}}),angular.extend(r,{getFee:function(){return e.withdrawalResult&&e.withdrawalResult.adjustment?-e.withdrawalResult.adjustment.amount:0},getTotal:function(){return e.withdrawalResult&&e.withdrawalResult.payment.amount-r.getFee()},closeReceipt:function(t){a.click("done"),angular.isFunction(e.onClose)&&(t.preventDefault(),t.stopPropagation(),e.onClose())},hasOnSave:function(){return angular.isFunction(e.onSave)},saveReceipt:function(t){a.click("print"),r.hasOnSave()&&(t.preventDefault(),t.stopPropagation(),e.onSave())},hasFxRate:function(){return Boolean(r.getFxRateData())},getFxRateData:function(){return e.withdrawalResult&&e.withdrawalResult.mop&&e.withdrawalResult.mop.currency?e.withdrawalResult.mop.currency:null}})}if(angular.module("bpa-ui.directives").directive("disburseForm",["bpaOauth2Http","$timeout","$anchorScroll","bpaDisburse","bpaUrl","bpaVars","bpaAlert","bpaRouting","bpaEventTrackerFactory","bpaValidationErrors","bpaFormValidation","sensitiveZone","ACCOUNTING_ENTITY_KEY",function(e,t,n,r,a,i,o,c,s,u,l,d,f){return{restrict:"E",templateUrl:c.get("template-disburse-form"),scope:{accountingEntity:"<",accountInfo:"<",withdrawalOptions:"<",blockTarget:"@",onSubmit:"&?",onCancel:"&?",cancelUrl:"@",isShown:"<",saveLabel:"@",title:"@",interfaceObject:"=?",hideControls:"<",alertNamespace:"@",forcePaymentMethod:"<",hideTotalAmountInfoLine:"<?"},controllerAs:"vm",controller:["$scope","$element",function(e,a){var c,p,m,g,b,h,v,y=this,A=!1,S=!1,C=NaN,E=s.create("get_paid_now");function k(t){c=[],angular.forEach(t||{},(function(e){c.push(e)})),1===c.length&&(e.form.selectedPayment=c[0])}e.form={withdrawalMode:"whole"},e.const={AMOUNT_WHOLE:"whole",AMOUNT_PARTIAL:"partial"},e.blockTarget||(e.blockTarget="body"),e.interfaceObject&&Object.assign(e.interfaceObject,{getSaveLabel:function(){return e.saveLabel},getTitle:function(){return e.title},isSubmitDisabled:function(){return y.isFeeCalculationInProgress()}}),angular.extend(y,{setContentBlock:function(e){A=e},isContentBlocked:function(){return!d.isModalShown()&&A},getWithdrawalOptionsArray:function(){return c},getBalance:function(){return e.accountInfo&&e.accountInfo.balance||0},hasNegativeBalance:function(){return e.accountInfo&&e.accountInfo.balance<0},getSelectedPayment:function(){return e.forcePaymentMethod||e.form.selectedPayment},getLimit:function(){var e=y.getSelectedPayment();return e&&e.withdrawalLimits.max},getLimitHint:function(){var e=y.getSelectedPayment();return e&&e.withdrawalLimits.hint},getMinLimit:function(){var e=y.getSelectedPayment();return e?(y.recalculateMinLimit(e),C):NaN},hasLimit:function(){return Boolean(y.getLimit())},getMaxAmount:function(){return y.getSelectedPayment()?y.hasLimit()?Math.min(y.getLimit(),y.getBalance()):y.getBalance():0},getFee:function(){return y.recalculateFee(),-m},hasFeeNote:function(){return Boolean(y.getFeeNote())},getFeeNote:function(){var e=y.getSelectedPayment();return e?e.fee.note:""},getSelectedAmount:function(){return y.isPartialAmount()&&e.disburseForm&&e.disburseForm.partialAmount?e.disburseForm.partialAmount.$viewValue:parseFloat(y.getMaxAmount()).toFixed(2)},getTotal:function(){return y.recalculateFee(),p},isFeeCalculationInProgress:function(){return h||S&&y.isPartialAmount()},recalculateFee:function(){function n(t){return!(1*t)||y.isPartialAmount()&&e.disburseForm&&e.disburseForm.partialAmount&&e.disburseForm.partialAmount.$invalid}function a(e,n,r){t((function(){m=e,p=n,r&&y.revalidatePartialAmount()}))}clearTimeout(v),v=setTimeout((function(){var e=y.getSelectedPayment();if(e){var t=y.getSelectedAmount();g===e.id&&b===t||(g=e.id,b=t,a(0,0),n(t)||(h=!0,r.calculateFee(y.getAeRid(),e.id,t).then((function(e){var r=y.getSelectedAmount();n(r)&&(h=!1),r===t&&(a(e.fee,e.amountSentToUser,!0),h=!1)}))))}}),300)},recalculateMinLimit:function(e){if(isNaN(C)&&!S&&e.withdrawalLimits){var n=e.withdrawalLimits.min;S=!0,t((function(){r.calculateFee(y.getAeRid(),e.id,parseFloat(n).toFixed(2)).then((function(e){C=1*e.fee+1*n,y.revalidatePartialAmount(),S=!1}))}))}},revalidatePartialAmount:function(){e.disburseForm&&e.disburseForm.partialAmount&&l.revalidateAllFields([e.disburseForm.partialAmount])},hasFxRate:function(){return Boolean(y.getFxRateData())},getFxRateData:function(){var e=y.getSelectedPayment();return e?e.currency:null},hasRemittanceInfo:function(){var e=y.getSelectedPayment();return e&&void 0!==e.remittanceInfo},getPaymentDescription:function(){return y.getSelectedPayment()?y.getSelectedPayment().name:""},getRemittanceInfo:function(){return y.hasRemittanceInfo()?y.getSelectedPayment().remittanceInfo:""},isPartialAmount:function(){return"partial"===e.form.withdrawalMode},getAeRid:function(){return e.accountingEntity||i.get(f)},submitForm:function(i){i&&(i.preventDefault(),i.stopPropagation()),e.disburseForm.$setSubmitted();var c=y.getSelectedPayment();if(c){var d={selected_amount:e.form.withdrawalMode,upm_type:c.code};E.click("get_paid_now",d),y.isPartialAmount()||e.disburseForm.partialAmount.$setViewValue(""),l.revalidateAllFields(e.disburseForm),e.disburseForm.$valid?(y.setContentBlock(!0),o.clearMessages(y.getAeRid(),e.alertNamespace),r.disburse(y.getAeRid(),c.id,parseFloat(y.getSelectedAmount()),y.hasRemittanceInfo()?e.form.remittanceInfo:null,!!y.hasRemittanceInfo()&&Boolean(e.form.overrideRemittanceInfo)).then((function(r){!function(r,a){var i=y.getAeRid();a?(a.messages&&a.messages.length>0&&o.addAlertMessages(a.messages,e.alertNamespace),a.errors&&a.errors.length>0&&o.addAlertMessages(a.errors.map((function(e){return{message:e,type:"danger",title:"",aeRid:i}})),e.alertNamespace)):o.addFatalErrorMessage(i,e.alertNamespace);t((function(){n("alert-messages"),function(t){var n=o.getAlertMessages(y.getAeRid(),e.alertNamespace).filter((function(e){return"success"!==e.type})).map((function(e){return e.message}));n.length&&E.messages(s.LABEL_ERROR_PROCESSING,n,t)}(r)}))}(d,r),r&&r.status&&(E.impression("success_event_disbursed",d,P),angular.isFunction(e.onSubmit)&&e.onSubmit({data:r}),e.interfaceObject&&angular.isFunction(e.interfaceObject.onSuccessfulDisburse)&&e.interfaceObject.onSuccessfulDisburse(r))})).catch((function(){o.addFatalErrorMessage(y.getAeRid(),e.alertNamespace)})).finally((function(){y.setContentBlock(!1)}))):t((function(){E.messages(s.LABEL_ERROR_VALIDATION,u.extract(a[0]),d)}))}else E.messages(s.LABEL_ERROR_VALIDATION,u.extract(a[0],".form-group .form-message.form-error:not(.ng-hide)"))},cancelForm:function(t){E.click(s.LABEL_CANCEL),angular.isFunction(e.onCancel)&&(t.preventDefault(),t.stopPropagation(),e.onCancel())},getForcedPaymentName:function(){return e.forcePaymentMethod?e.forcePaymentMethod.namePlain||e.forcePaymentMethod.name:""}}),e.interfaceObject&&(e.interfaceObject.submit=function(){return y.submitForm()}),k(e.withdrawalOptions),e.$watch("form.withdrawalMode",(function(t){"whole"===t&&(e.form.partialAmount=""),e.disburseForm.partialAmount.$setPristine()})),e.$watch("withdrawalOptions",k),e.$watch("form.selectedPayment",(function(){C=NaN,e.form.remittanceInfo=y.getRemittanceInfo(),e.disburseForm.partialAmount.$setPristine(),e.disburseForm.remittanceInfo.$setPristine()})),e.$watch("isShown",(function(e){e&&E.impression("get_paid_now_impression")}))}]}}]),angular.module("bpa-ui.directives").directive("disburseConfirmation",w),w.$inject=["bpaRouting"],D.$inject=["$scope","$window","bpaEventTrackerFactory"],r("Payments-Disburse","Payments-Disburse-Confirmation","Payments-Disburse-Confirmation-WithAdjustment")){var T=angular.module("bpa-ui");T.requires.push("account-security-ui"),T.config(["$routeProvider","$locationProvider","SMF_CONFIG",function(e,t,n){var r=Applet.getVar("bpa_ui_disburse_data"),a={templateUrl:"disbursePage.html",controller:"disburseCtrl",controllerAs:"disburse"};e.when("/:aeId?/disburse",angular.extend({title:r.titles.disburse},a)).when("/:aeId/disburse/:paymentTrxId",angular.extend({title:r.titles.confirmation},a)).when("/:aeId/disburse/:paymentTrxId-:adjustmentTrxId",angular.extend({title:r.titles.confirmation},a)),t.html5Mode({enabled:!0}),n.group="withdraw",n.page="index"}]),T.run(["$rootScope","$document",function(e,t){e.$on("$routeChangeSuccess",(function(e,n){n.$$route&&n.$$route.title&&(t[0].title=n.$$route.title)}))}])}n(738)}]);